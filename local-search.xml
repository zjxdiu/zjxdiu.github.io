<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>折腾hk4e服务器的记录</title>
    <link href="/blog/hk4e_server_mess/"/>
    <url>/blog/hk4e_server_mess/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文是我折腾某个动漫（XX）游戏服务端时的记录，内容杂乱、无固定格式，甚至还包含许多centos的使用内容（因为我不会Linux），仅用作备忘录；不过如果你刚好也在折腾这个，那或许其中某些信息会对你有所帮助。</p><h2 id="关于服务端"><a href="#关于服务端" class="headerlink" title="关于服务端"></a>关于服务端</h2><p>我获取到的hk4e server是从同学手里拿到的3.4dev版本，在启动脚本打印信息中提到服务端由XX研究社提供，具体内容不在此处透露，有兴趣可自行了解。<br><strong>注意别被骗了，要你花钱的都是倒卖</strong> <em>（除了某些国产网盘下载也许需要充会员才给你开放完整下载权限，或者需花钱魔法上网等）</em></p><h3 id="启动流程备忘："><a href="#启动流程备忘：" class="headerlink" title="启动流程备忘："></a>启动流程备忘：</h3><p>开机，打开终端；<br><strong>反向代理无法在本地使用，详见下文</strong><br>第一步：启动反向代理（不使用frp则无需此步骤）<br>su root（输入密码，进入超级用户）<br>ifconfig （检查IP地址是否正确）<br>cd frpc[TAB] （进入frp客户端文件夹）<br>.&#x2F;frpc -c .&#x2F;frpc.toml （启动frp客户端，提前验证服务端是否启动）<br>第二步：启动服务端<br>34s start<br>34s status （检查各服务启动情况）</p><h2 id="关于客户端"><a href="#关于客户端" class="headerlink" title="关于客户端"></a>关于客户端</h2><p>3.x客户端可使用补丁方式连接，无需代理。<br>需要注意的是，由于3.4服务端分发问题严重，官方已删除3.4客户端的分发链接，互联网上几乎所有二次上传的文件也都被DMCA或已失效。</p><h2 id="关于虚拟机性能"><a href="#关于虚拟机性能" class="headerlink" title="关于虚拟机性能"></a>关于虚拟机性能</h2><p>我的电脑是一台华硕笔记本电脑，搭载i7-11800H和自己升级的32G内存，实际来说16G内存+Win10即可运行基本完整的服务端，24G内存即可同时启动服务端和客户端游玩。<br>要开带联机的服务器，虚拟机至少需分配13G内存，因此16G内存将无法同时启动客户端，必须在单独的电脑上启动。</p><p>对于CPU而言，需要注意不要开太多核心，至少在我电脑上开4核就是最快的（太少了也慢，建议不低于3核），而多于6核的时候宿主机和虚拟机一起卡。<br><img src="/../_resources/9cf5298ca9a64398fabb53f8ac3fbd36.png" alt="我的虚拟机配置.png"></p><hr><h2 id="关于公网连接的端口和协议"><a href="#关于公网连接的端口和协议" class="headerlink" title="关于公网连接的端口和协议"></a>关于公网连接的端口和协议</h2><p>这一点是我折腾时间最长、难度最高的部分，因为没有任何文档和指引，全靠自己摸索。<br>通过调查配置文件、自己抓包分析、试错等多种方式，确定公网连接所需端口及协议列表如下：</p><table><thead><tr><th>端口</th><th>服务</th><th>传输层协议</th><th>说明</th><th>开放？</th></tr></thead><tbody><tr><td>23401</td><td>maingame</td><td>UDP</td><td>主游戏服务</td><td>必须</td></tr><tr><td>23405</td><td>dispatch</td><td>TCP</td><td>签派（即区服下发）</td><td>必须</td></tr><tr><td>23406</td><td>muipserver</td><td>TCP</td><td>游戏进程&#x2F;多IP通信服务</td><td>使用GM时</td></tr><tr><td>23410</td><td>sdkserver</td><td>TCP</td><td>SDK服务</td><td>必须</td></tr></tbody></table><h3 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h3><p>卡下载更新：检查TCP 23405（使用本地的反代会导致变成内部IP进而无法连接）<br>开门白屏：检查UDP 23401，检查gateserver配置中的outer_ip（注意该字段不允许使用域名！）<br>开门黑屏闪加载圈：检查TCP 23410，及sdkserver配置中对应区服IP（使用本地的反代会导致变成内部IP进而无法连接）<br>GM工具无法连接：检查TCP 23406</p><h3 id="使用反向代理的问题"><a href="#使用反向代理的问题" class="headerlink" title="使用反向代理的问题"></a>使用反向代理的问题</h3><p>由于我的服务器是对公网开放的，但我电脑是在NAT内网之下，所以我是利用了一个带公网IP的商用宽带环境做内网穿透使用；之前的做法是通过L2TP VPN连接到商宽环境，然后将其外网端口转发到我的VPN客户端IP上。<br>但我的虚拟机在使用xl2tpd的时候CPU会占满100%，GitHub上有一个已关闭的issue指向同一个问题，似乎可以通过更新centos的内核来解决，而我暂时还不想更新，所以这里另寻他路。<br>那么这种需要服务器在内网、客户端在外网的环境，使用反向代理似乎是无脑的选择；通过反向代理，客户端发往服务器的数据会先发送到反向代理服务器，反代服务器再将请求转发到内网的真实服务器上，反之亦然。<br>因此我快速配置好了frp反代软件，然而通过外网就是无法连接（我在内网时选择走外网链接是正常，但如果不在内网则不行）；具体症状主要表现为卡更新（准备更新资源）。<br>经过反复日志排查，我的猜测是位于真实服务器上的反向代理客户端是以本地的身份向服务器发送请求的，因此服务器也会以本地地址响应；这里主要是影响了dispatch的功能，可能服务器返回的是内网IP URL，因此不在同一内网的机器无法查询。<br>我也尝试过非常多方法，甚至直接将内网IP整个删掉并替换，但仍然无效。最终不得不放弃反向代理的方案，转而使用其他VPN方法。</p><h3 id="通过Softether-VPN-client连接"><a href="#通过Softether-VPN-client连接" class="headerlink" title="通过Softether VPN client连接"></a>通过Softether VPN client连接</h3><p>因为是使用Softether搭建的VPN服务器，所以客户端也用这个软件很合理。<br>至于为什么一开始没有使用？因为在Linux下配置client需要很多手动操作，而我刚好对Linux一无所知。<br>这里非常感谢@Variazioni 提供的教程，原文见：<a href="https://blog.csdn.net/Variazioni/article/details/127004628">https://blog.csdn.net/Variazioni/article/details/127004628</a><br>简而言之，Linux下使用softether client不仅需要通过命令行界面完成操作（没有图形程序），还需要手动进行DHCP、调整路由表等。操作方法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">进入VPN客户端文件夹</span><br>cd vpnclient<br><span class="hljs-meta prompt_"># </span><span class="language-bash">启动VPN管理程序</span><br>./vpncmd<br><span class="hljs-meta prompt_"># </span><span class="language-bash">根据界面提示按2进入client管理，直接回车连接本地client</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用<span class="hljs-built_in">help</span>查看指令列表，一般手动disconnect再connect就行</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">确认已连接后，新开终端，进入下一步</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">手动执行DHCP，先取消已存在的DHCP客户端</span><br>dhclient -r<br><span class="hljs-meta prompt_"># </span><span class="language-bash">再重新进行DHCP</span><br>dhclient vpn_vpn<br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看网卡配置，确定IP已获取</span><br>ifconfig<br><span class="hljs-meta prompt_"># </span><span class="language-bash">下面调整路由表，先要知道VPN服务器的[IP]</span><br>nslookup [域名]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">调整路由表，假设内网IP默认网关192.168.0.1</span><br>ip route add [IP] via 192.168.0.1<br>ip route del default via 192.168.0.1<br></code></pre></td></tr></table></figure><p>经过以上调整后即可完成VPN配置，可ping一下VPN服务器网络内的IP检查是否成功。</p><hr><h2 id="关于数据库和文件"><a href="#关于数据库和文件" class="headerlink" title="关于数据库和文件"></a>关于数据库和文件</h2><p>终端中使用bt指令可执行控制操作，如强制修改MySQL密码、查询宝塔面板地址等；<br>数据库中部分表的含义可参考：<a href="https://www.iopq.net/forum.php?mod=viewthread&tid=17117217">https://www.iopq.net/forum.php?mod=viewthread&tid=17117217</a><br>宝塔面板左侧进入数据库即可备份和恢复，点右侧管理按钮即可进入PhpMyAdmin进行数据库编辑。</p><h3 id="如何备份账号数据"><a href="#如何备份账号数据" class="headerlink" title="如何备份账号数据"></a>如何备份账号数据</h3><p>在数据库路径<code>/34live_db/34live_db_user/</code>下，分别导出<code>t_block_data_X</code>、<code>t_home_data_X</code>和<code>t_player_data_X</code>（其中X是用户id）；导出后得到sql文件，备份即创建完成。<br>也可在宝塔面板备份所有数据库，不过恢复的时候可能会出现各种密码问题，不是非常建议。<br>恢复时，先确定恢复目标id的表格是否存在（可使用面板查询，若服务崩溃可通过SQL指令查询，指令可询问AI获取），若不存在可直接导入对应SQL恢复文件；若存在，则应先使用文本编辑软件打开SQL文件，删除其中<code>CREATE TABLE</code>段落处的所有内容再执行恢复。<br>注意，若需要复制账号，请先创建一个新号，进游戏看一遍开局CG再执行以上操作，并且记得将所有表里的UID进行修改确保不冲突，否则可能出现数据冗余错误（即账号记录和实际表不匹配），导致gateserver无法启动等问题。这时需要手动连接数据库进行调整等，总之很麻烦。<br><strong>养成折腾之前备份数据库的习惯！再稳一点可以存虚拟机快照！</strong></p><h3 id="提示“当前所选内容没有包含唯一字段”"><a href="#提示“当前所选内容没有包含唯一字段”" class="headerlink" title="提示“当前所选内容没有包含唯一字段”"></a>提示“当前所选内容没有包含唯一字段”</h3><p>出现此问题时，进入服务器主文件夹，找到<code>/www/server/phpmyadmin/phpmyadmin_[hexString]/config.inc.php</code>，在<code>Servers configuration</code>下加入一行：<code>$cfg[&#39;RowActionLinksWithoutUnique&#39;] = true;</code>，保存文件重启服务端即可。</p><h3 id="文件只读"><a href="#文件只读" class="headerlink" title="文件只读"></a>文件只读</h3><p>由于centos自带的资源管理器在获取root权限后经常出现各种奇奇怪怪的问题，因此建议的方法是将对应文件复制到桌面，编辑后通过获取了root权限的终端使用<code>cp /源文件目录/源文件 /目标目录/目标文件</code>将新文件覆盖过去。</p><hr><h2 id="关于功能"><a href="#关于功能" class="headerlink" title="关于功能"></a>关于功能</h2><h3 id="添加卡池"><a href="#添加卡池" class="headerlink" title="添加卡池"></a>添加卡池</h3><p>虽然说明书里说可以使用<code>yskc</code>指令来更换卡池，但实际上由于默认MySQL不允许空密码登录，设置是无效的（终端里会显示很多<code>Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)</code>之类的错误）；<br>建议使用外部工具来设置，例如该数据库连接工具：<br><img src="/../_resources/23dc117188705bd913a3dc7d02c9205a.png" alt="工具界面.png"></p><p>卡池类型中，201是角色限时，301是武器限时；<br>先删除旧的限时卡池，再从下方预设卡池选择添加；<br>“抽奖卡池选择”字段中，左侧选择卡池类型id，右侧需输入卡池自身id（理论上来说所有卡池各不相同即可）</p><h3 id="添加活动"><a href="#添加活动" class="headerlink" title="添加活动"></a>添加活动</h3><p><strong>主题活动仅限3.x可正常运行，推测是每次大版本号更新时会删除部分旧版活动资源和数据，因此老活动通常只能开普通活动；可以通过活动id判断。</strong><br>在活动id表格中可查询活动id；<br>若id以5开头则为普通活动，多数可以正常游玩；非5开头通常不可正常游玩。（也有很多例外，总体来说越新的活动正常概率越高）<br><img src="/../_resources/0dbf476932b691056ddea041db6195b4.png" alt="活动id表.png"></p><hr><h2 id="最终注意事项（备忘）"><a href="#最终注意事项（备忘）" class="headerlink" title="最终注意事项（备忘）"></a>最终注意事项（备忘）</h2><ol><li>干一些奇怪的操作前一定要备份数据库，别嫌麻烦，万一炸了随时可以恢复，总不至于从头创建账号；</li><li>不要点商城里的丽莎皮肤，会卡死客户端；</li><li>GM里的父任务选项尽量别用，很容易出问题；</li><li><del>xl2tpd这个组件似乎有问题，用VPN的话会吃满一个CPU核心，尽量用frp反代。</del></li></ol>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>测试</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络</tag>
      
      <tag>游戏</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从唤境引擎迁移到其他游戏引擎</title>
    <link href="/blog/game_engine_chg/"/>
    <url>/blog/game_engine_chg/</url>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>此前我几乎所有的游戏开发经验都建立在唤境引擎之上，这是一款国产的图形化无代码2D游戏引擎，虽然是主打大众化、易上手，但实际上引擎提供的自由度非常高，可以完成任何类型的2D游戏开发。</p><p>引擎和游戏基于类似electron技术，将游戏打包在浏览器中，也可以直接在线运行，提供了较好的灵活性和跨平台兼容性，不过由于几乎不存在多核优化，性能上比较差。</p><p>然而，唤境自从我2020年关注开始就逐渐下滑，一开始还有不少更新、激励计划和热度，但是2021之后引擎就几乎没有过任何功能更新，官方也逐渐开始淡出视野，直到2023年7月最后发过一条动态就再也没有声响了。当然引擎更新方面我认为唤境已经很完善了，后续增加的多人联机、视频功能、云存档等都是非常有用的功能，也填补了之前存在的功能缺口；但引擎开发停滞、官网域名一再更换，直到最终完全下架引擎和app下载链接、关闭手机app服务，无不表明着唤境已经在濒临关闭的边缘了。</p><p><img src="/../_resources/da1568250587099170364f483afddf5f.png" alt="开发者论坛已近一个月没有任何动态"></p><h3 id="为什么要更换引擎？"><a href="#为什么要更换引擎？" class="headerlink" title="为什么要更换引擎？"></a>为什么要更换引擎？</h3><p><strong>2024&#x2F;9&#x2F;14更新：唤境已推出单机版引擎，不再依赖在线服务，因此如果你的项目已经有很大程度的开发进度那么可以不更换引擎；但考虑到唤境未来可能不会再提供功能更新，我仍然推荐选择其他正在积极开发和维护的引擎。</strong></p><ul><li>唤境虽然是相对轻量化的引擎，但严重依赖在线服务；hub必须联网才能启动引擎，且游戏打包导出也必须通过唤境官方服务器进行，无法手动本地完成。</li><li>多人联机完全依赖官方服务器，无法自建、无法局域网联机</li><li>官方支持客服人员几乎完全无法联系，无法结算收益、获得推广</li><li>手机app停止服务，无法通过app查找和推广游戏</li></ul><p>可以看出，如果唤境真的关停服务器，那么所有现有项目将完全被迫废弃，引擎都无法打开，遑论打包输出游戏和游玩（但对于单机已打包的游戏没有影响，显然）。</p><h2 id="可以更换哪些引擎？"><a href="#可以更换哪些引擎？" class="headerlink" title="可以更换哪些引擎？"></a>可以更换哪些引擎？</h2><p>tip：前置内容很长，下面有个人推荐总结。</p><p>2024年了，游戏引擎的数量非常之多，允许开发者个人免费使用、商用的引擎也越来越多，许多还都是开源引擎。我简单整理了一下开发者们大多可能选择的选项，并给出我自己的选择。</p><h3 id="虚幻和unity"><a href="#虚幻和unity" class="headerlink" title="虚幻和unity"></a>虚幻和unity</h3><p>显然，每个接触过游戏开发的，乃至于大多数普通游戏玩家都知道这两个世界级的大型引擎。二者都同时为小型独立开发者和大型游戏公司提供良好的灵活性，且商用授权费用计价相对合理（unity前段时间有过这方面的作死行为，但个人认为总比那些一开始就要花很高价格买使用授权的还是要好）。</p><p>虚幻引擎整体而言规模更庞大，完全针对3D进行优化和设计，由于内置的蓝图系统可以一定程度上减少代码编写工作量而被认为适合轻量化开发，但实际上由于引擎较为现代化，支持的各种功能繁多，无论是开发游戏还是运行游戏都有较大的资源开销，入门难度仍然不低，且其游戏的性能通常更低；但虚幻引擎自带的工具很多都非常有用，例如物理、动画和光照等，同时还有非常强大的渲染系统，使其游戏的视觉效果能快速达到较好水平（也就是制作一个“宣传骗”非常容易）。</p><p>unity则是提供更多的灵活性，但也意味着开发者需要自己写很多代码，甚至有时候还需要完全更改渲染管线来实现更好的画面表现。不过总体而言，unity相对更轻量化，总体游戏性能更好，对2D的支持也比较完善，同样是适合独立开发者的选择。</p><p>就这二者而言，由于唤境是2D游戏引擎，我认为要转到虚幻引擎可能会出现一些困难；尽管如此，虚幻引擎的蓝图系统允许开发者不写代码完成编程，这方面的优势会更大。然而，unity本身上手学习难度相对低，因此如果能学会C#的话我更推荐unity。</p><h3 id="Godot"><a href="#Godot" class="headerlink" title="Godot"></a>Godot</h3><p>这是一个免费、开源、功能强大的引擎，同时支持2D和3D，也是许多唤境开发者首选的迁移目标（甚至许多从unity迁出的开发者）。Godot虽然目前没有太多非常出名的大型游戏作品，但在独立游戏开发者、个人和小型工作室以及许多正在学习游戏开发的人群中非常流行。这不仅有利于引擎维持其更新和热度，更创建了一个活跃的社区环境，对于开发者而言总是有利的。</p><p>Godot支持多种不同的代码语言，有其自有的GDscript，也可通过插件支持来使用C#、C++、.NET或者python等多种语言。Godot实现了较好的平衡性，独特的节点系统同时保持了功能多样和规整有序。</p><p><img src="/../_resources/1b39bf1e7947b89f2b096c4e3bf529f7.png" alt="Godot程序界面"></p><p>虽然优点很多，但Godot的学习曲线确实更长，尤其是对于从未真正将一门编程语言用于生产的开发者而言；对于使用唤境的许多开发者而言，这是一个较大的挑战。</p><h3 id="Game-Maker-Studio（GMS）"><a href="#Game-Maker-Studio（GMS）" class="headerlink" title="Game Maker Studio（GMS）"></a>Game Maker Studio（GMS）</h3><p>完全面向2D游戏开发，支持一种类似虚幻蓝图系统的GML Visual可视化工具以及GML Code脚本语言进行编程。</p><p>我个人并没有尝试过这个引擎，很大一部分原因是它的定价：允许个人免费非商业使用，但要商用则必须购买专业级许可证（100美元终身！），或者以每月80美元的价格订阅企业版（年付800美元）。这个价格于我而言是不可接受的水平。</p><p>此外，就我在官网和文档中看到的资料来说，GMS本身似乎并没有什么非常值得我使用的理由，各种特色也并未成为杀手级应用，所以就个人而言，我并不推荐唤境开发者转向GMS，除非完全只是出于兴趣和学习目的开发游戏，或者自己资金充裕。</p><h3 id="RPG-maker（RPGM）"><a href="#RPG-maker（RPGM）" class="headerlink" title="RPG maker（RPGM）"></a>RPG maker（RPGM）</h3><p>RPGM本身并非免费引擎，可以在steam上购买引擎并获得商业使用权；这也是一个比较有名的游戏引擎，正如其名所示，这是一个专注于制作RPG类游戏的引擎。</p><p>与其他所有引擎都不同，RPGM的一大特点就是预制内容多，包括自带的各类素材库和生成器等，使得“真正完全没有开发基础的人”也能做出自己的游戏。但也正因如此，其灵活性相对要差一些（如果不是非常差的话），近年来热度也并不高，在我看来它就像是一轮湖中月，大多数开发者都无法真正用它做出一个完整的游戏，更不用说一个好玩的游戏了。</p><h3 id="Construct-3（C3）"><a href="#Construct-3（C3）" class="headerlink" title="Construct 3（C3）"></a>Construct 3（C3）</h3><p>Construct也是一个非常轻量化的、面向2D的游戏引擎，同样吸引了很多唤境用户；至于原因？因为它们长得像，非常像。同样的事件表系统、无代码编程，同样简单的开发流程，非常相似的编辑器布局，C3是如此吸引唤境用户，以至于几个群友天天在群里宣传C3：<br><img src="/../_resources/fa3d9e94bab7a72dae08a252b5684cf2.png" alt="fa3d9e94bab7a72dae08a252b5684cf2.png"><br><img src="/../_resources/ac5a561a197a692853ae9717722e1b22.png" alt="ac5a561a197a692853ae9717722e1b22.png"><br><img src="/../_resources/fef4ca043318da60e84372fb40243e78.png" alt="fef4ca043318da60e84372fb40243e78.png"></p><p>虽然我个人确实挺喜欢这个界面的，但是在定价方面我可以说非常不喜欢C3的做法：</p><ul><li>官网许可证页面：<a href="https://www.construct.net/en/make-games/buy-construct">https://www.construct.net/en/make-games/buy-construct</a></li><li>游戏事件限制：免费版50条，付费版无限制</li><li>图层限制：免费版2个，付费版无限制</li><li>特效支持：免费版2个，付费版无限制</li><li>多人游戏、自定义加载屏、广告、导出到Windows&#x2F;安卓&#x2F;iOS以及非常多其他功能：仅付费版可用</li><li>商用限制：免费版不允许商用</li></ul><p>至于价格本身其实不算贵，个人许可证一年99CNY，官方支持中文，但一没有永久许可证，二免费版的功能限制太严重，三仍然不能完全离线运行（免费版可以，付费版每周必须联网检查一次许可证有效），因此C3并不是我会选择的引擎。但对于很多唤境用户而言，C3仍然是值得考虑的选项。</p><h3 id="GDevelop（GDE）"><a href="#GDevelop（GDE）" class="headerlink" title="GDevelop（GDE）"></a>GDevelop（GDE）</h3><p>某种程度上来说，GDE和C3具备可观的相似度，也因此与唤境具备一定相似度。相比C3而言，GDE自身就提供网页版编辑器，用GDE开发的游戏也是原生运行在浏览器中，因此引擎的使用体验与唤境相似度非常高，还提供了更多的灵活性。GDE同时支持2D和3D，使用一套与唤境相似但自由度更高、更复杂的事件系统，同样具有一个非常活跃的社区以及大量的社区贡献内容。</p><p>定价方面，GDE引擎是开源的，但也具有一套良好的订阅机制。免费版具备开发游戏的所有基础功能（但不包括像AI功能这种），付费版定价从5.5到33美元&#x2F;月，提供更多的外部功能（例如项目协作、自定义排行榜样式等）。</p><p>GDE也是我最终选择迁移到的引擎（虽然此后可能会继续学习Godot），更具体的使用体验和评测在下文。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总结表格如下，其中推荐度指的是作为唤境开发者而言，我认为迁移到这个引擎有多大的价值。</p><table><thead><tr><th align="left">引擎</th><th align="center">使用经历</th><th align="center">商用许可</th><th align="right">综合推荐度</th></tr></thead><tbody><tr><td align="left">Godot</td><td align="center">约1周</td><td align="center">开源&#x2F;完全免费</td><td align="right">⭐⭐⭐⭐⭐</td></tr><tr><td align="left">Unity</td><td align="center">约1个月</td><td align="center">付费商用</td><td align="right">⭐⭐⭐⭐</td></tr><tr><td align="left">GDevelop</td><td align="center">约1周</td><td align="center">开源&#x2F;免费商用&#x2F;功能付费</td><td align="right">⭐⭐⭐⭐</td></tr><tr><td align="left">虚幻4&#x2F;5</td><td align="center">虚幻4，约1个月</td><td align="center">付费商用</td><td align="right">⭐⭐⭐</td></tr><tr><td align="left">Construct 3</td><td align="center">无</td><td align="center">免费功能限制&#x2F;付费商用</td><td align="right">⭐⭐⭐</td></tr><tr><td align="left">Game Maker Studio</td><td align="center">无</td><td align="center">付费商用</td><td align="right">⭐⭐</td></tr><tr><td align="left">RPG Maker</td><td align="center">无</td><td align="center">付费使用&#x2F;商用</td><td align="right">⭐</td></tr></tbody></table><h2 id="为什么选择GDevelop？"><a href="#为什么选择GDevelop？" class="headerlink" title="为什么选择GDevelop？"></a>为什么选择GDevelop？</h2><p>在回答这个问题之前，首先简述一下我是怎么找到GDE的；实际上就是我在必应中搜索开源游戏引擎，然后在一条CSDN博客文章中看到的。简单了解过后，我认为这个引擎能够完全符合我的需求和预期，随即开始学习使用。</p><p>选择开源引擎并非出于某种“程序洁癖”，而是因为开源的游戏引擎几乎就保证了离线可用性，无论是继续开发游戏还是导出游戏，基本都可以脱离官方在线服务而使用。</p><h3 id="入坑前准备"><a href="#入坑前准备" class="headerlink" title="入坑前准备"></a>入坑前准备</h3><p>官方网站：<a href="https://gdevelop.io/zh-cn">https://gdevelop.io/zh-cn</a><br>首先访问GDE官网，官方已支持大部分中文翻译（引擎内99%，但不包括社区扩展），有完整的许可证对比、文档和手册、游戏展示、社区等页面，还可以一键直接打开网页版编辑器，立刻就能体验引擎。</p><p>Github仓库：<a href="https://github.com/4ian/GDevelop">https://github.com/4ian/GDevelop</a><br>随后找到引擎源码仓库，一个非常优雅和标准的现代化开源项目，活跃度虽不及真正的大型项目，但一直维持稳定的热度，平均一天有6-12个PR，其中过半都能合并，可以说开发和维护情况仍然是非常积极的。</p><p>YouTube频道：<a href="https://www.youtube.com/@GDevelopApp">https:&#x2F;&#x2F;www.youtube.com&#x2F;@GDevelopApp</a><br>平均更新频率为月更2个视频，大部分是各类教程，少数宣传视频和游戏展示。播放量不大，多数都在5K~2W之间。与唤境的“网课”风格不同，这里的视频风格很多是作为一个真实开发者的视角进行的，演讲人会在视频中犯错，随后解释为什么会出错以及如何修复。不过虽然趣味性和互动性增强了，这种“在线试错”也更能留下深刻印象，但对于需要快速找到需求教程的情况来说就不太友好。但好在官网的文档相对完善，搜索功能也很好用（不过只有英文，可能需要用一下翻译）。</p><h3 id="GDevelop初体验"><a href="#GDevelop初体验" class="headerlink" title="GDevelop初体验"></a>GDevelop初体验</h3><p>在下载引擎后，通常还需要注册一个账号；虽然不登录也完全可以正常使用，但有些界面会跳出订阅弹窗。</p><p>不过，这里就是第一个问题所在了；官网虽然连接慢，但一旦访问进去就能正常使用了，而编辑器内我<strong>完全无法登录账号</strong>，也无法下载各类资产商店的资源，最终必须魔法上网才能解决。好在并非强制要求登录或在线使用，因此也并无大的影响。</p><p>启动引擎后，我首先打开了一个教程项目，随后立即感受到扑面而来的熟悉感：跟唤境真的非常相似。折腾了一会教程项目后，我很快就开始翻阅文档，了解事件表、扩展、图层等的使用。在创建了第一个移植项目后，我马上就开始着手写自己的扩展（虽然最后发现并没啥用），但是在其中我找到的功能自由度完全超出我的想象。</p><h3 id="真正的推荐理由"><a href="#真正的推荐理由" class="headerlink" title="真正的推荐理由"></a>真正的推荐理由</h3><p>回到正题，为什么我选择GDE并且也推荐它？排除与唤境相似、免代码编程等因素，这里还有我发现的很多很酷的方面。</p><ol><li><p>可移除的logo和水印<br> 之前使用唤境的时候，很多人都针对游戏启动画面、加载界面等提出请求，希望官方提供一个自定义logo功能，即便是要付费使用也行；这方面我完全同意，唤境的加载页面图片真的不好看，而且总有种我花时间做游戏，结果游戏还没开始就先给引擎打广告的感觉。虽然我喜欢并且支持唤境，但这方面我保留我的意见。<br> 然而，在GDE中，引擎不仅提供了完全可自定义的加载背景图，还可以手动选择是否展示水印和引擎logo。默认情况下二者都会显示，效果如下：<br> 启动时显示<br> <img src="/../_resources/e9d87f6fef9a921f55431cc65d5d6588.png" alt="启动时显示"><br> 右下角水印（只会显示约5秒）<br> <img src="/../_resources/af517f26829a3739b3ea3410fa5d5e9a.png" alt="右下角水印（只会显示约5秒）"></p><p> GDE官方的行为是，免费用户需要至少选择一种展示方式，付费用户才能完全去除；但实际上有一个非常简单的方法就能彻底删除logo和水印：</p><ul><li><p>首先打开项目文件夹</p></li><li><p>打开其中的json文件</p></li><li><p>找到loadingScreen和watermark这两项，将展示改为false，如下所示</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json">    ......<br><span class="hljs-attr">&quot;loadingScreen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    ......<br>  <span class="hljs-attr">&quot;showGDevelopSplash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    ......<br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;watermark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    ......<br>  <span class="hljs-attr">&quot;showWatermark&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    ......<br></code></pre></td></tr></table></figure></li><li><p>随后启动引擎，进入属性界面，就能看到两个选项都被移除了，而且除非手动启用，否则引擎不会检查和更正。</p></li><li><p>json里还有更多有意思的选项，可以自己折腾。有些选项甚至可能引擎内都无法完全调整。</p></li></ul><p> 对我而言，这真的是一个非常伟大的设计。实际上，我对这样的行为甚至产生惭愧的感觉，因此我会在我的游戏中加入自己设计的宣传图和感谢页面，或者在真正有能力的时候购买一个许可证来支持开发。</p></li><li><p>在线和离线结合<br> 对于开源引擎而言，官方卖许可证的很大一个卖点就是在线服务，包括AI功能、云项目、资源商店、联机服务器等等，而引擎所有基础功能都能完全离线使用。</p><p> 例如，免费版用户的联机游戏最多支持4人联机（与唤境相同），付费版则似乎没有限制；免费版每天只能发布一个游戏到电脑和安卓（但在官方游戏网站上是无限制的），付费版提高次数的同时也会增加iOS支持。但H5打包是完全免费的，还可以直接生成到本地网页文件，你可以将这个游戏随便发布到任何网站托管平台。更重要的是，官方限制每天一次是通过服务器发布游戏，这跟唤境的做法是一致的，但你仍然可以无限制地自己打包生成PC和安卓客户端，不过需要学习electron等工具的使用。此外，多人游戏的4人限制仅限使用官方服务器时，如果是P2P或者用扩展来支持则不存在限制（或者说取决于游戏开发）。</p><p> 甚至于对浏览器基础功能也有完善的支持，引擎内可以直接打开文件或网址（通常会被浏览器拦截，但客户端一般没问题），允许下载或上传文本内容，读取本地json等等。</p></li><li><p>强大的扩展和社区支持<br> 在开发过程中，各类扩展和来自社区的支持给了我非常大的助力。引擎已有的扩展有上百个，可以自己创建或者导入，也可以在引擎中直接下载。扩展这玩意不好描述，就拿实际例子来吧：</p><ul><li>Noise Generator：一个柏林噪声工具，可以实现类似minecraft的随机地形生成</li><li>Back button：在安卓上运行游戏时，给返回键添加功能支持，而不是直接关闭游戏</li><li>Load images from a URL：从链接加载图片（以前唤境支持过但不知道怎么用，后来删了）</li><li>Dynamic Water：快速创建流体模拟系统</li><li>THNK：完整的联机游戏插件扩展，允许P2P、中继和局域网多人游戏</li></ul><p> 以及一些已经被整合进引擎的功能：</p><ul><li>firebase：通过自己的firebase提供一些云服务</li><li>steamworks：与steam的底层兼容性，包括成就、联机、创意工坊、反作弊等steam提供的功能</li><li>gamepad：手柄输入和振动支持</li><li>leaderboards：排行榜系统</li></ul></li></ol><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>这篇文章花了我一整天时间才写完，希望能为从唤境迁移游戏引擎的开发者提供一点帮助，而不是一味地推销我选择的引擎。显然GDE远非完美，但我尽可能描述了我选择的理由，以供参考。</p><p>后续的游戏开发日志也会发布于博客网站，但由于工作原因，游戏开发可能只能作为我的爱好，因此不能保证以后一定会继续学习和开发。但这是一个陪伴我大学四年的爱好，我仍然希望未来可以延续下去。</p><p>衷心祝愿所有开发者顺利完成游戏开发！</p>]]></content>
    
    
    <categories>
      
      <category>爱好</category>
      
      <category>游戏开发</category>
      
    </categories>
    
    
    <tags>
      
      <tag>开发</tag>
      
      <tag>游戏引擎</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【arduino学习笔记】通过批处理向串口发送数据到arduino的坑</title>
    <link href="/blog/arduino_batch_com_comm/"/>
    <url>/blog/arduino_batch_com_comm/</url>
    
    <content type="html"><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>现有编程为需要从串口接收数据进行处理的arduino主板，每次传输内容为3位数字；arduino处理方法为先读取为字符串，再转换为整型变量进行处理。<br>每次从串口接收到有效数据时，arduino需要打开一个LED灯；若后续5秒内没有接收到串口数据，则关闭LED。</p><p>在实际使用时，需要使用批处理先从powershell执行一条命令，将其结果写入文本文件，随后将文件第四行的内容发送到串口上。</p><h2 id="初步方法"><a href="#初步方法" class="headerlink" title="初步方法"></a>初步方法</h2><p>询问bing chat和网上搜索，开始编写脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs batch">@echo off<br>setlocal EnableDelayedExpansion<br>:loop<br>mode COM3 BAUD=96 PARITY=n DATA=8<br>Powershell -command &quot;Get-WMIObject -Query “SELECT * FROM Win32_PerfFormattedData_Counters_ThermalZoneInformation” -Namespace “root/CIMV2” | Select-object Temperature&quot; &gt;temp.txt<br>for /f &quot;skip=3 delims=&quot; %%a in (temp.txt) do (<br>set txt=%%~a<br>goto :nxt<br>)<br>:nxt<br>echo %txt%<br>echo %txt% &gt;COM3<br>:break<br>del temp.txt<br>ping localhost -n 5 &gt;nul<br>goto loop<br></code></pre></td></tr></table></figure><p>这里的<code>mode COM3 BAUD=96 PARITY=n DATA=8</code>就是用于设置串口通信参数的命令，而<code>&gt;COM3</code>是将内容发送到COM3串口上。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>该方法存在一个缺陷，arduino的串口通信模式与这里设定的可能不同（尤其是与IDE的默认模式），导致LED灯无法正常打开。</p><p>这里还有一个奇怪的地方，不知道是不是我代码有问题，每次重新上传烧录代码到arduino之后LED就能正常被批处理打开，但如果断电重连则不行；此外，断电后如果先用IDE通信则LED正常打开，再用批处理发送不能打开，LED保持熄灭；而如果先用批处理发送，则后续再用IDE发送也无法打开LED。</p><h2 id="推测与解决方案"><a href="#推测与解决方案" class="headerlink" title="推测与解决方案"></a>推测与解决方案</h2><p>由于我没有仔细阅读arduino官方reference文档，不是非常了解Serial.available()函数具体是如何动作的；但我的推测是，这个函数在等待串口数据的时候会暂时阻塞机器，这也是半双工串口通信的一个问题。</p><p>至于它如何影响arduino以至于出现这些奇怪的问题？我也不是很清楚，但我找到了解决方案。</p><p>微软官方文档：<a href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/mode">https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/mode</a><br>在仔细阅读了批处理中mode指令控制串口参数的用法后，我进行了一些尝试，并成功解决了问题。</p><p>只需要在<code>mode</code>这一行后面加入<code>DTR=OFF RTS=OFF</code>即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs batch">mode COM3 BAUD=96 PARITY=n DATA=8 DTR=OFF RTS=OFF<br></code></pre></td></tr></table></figure><p>这是什么原因呢？我猜测批处理默认情况下会通过DTR和RTS信号来决定何时发送数据。这两个信号是串行通信中的控制信号，前者用于计算机向arduino发出信号，让arduino准备好接收；后者用于arduino向计算机回馈信号，允许计算机发送串口数据。</p><p>但这样的过程会浪费很多等待时间，相当于双方要完成握手才能发送数据（类比TCP连接）；而整个握手和等待的时间内arduino都处于阻塞状态，LED就处于熄灭状态。</p><p>因此，在手动关闭了DTR和RTS信号后，计算机便无需等待arduino响应即可发送数据，arduino也无需等待连接建立，计算机可随时向arduino发送数据（类比UDP包），进而大幅节约了进程时间，使得arduino不再一直处于阻塞状态，LED可以正常点亮。</p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>arduino</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
      <tag>开发</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>唤境引擎源程序下载 分享</title>
    <link href="/blog/evkworld_prog_share/"/>
    <url>/blog/evkworld_prog_share/</url>
    
    <content type="html"><![CDATA[<h2 id="唤境引擎源程序下载-分享"><a href="#唤境引擎源程序下载-分享" class="headerlink" title="唤境引擎源程序下载 分享"></a>唤境引擎源程序下载 分享</h2><p>唤境引擎已经在官网和steam下架，目前无法找到官方安装包；我手上暂时也没有，不过刚才发现唤境主程序是独立程序，无需安装也能运行。<br>使用方法：下载文件，解压全部内容，打开<code>evkworld\hub</code>文件夹，双击运行<code>evkhub.exe</code>。将此文件在桌面创建一个快捷方式，可方便后续使用。</p><h3 id="下载链接："><a href="#下载链接：" class="headerlink" title="下载链接："></a>下载链接：</h3><p><strong>2024&#x2F;9&#x2F;14更新：唤境已推出单机版引擎，请前往官网下载新版本</strong><br><strong>官网链接：<a href="https://www.evkworld.net/">https://www.evkworld.net/</a></strong></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>未分类</category>
      
    </categories>
    
    
    <tags>
      
      <tag>开发</tag>
      
      <tag>游戏引擎</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>长沙理工大学校园网共享观察与方案</title>
    <link href="/blog/CSUST_network_sharing/"/>
    <url>/blog/CSUST_network_sharing/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>时隔几个月，CSUST的网络系统又经过了几次更新。由于情况愈发离谱，因此以后只提供情况观察和记录，不再尝试给出解决方案。如果实在需要的话，本文结尾会有一个简单方法，但显然不会是免费的。</p><h2 id="现在的校园网现状"><a href="#现在的校园网现状" class="headerlink" title="现在的校园网现状"></a>现在的校园网现状</h2><p>其实没啥大变化，以前用的portal认证、IP-MAC-账号的绑定规则等等都是一样的。不同之处在这里：<br><img src="/../_resources/ac3519877ff1e44359bd043568cfce37.png" alt="ac3519877ff1e44359bd043568cfce37.png"><br>图：学校防火墙主动屏蔽了我的网络长达30分钟<br>没错，新增了一个完善的共享锁定页面，让你知道自己为什么用不了网络了。</p><h2 id="最初事件经过"><a href="#最初事件经过" class="headerlink" title="最初事件经过"></a>最初事件经过</h2><p>10月23日晚上约10点50，我正在用手机看视频，忽然手机提示我网络不可用。</p><p>开始排查问题：<br>1.用路由器长时间联网本身不稳定，偶尔掉线是正常现象；但在重连、重启路由器后仍然失效。<br>2.虽然做了80端口加密代理，但在偶然情况下也会触发检测；于是用手机登录校园网、路由器再重新登录，仍然无法解决。<br>3.手机重新连接校园网时弹出上图，告知检测到共享行为。</p><p>一些细节：<br>1.今晚8点半左右我临时关闭了加密代理，不过在10点左右重新启用。<br>2.在检测发生时，我正在使用SS机场看YouTube视频；理论上来说这里流量不仅不是80端口、不是http流量，其数据包更是完整地被SS加密过，那这个检测事件就十分可疑了。<br>3.这个检测的跳转网页是校内未知服务器的页面，而不是认证服务器页面。</p><p>事后：我做了一些更改，并且持续监控网络情况至11点50以后。<br>1.我将加密代理的端口从80改为全部，并且启用了UDP转发，以便所有流量均经加密穿透。<br>2.按以前校友博客文章的方法加入防火墙规则，屏蔽侵入式检测。<br>3.关闭路由器在8080端口上允许外网访问的功能，取消路由器响应ping的能力。<br>直到目前，即使我换用2部手机持续使用也没有被再次检测。</p><p>一些猜想：<br>1.由于最可疑的地方是检测发生时我的网络行为，此时我的流量仅有2个：一是服务器正在使用百度网盘（大概率没有在下载文件，而仅是被百度割韭菜当PCDN在上传），二是手机通过SS机场看油管视频。我的第一反应就是学校防火墙（School FireWall，以下简称SFW）能够检测到SS流量并进行屏蔽。这不是什么新鲜技术，SS是最早一批绕过GFW的协议，其包特征很明显，利用被动的熵检测和主动重放攻击就能快速检测出SS流量和服务器。但是当我将全部流量均通过SS加密穿透SFW时，至少50分钟内没有受到第二次屏蔽。<br>2.随后考虑，使用443端口的https流量虽然经过了TLS加密，但其初次握手过程通常是明文，且TLS数据包本身包含有明文信息。因此，如果SFW今晚额外部署了针对https流量的检测规则，那么我的方案显然是完全无法应付。<br>3.由于我同时做了很多激进的防御措施，其他检测方法也可能出现。例如任何连接到校园网的人都可以访问我的IP、8080端口，然后就是一个登录页面，几乎可以立即判断这是一台路由器而非普通设备。<br>4.最后想想，还有一种可能是DNS探测。这几天chrome一直在某个网站上弹窗提醒我网址可能被篡改，网上搜出来的信息大多指向DNS污染；但我用的是公共DNS，同时路由器上的SS也自带了dnsproxy防止污染，所以这事有点奇怪。但是现在想来，我并没有使用任何DoH和DoT，所有DNS请求都是明文发送，这样只要抓个包就能快速分析出源设备的类型是否单一。我也是在配置的时候考虑到这一点的可能性，因此为SS启用了UDP转发和DNS重定向。<br>（补充：刚才想起来，SS里的UDP转发默认不转发53端口以避免DNS失效，其实也就意味着我的DNS目前仍然是原状态；但这么久了都没有发生检测事件，说明这种方法要么不可行要么没有配置）</p><h2 id="后续观察和更新"><a href="#后续观察和更新" class="headerlink" title="后续观察和更新"></a>后续观察和更新</h2><p>最近几天，又遇到多次屏蔽问题，并在过程中总结了一些经验和应对措施。<br>以下内容完全由个人经验总结而成，不保证准确性。<br>可以确定的是，检测的方式不止80端口的http报文UA字段一种了。目前我认为存在的检测规则包括：80端口报文UA，443端口https报文，UDP检测（webRTC是首要怀疑目标），TTL检测。</p><ol><li>在80端口的检测已经是老生常谈了，不多说；用个修改UA的路由器插件就能解决。</li><li>在443端口传输的https报文都是加密的，我猜测可能是通过目标服务器判断的；我不知道UA在不在明文内容里，但https流量本身不会完全加密整个数据包，至少目标服务器地址不在https加密内容中；因此假如说一台设备同时连接了Windows和vivo的保活服务器，则可以证明共享行为。</li><li>UDP检测，这个源于我两次使用永劫无间的语音通话功能时被屏蔽的经验。同样的，我不确定这个游戏是否使用webRTC传输语音数据，但UDP检测应该是存在的。不过应该与DNS无关。</li><li>TTL检测，这个是最近几天新（重新）增加的。由于安卓和Windows设备的默认TTL值不同，因此检测这个可以肯定地判断共享行为。之前一直没有这个问题的，是最近几天经过多次尝试后发现新增的。</li></ol><h2 id="我自己的解决方法"><a href="#我自己的解决方法" class="headerlink" title="我自己的解决方法"></a>我自己的解决方法</h2><p>前三个没啥好办法解决，我的做法是使用一台位于深圳的公网服务器来做代理，将内网流量加密后经代理上网。由于我的电脑是需要首先保证网络性能的设备，因此路由器中设置电脑的MAC绕过代理。<br>具体步骤如下：</p><ol><li>参考<a href="https://www.librehat.com/three-minutes-to-set-up-shadowsocks-server-on-windows/">https://www.librehat.com/three-minutes-to-set-up-shadowsocks-server-on-windows/</a>搭建好SS服务器。</li><li>按图配置好路由器上的SS：</li></ol><p><img src="/../_resources/03c88091d962b8ef4182999240f61fa7.png" alt="03c88091d962b8ef4182999240f61fa7.png"><br>按照服务端配置来设置SS，加密方式建议使用chacha20，这个是我测试下来在稳定性和速度之间完美平衡的方式。</p><p><img src="/../_resources/5a47300ca260a99ba7eae7697533db68.png" alt="5a47300ca260a99ba7eae7697533db68.png"><br>转发端口建议全部设置，UDP转发里手动填写所有53流量的原因是提高性能。由于国内很多网站会有CDN，并且根据查询DNS的位置返回最近的CDN地址，可能会导致流量从湖南流向深圳再转发回湖南，进而大幅影响性能。这样转发DNS流量后，网络速度会有部分提升。<br>（tips：米家游戏是非常毒瘤的存在，如果要下载原神，那么无论怎么设置总有大概率是只能跑到3M&#x2F;s的速度，这个没办法解决，只能暂时关闭SS或者配置绕过规则，只需要确保这段时间内其他设备不联网即可；）</p><p><img src="/../_resources/2a80f51b8e22940f1ca4e61f2c8a126d.png" alt="2a80f51b8e22940f1ca4e61f2c8a126d.png"><br>在下面的LAN转发中填写需要绕过SS（不经过代理）的MAC地址。使用IP也可行，但需要绑定好静态IP，并且IP控制的性能似乎比MAC差一点。</p><p>全部完成后应用，启用SS即可。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>这个方法目前唯一的问题是，路由器每次重启后会先联网再启动SS，这两个动作之间间隔时间较长，在这个2-3分钟的窗口期内容易被检测和封禁（尤其是晚高峰时段，我的路由器可能固件有点不兼容经常自己重启，如果正好是晚上那么大概率立刻被封）</p><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>没有结尾，这个对抗会一直持续下去，直到我离开学校。</p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>网络工程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络</tag>
      
      <tag>长期更新</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【依露希尔：星晓】PC端如何设置高帧率（和性能优化）</title>
    <link href="/blog/HEII_high_fps/"/>
    <url>/blog/HEII_high_fps/</url>
    
    <content type="html"><![CDATA[<h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><p>不想看前面的内容直接跳转到页面底部即可。</p><h2 id="关于游戏"><a href="#关于游戏" class="headerlink" title="关于游戏"></a>关于游戏</h2><p>游戏官网：<a href="https://game.bilibili.com/ylxe/">https://game.bilibili.com/ylxe/</a><br>《依露希尔: 星晓》，b站游戏，类自走棋&#x2F;SRPG（不知道怎么说，但很多同类游戏，总之就是放几个角色上去它会自己打，然后你可以控制放技能啥的）。<br>我11月中旬在tap上看到的，当时抱着试一试的想法玩，然后目前已经加入我的快餐手游每日豪华套餐（</p><p>这游戏让我玩下来的直接原因是游戏素质，虽然跟市场前列肯定有不少差距，但这游戏的硬素质是过关的。这个玩法本身没啥新意，同类游戏随手找一堆；但其他游戏基本上都是Live2D或者spine平面动画，战斗也是Q版（chibi）小人，而这个则是全3D的设计；因此用3D来玩2D玩法，就会给人一种厚积薄发的感觉，在剧情CG、角色表现张力等方面就会更深入。<br>不过，要说的话，能让我坚持玩下来的根本原因还得是PC端。现在的市场大家也清楚，各路国内厂商全都在做手游，而我刚好又是那批只会用电脑的迂腐的人。所以我选手游的一大标准就是有没有PC端，如果没有，大概率就不会继续玩下去了。<br>好在这个问题其实也没有我想象中的那么明显，近期找的五六个游戏里只要有官网的，基本都会提供PC端。虽然官网都自降身份说是“官方模拟器”，但实际上都是原生打包的PC程序。</p><h2 id="游戏文件分析"><a href="#游戏文件分析" class="headerlink" title="游戏文件分析"></a>游戏文件分析</h2><p>因为这些都是unity游戏，所以游戏本体就不分析了，unity打包出来基本大同小异，这里主要分析启动器行为。<br>游戏安装后的文件夹内容如下：<br><img src="/../_resources/169637a25f93cc558eb9da00fa95397d.png" alt="169637a25f93cc558eb9da00fa95397d.png"><br>其中Games就是unity打包的文件夹，License是一些开源许可证，里面包含了7zip、curl和dulilib（网易开发的UI框架）。<br>根目录中直接存在的也有7z和sqlite3.dll，前者用于解压文件，后者是一个数据库，估计是用来跟踪和校验下载文件的。下面两个就是启动器主程序和其卸载程序。</p><p>打开启动器，看到如下界面：<br><img src="/../_resources/627279705c50fdb3a840264a2f8bcc9a.png" alt="627279705c50fdb3a840264a2f8bcc9a.png"><br>右上角的设置按钮没有用，点开是配置要求。<br>（吐槽一下，这游戏的性能优化做得很差，我的残血3060在大厅界面只能跑63-67帧，游戏界面虽然90fps但占用率也是满的，就离谱）</p><p>这个启动器也没啥可看的，左下角的版本号只会在游戏大更新时更换，右下角一个开始游戏的按钮，实际上就是一个start命令。跟米家游戏一样，除了大更新时游戏无法完成热更新才需要启动器，平时这玩意就是一摆设。</p><h2 id="游戏设置界面"><a href="#游戏设置界面" class="headerlink" title="游戏设置界面"></a>游戏设置界面</h2><p><img src="/../_resources/bbbe9525657e884da09ab6aa27efb574.png" alt="bbbe9525657e884da09ab6aa27efb574.png"><br>真正有用的就这几个，图像质量只能在这几个选项里全局控制，下面的帧率只有30、45和60，垂直同步的性能很差不建议使用（但不开会撕裂，建议在显卡控制面板里启用“快速”垂直同步）。</p><h2 id="如何设置高帧率"><a href="#如何设置高帧率" class="headerlink" title="如何设置高帧率"></a>如何设置高帧率</h2><p>由于启动器与米家游戏的高度相似性，以及游戏都是unity引擎，因此参考隔壁某铁路建设游戏的做法，直接进注册表找。<br>注册表路径非常简单，直接进入<code>计算机\HKEY_CURRENT_USER\SOFTWARE\bilibili\依露希尔：星晓</code>，里面就是游戏的注册表位置了。<br>按下图，找到PCFrameRate开头的表项，改成十进制然后将60修改成你的目标帧率（不建议超过显示器刷新率）<br><img src="/../_resources/e635115d8d5b024a666d9cc8299cee6e.png" alt="e635115d8d5b024a666d9cc8299cee6e.png"><br>改完后点确定，重启游戏，游戏应该已经能在高帧率下运行。如果没有，检查游戏设置里的帧率选项。</p><p>好了，本期的教程就到这里，大家有什么想对小编说的都可以在评论区留言，我们下期再见（？</p>]]></content>
    
    
    <categories>
      
      <category>娱乐</category>
      
      <category>其他游戏</category>
      
    </categories>
    
    
    <tags>
      
      <tag>游戏</tag>
      
      <tag>教程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>博客站点更新！</title>
    <link href="/blog/blog_site_change/"/>
    <url>/blog/blog_site_change/</url>
    
    <content type="html"><![CDATA[<h2 id="本站已完成迁移、更新和重置！"><a href="#本站已完成迁移、更新和重置！" class="headerlink" title="本站已完成迁移、更新和重置！"></a>本站已完成迁移、更新和重置！</h2><p>欢迎访问全新的博客！<br>站点即将重命名，敬请期待！</p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>日志</category>
      
    </categories>
    
    
    <tags>
      
      <tag>开发</tag>
      
      <tag>测试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PSV模拟器vita3k完全教程</title>
    <link href="/blog/Vita3k_tutorial/"/>
    <url>/blog/Vita3k_tutorial/</url>
    
    <content type="html"><![CDATA[<h1 id="本文未完成"><a href="#本文未完成" class="headerlink" title="本文未完成"></a>本文未完成</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近想玩PSV游戏了，但是一来手上没有设备，二是PSV原生的游戏体验不见得就很好（分辨率544P）。那么看着手上的Windows PC，自然是来折腾模拟器了。</p><h2 id="vita3k入门"><a href="#vita3k入门" class="headerlink" title="vita3k入门"></a>vita3k入门</h2><p>vita3k是一个开源、免费的PS Vita模拟器，是目前市面上（大概）唯一真正可用的PSV模拟器。</p><h3 id="相关网址"><a href="#相关网址" class="headerlink" title="相关网址"></a>相关网址</h3><p>官方网站：<a href="https://vita3k.org/">https://vita3k.org/</a><br>游戏兼容性列表：<a href="https://vita3k.org/compatibility.html">https://vita3k.org/compatibility.html</a><br><em>以上两个网站似乎使用了谷歌的ajax，国内可能直连不上，会导致文字和内容无法加载等问题；使用魔法可以解决</em></p><p>下载链接：<br>Windows：<a href="https://github.com/Vita3K/Vita3K/releases/download/continuous/windows-latest.zip?time=1688728168579">Github Release</a><br>安卓：<a href="https://github.com/Vita3K/Vita3K-Android/releases/">Github Release</a></p><p>Github仓库：<a href="https://github.com/Vita3K/Vita3K">https://github.com/Vita3K/Vita3K</a><br>Github兼容性报告页（issue）：<a href="https://github.com/Vita3K/compatibility/issues">https://github.com/Vita3K/compatibility/issues</a><br><em>提示：在vita3k程序内可以快速创建兼容性报告，无需自己创建issue</em></p><h3 id="游戏ROM资源下载处："><a href="#游戏ROM资源下载处：" class="headerlink" title="游戏ROM资源下载处："></a>游戏ROM资源下载处：</h3><ul><li><p>国内整理</p><ul><li>都是百度网盘下载，如果只下汉化游戏的话开一个优化速率模式其实很快（百兆跑满），但是其他语言的大多很慢</li><li>老男人游戏网（需要付费注册，价格非常低可以考虑购买）：<a href="https://www.oldmanemu.net/%e6%8e%8c%e6%9c%ba%e6%b8%b8%e6%88%8f/psv">www.oldmanemu.net/掌机游戏/psv</a></li><li>ROM猎人：<a href="https://www.yang2000ling.com/#/">www.yang2000ling.com/#/</a></li><li>ROMS乐园：<a href="https://www.roms.fun/vita/">www.roms.fun/vita</a></li><li>其他各种贴吧论坛等零散位置不一一列举</li></ul></li><li><p>NoPayStation（推荐）</p><ul><li>无需科学上网；</li><li>这个网站的原理是从PS官方服务器里直接获取下载链接，因此不会受到网盘限速的影响，同时也无需依赖其他用户上传，因此资源非常全面；缺点就是没有自制游戏和民间汉化版等</li><li>网址：<a href="https://nopaystation.com/browse">nopaystation.com&#x2F;browse</a></li><li><strong>下载时，pkg和work.bin文件都要下载</strong></li></ul></li></ul><h3 id="安装前提示"><a href="#安装前提示" class="headerlink" title="安装前提示"></a>安装前提示</h3><p>vita3k确实支持安卓设备，但不要指望它能正常工作；基本上能正常运行的游戏只有5%甚至更少，每个设备的表现也不一致，因此<strong>不建议使用安卓设备</strong>模拟PSV。如果有这个需求，可以考虑用电脑串流游玩。<br>因此，以下教程完全基于Windows版本。<br>在Windows上，vita3k需要的配置也不低；虽然官网没说需要vulkan，但根据实际体验来说<strong>vulkan是必须的</strong>（不用指望OpenGL能跑成啥样，兼容性和性能都有很大问题）。此外，AVX指令集和4-8G内存也是需要的。</p><h2 id="安装软件和固件"><a href="#安装软件和固件" class="headerlink" title="安装软件和固件"></a>安装软件和固件</h2><p>从上面的下载链接、官网或者GitHub里直接下载安装。软件安装也很简单，一路next就行。不过需要注意安装路径里不要带空格和中文，防止出现问题。<br>软件启动后需要安装psv环境，以及需要下载固件；这里直接跟随这篇教程即可（固件也在里面可以下载）：<a href="https://croden1999.github.io/Vita3K-quick-guide/README_USE_VITA3K">croden1999.github.io</a><br>（这个教程其实是挺完整的，但有些地方说明不清晰，所以我写了这篇文章）</p><h2 id="初次启动配置"><a href="#初次启动配置" class="headerlink" title="初次启动配置"></a>初次启动配置</h2><p>安装完成后，打开软件；Vita3K会同时创建两个窗口，一个是命令行终端，另一个是GUI本体。<br><img src="/../_resources/d47d50677f42c898131ec169136675ef.png" alt="d47d50677f42c898131ec169136675ef.png"><br>GUI界面在几十秒不操作就会进入锁屏界面，点一下就能恢复。<br>命令行窗口可以直接最小化不管，但开着可以方便检查运行是否出错。</p><h3 id="自动更新"><a href="#自动更新" class="headerlink" title="自动更新"></a>自动更新</h3><p>软件启动后，首先会自动检查更新，包括兼容性数据库更新和软件本体更新。它们需要连接到GitHub的服务器才能进行，并且<strong>无法通过steamcommunity 302、FastGithub等程序进行加速（如果开着则可能直接失败，因为这些软件是在本地搭建代理服务器，因此没有可信证书）</strong>。<br>当然你可以不管更新，但是软件本体建议要尽量保持最新（可以手动下载然后覆盖文件），因为Vita3K仍然是一个正在积极开发的模拟器，每次更新都可能带来更好的兼容性。<br>兼容性列表更新失败可以忽略，但如果你像我一样有强迫症的话，可以用UsbEAm Hosts Editor找到最佳hosts，然后就可以正常更新了（如图，选raw及用户头像；具体教程网上可以查）<br><img src="/../_resources/9392d904053ae7a67590237d60b5f269.png" alt="9392d904053ae7a67590237d60b5f269.png"><br>最后，如果你的网络环境实在太差，也可以手动更新；<br>兼容性数据库：在<a href="https://objects.githubusercontent.com/github-production-release-asset-2e65be/130765034/0fed046f-f0ef-48ea-91c6-eb46c895dbcb?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A/20230728/us-east-1/s3/aws4_request&X-Amz-Date=20230728T081329Z&X-Amz-Expires=300&X-Amz-Signature=33e26dc786a9f8c9b62494bfe29576442d0b802491dd1bf84c27c67b7ab2c6e0&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=130765034&response-content-disposition=attachment;%20filename=app_compat_db.xml&response-content-type=application/octet-stream">这里下载</a>兼容性列表，然后手动放到<code>vita3k\cache</code>里面，替换掉原有文件即可。<br>软件本体：在<a href="https://github.com/Vita3K/Vita3K/releases/download/continuous/windows-latest.zip">这里下载</a>最新版本的vita3k，把其中所有内容解压到安装目录，替换所有需要替换的文件即可。</p><h3 id="软件界面"><a href="#软件界面" class="headerlink" title="软件界面"></a>软件界面</h3><p><img src="/../_resources/da2c007f9a1c13395a1d1a822800b027.png" alt="da2c007f9a1c13395a1d1a822800b027.png"><br>上方有一排选项按钮，这里就是我们需要主要进行配置的地方。</p><p><img src="/../_resources/f0af051c93c4acb47726e4c4a4e58806.png" alt="f0af051c93c4acb47726e4c4a4e58806.png"><br>下面都是游戏和应用程序列表；如果显示为图中这样的网格模式，则点击<strong>配置-&gt;设置-&gt;GUI，取消勾选Grid Mode即可</strong></p><p>对于列表模式，这里会显示很多信息；从左到右分别是：游戏图标、兼容性指示、ID、版本、类型、最后使用时间、标题名称。（看顶上的那一排按钮，点哪个就可以按哪个排序）<br>兼容性指示是通过颜色进行的，绿色代表可玩，黄色代表可以进游戏但不能正常游戏或通关，灰色表示这个游戏在数据库里没有兼容性信息（也就是未知）。<br>需要注意的是，很多游戏都具有多个区域，例如日版、美版、欧版等，而它们的ID是不一样的；但测试兼容性的用户可能测试的是另一个区域的版本，因此这里显示灰色不代表就一定没有人测试过。<br>因此，对于游戏兼容性，<strong>去官方的兼容性网站里搜索</strong>才是最佳选择。<br><em>剧透：这个兼容性列表的准确性也不高，有些游戏即使说可玩也不见得一定能玩；但更多时候是显示不可玩但实际可以玩，这一般是因为软件更新太快了，测试用户可能是之前的版本</em></p><p>右上角有个刷新按钮，如果是MAI方式安装游戏或手动删除游戏则需要手动刷新列表。</p><h3 id="设置核心内容"><a href="#设置核心内容" class="headerlink" title="设置核心内容"></a>设置核心内容</h3><p>点击配置-&gt;设置，这里有几个地方需要重点关注。<br><img src="/../_resources/290d4db020ec22c325ab4355145752fb.png" alt="290d4db020ec22c325ab4355145752fb.png"></p><ol><li><p>Core<br> 里面是一些模块列表，不用管。</p></li><li><p>CPU<br> 这里可以选择模拟器的CPU后端，Windows上支持Dynarmic和Unicorn两种。前者是默认值；由于Dynarmic的性能和兼容性都比unicorn好很多，不建议修改。<br> 下面还有一个Enable optimizations的选项，这一项通常情况下可以勾选，能提供好一点的性能；但在某些游戏里可能需要关闭才能正常游戏（例如Entwined）。</p></li><li><p>GPU<br> 这里是最重要的设置。<br> 首先可以选择使用哪个API，直接无脑vulkan就行。（即使有些游戏只能在OpenGL下运行，我也不建议妥协，这里的OpenGL性能很差并且有很多bug）。<br> 如果使用vulkan，则可以选择用哪个显卡；这里有独显的选择你的独显。还有一个Disable surface sync，如果勾选则会禁用CPU和GPU之间的同步，能给性能带来很大提升；但少数游戏可能无法运行（实际测试没有发现它影响了任何一个游戏，至少我安装过的没有）<br> Screen Filter里是屏幕缩放方法，Bilinear是双线性缩放，会导致一些像素风游戏失去像素感；换成Nearest（邻近）即可解决。如果需要更好的缩放，可以选择Bicubic（双立方）、FXAA（快速近似抗锯齿）或FSR（这个是我比较喜欢的）。<br> 下面两个滑块，第一个是控制渲染分辨率；默认1x就是原生分辨率960x544，原生的好处就是更不容易出现渲染错误，但画面也比较模糊；使用2x就是1920x1088，在1080P显示器上效果很不错，性能也不会降低太多。第二个滑块是各向异性过滤，这个一般只影响3D游戏，而且比较看个人习惯；我平时开4x，但说实话我的眼睛完全看不出来它有啥用（至少在我玩过的几个PSV游戏里看不出）。<br> 下面还有Use shader cache（使用着色器缓存），启用可以提高性能，但如果游戏渲染有问题可以尝试禁用。最底下是Clean shader Cache and log，点击可以清除着色器缓存，这对于一些兼容性不佳、需要反复尝试各种配置并重启的游戏来说很重要。</p></li><li><p>System<br>  没啥设置，前面是选游戏机的“确认”按钮是用❌键（Cross）还是⚪（Circle），后面的PS TV mode是启用PS TV模式，这个完全不用管。</p></li><li><p>Emulator<br> 另一个比较关键的设置。<br> 第一个选项是游戏以全屏启动，这个对于确认可玩的游戏来说挺方便的，不用每次手动全屏了。<br> 第二个是选择音频后端，可以使用Cubeb或SDL，同时还能选择是否启用NGS支持；这里的配置没有最好一说，不同的游戏可能会需要不同的配置。<br> 下面是一些日志级别、帧率显示、更改模拟目录等，一般不用管。</p></li><li><p>GUI<br> 没啥好调的，就是一些主页显示上的设置。</p></li><li><p>Network和debug<br> 也不用管，Network可能会在联机游戏的时候需要配置，但我确实不想尝试在这上面联网玩游戏（Vita3K官网也说了联机和登录PSN账号是不太可能的）。</p></li></ol><h3 id="游戏独立配置"><a href="#游戏独立配置" class="headerlink" title="游戏独立配置"></a>游戏独立配置</h3><p>右键任意游戏即可打开菜单，里面可以检查兼容性、卸载等。</p>]]></content>
    
    
    <categories>
      
      <category>娱乐</category>
      
      <category>模拟器</category>
      
    </categories>
    
    
    <tags>
      
      <tag>游戏</tag>
      
      <tag>教程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一种基于神经网络的电子音乐风格分类算法思路</title>
    <link href="/blog/ML_emusic_classify/"/>
    <url>/blog/ML_emusic_classify/</url>
    
    <content type="html"><![CDATA[<h1 id="一种基于神经网络的电子音乐风格分类算法思路"><a href="#一种基于神经网络的电子音乐风格分类算法思路" class="headerlink" title="一种基于神经网络的电子音乐风格分类算法思路"></a>一种基于神经网络的电子音乐风格分类算法思路</h1><h2 id="——以zjxdiu常听的电子音乐风格为例"><a href="#——以zjxdiu常听的电子音乐风格为例" class="headerlink" title="——以zjxdiu常听的电子音乐风格为例"></a>——以zjxdiu常听的电子音乐风格为例</h2><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p>一、概述与引言<br>二、电子音乐风格<br>    2.1 主风格<br>    2.2 子风格<br>    2.3 混合风格与其他元素<br>三、现有解决方案<br>    3.1 传统人工分类<br>3.2 特征提取技术<br>3.3 现有机器学习算法<br>    3.3.1 实践项目：DeepAudioClassification<br>四、SRM-DNN（频谱、节奏、情感分析-深度神经网络）思路<br>4.1 电子音乐的频谱特征<br>4.2 鼓与贝斯节奏分析<br>4.3 BPM与时间分析<br>4.4 情感分析<br>4.5 能量分析<br>4.6 实现思路<br>        4.6.1 频谱提取<br>        4.6.2 DnB分析<br>        4.6.3 BPM与时间分析<br>        4.6.4 图像识别<br>        4.6.5 人声分离<br>        4.6.6 情感特征<br>五、总结</p><hr><h2 id="一、概述与引言"><a href="#一、概述与引言" class="headerlink" title="一、概述与引言"></a>一、概述与引言</h2><p>  随着近年来计算机技术的快速发展，机器学习被应用于越来越多的领域。其中，最广泛的应用之一就是执行分类与识别任务，在音乐风格的识别与分类方面，同样有着应用的空间。为此，结合笔者生活中的实际痛点：难以区分部分电子音乐的风格，且现有方案难以准确识别细分风格，而撰写本文，希望以相对专业的视角提供一种新的解决方案。</p><h2 id="二、电子音乐风格"><a href="#二、电子音乐风格" class="headerlink" title="二、电子音乐风格"></a>二、电子音乐风格</h2><p>电子音乐是音乐中的一个大类型，起源于20世纪60年代的欧美地区，是音乐文化中重要的一部分。其曲风特色是注重以节奏和旋律创建舞蹈氛围，主要使用各类合成器作为“乐器”，并具有相对少量的歌词。在约80年的发展过程中，电子音乐衍生、拓展出非常多的细分风格，以下对笔者常听的风格进行简述。</p><h3 id="2-1-主风格"><a href="#2-1-主风格" class="headerlink" title="2.1 主风格"></a>2.1 主风格</h3><p>  zjxdiu常听的电子音乐包括以下几类主要风格：</p><ul><li>House，浩室或浩室舞曲，注重旋律和音色的展现，编曲的格式化比较显著，节奏简单且“软硬”适中；</li><li>Trance，迷幻舞曲，BPM相对House更高一些，鼓点一般位于每个1&#x2F;2 beat上，但较为柔和；snare和hat也在DnB序列中以更高频率出现，每节旋律相似但不重复。整体听感与其名字类似，为“迷幻”。</li><li>Core，核，主要包括Hardcore（硬核）和Frenchcore（法核，也可一并归类为Hardcore），表现为更为强烈的节奏和鼓点，BPM也更高，且对人声的处理更极端；部分早期的Core十分的“硬”，以至于很少人能够承受；而近年的新型core则相对柔软一些，并且对于旋律和人声的体现也更为注重。</li><li>Hardstyle，硬派，其显著特征为bass和drum同时出现，且多使用经失真处理的bassline，由于其独特的DnB听感，时常被开玩笑：“听到duang duang duang就是hardstyle”。其软硬程序介于Core与House之间。</li><li>Hands Up，无中文名，是一种处于Core与Hardstyle之间、更接近Core的风格，其特征为较为快速和低沉的鼓点，且旋律表现力强、与DnB的融合程度高，编曲方面则接近House，在许多Disco舞厅音乐中较为常见。</li><li>Chill Out，弛放音乐，它的特征最为显著，即一反常派的柔和与宁静。通常其编曲较为接近Trance，但使用的音色极为柔软，鼓点和贝斯的响度也很低，BPM通常也较低，听感上呈现“飘渺舒缓的节奏，柔和的合成器音效，空灵的女声吟唱，悠远的环境音”。</li></ul><h3 id="2-2-子风格"><a href="#2-2-子风格" class="headerlink" title="2.2 子风格"></a>2.2 子风格</h3><p>  常见子风格见如下虚表格：<br><img src="/../_resources/7019e2a17be54b2c468752025c2ca3c9.png" alt="7019e2a17be54b2c468752025c2ca3c9.png"><br>  需要注意的是，此处列出的仅为一部分，实际上还可区分为数倍于列表项目数的子风格。</p><h3 id="2-3-混合风格与其他元素"><a href="#2-3-混合风格与其他元素" class="headerlink" title="2.3 混合风格与其他元素"></a>2.3 混合风格与其他元素</h3><p>  对于现代电子音乐而言，一首音乐混合多种风格的做法是十分常见的；例如Hands Up+Hardstyle、Melodic House+Hardstyle、Progressive House+Future House等等。不过对于大多数音乐而言，其主要曲风只会有一种。<br>  此外，部分曲风还会有一些其他元素；例如Midtempo指BPM在约80~120之间的，带人声和歌词的Trance可称为Vocal Trance等。总之，电子音乐的曲风是难以准确、完全判别的，因此可考虑采用标签（label）的方式进行风格判断。</p><h2 id="三、现有解决方案"><a href="#三、现有解决方案" class="headerlink" title="三、现有解决方案"></a>三、现有解决方案</h2><h3 id="3-1-传统人工分类"><a href="#3-1-传统人工分类" class="headerlink" title="3.1 传统人工分类"></a>3.1 传统人工分类</h3><p>  显然，音乐分类可由人工进行；无论是音乐人提供还是听众、鉴赏家提供，都属于人工分类方法。在任何涉及到机器学习与人类学习对比的地方都能得知，人工方法一般有准确率高、复杂任务处理能力强、误报率低、学习速度快且成本低等优点，但其识别速度相比于计算机而言则无法比拟。</p><h3 id="3-2-特征提取技术"><a href="#3-2-特征提取技术" class="headerlink" title="3.2 特征提取技术"></a>3.2 特征提取技术</h3><p>参考文献：<a href="https://www.hindawi.com/journals/wcmc/2021/9298654/">基于音乐特征提取和深度神经网络的音乐风格分类算法</a><br>  对于通常意义上的音乐而言，我们可以通过提取音乐特征进行分析与识别。这些特征包括节奏、旋律、乐器或音色、和弦或和声、人声等内容。通过适当的、已有的算法和模块，可以对这些特征进行单独提取并分析。若加入卷积神经网络，则可获得更为准确的结果。<br>  参考文献中详细介绍了这二者如何融为一体并实际运用，为接下来的算法思路提供了部分理论基础。</p><h3 id="3-3-现有机器学习算法"><a href="#3-3-现有机器学习算法" class="headerlink" title="3.3 现有机器学习算法"></a>3.3 现有机器学习算法</h3><p>  传统的基于机器学习的音频分类大多基于常规算法，例如支持向量机、决策树、K-邻近算法、随机森林算法等等。这些算法的优点是部署和训练简单，算法的数学原理完善，但问题是难以准确处理复杂和细微的变化；尤其是在电子音乐风格分类任务中，由于各风格在许多方面非常相似，传统算法无法很好地处理。<br>  因此，结合使用的技术与特征，提出如下采用神经网络进行识别的识别思路。</p><h3 id="3-3-1-实践项目：DeepAuddioClassification"><a href="#3-3-1-实践项目：DeepAuddioClassification" class="headerlink" title="3.3.1 实践项目：DeepAuddioClassification"></a>3.3.1 实践项目：DeepAuddioClassification</h3><p>  在提出自己的算法思路前，笔者首先实践了一个已有的开源项目：<a href="https://github.com/despoisj/DeepAudioClassification">Github: despoisj&#x2F;DeepAudioClassification</a>；该项目采用tensorflow中的tflearn模块进行DNN训练，并且只对音频频谱进行识别，相当于一个只输入频谱图的图像识别算法。<br>  通过将音频频谱提取出来并切片，随后基于DNN进行图像分类训练，则模型可用于预测一个未知的音乐频谱图。这种方法巧妙地避开了音频数据量过大的问题，因为一般CD音质下44100Hz意味着30秒的音乐就将产生66万个长度的向量。但对于原作者的目的而言，分析大类音乐风格的时候可以直接从频谱入手。根据作者发表的文章<a href="https://medium.com/@juliendespois/finding-the-genre-of-a-song-with-deep-learning-da8f59a61194#.yhemoyql0">Finding the genre of a song with Deep Learning</a> 的描述，只需要每秒50像素的分辨率即可获得满意的效果；在这里，sox提供了很好用的命令行工具，允许我们直接生成灰度频谱图，其中每个像素的x代表时间、y代表频率、亮度代表振幅。切片后使用深度卷积神经网络进行图像训练，最后使用投票机制提高准确率。<br>  但是，这一次实践的结果并不理想。在学习率0.001、分辨率50px&#x2F;s时，经过20个epoch后模型仅能达到55%的准确率（ACC），可以看出识别效果并不理想。这主要是因为参与训练的原始数据包括Trance和Hardstyle两种风格，而它们在梅尔（Mel）频谱图上实际上十分相似，无法准确映射到高维数据集中。</p><h2 id="四、SRM-DNN（频谱、节奏、情感分析-深度神经网络）思路"><a href="#四、SRM-DNN（频谱、节奏、情感分析-深度神经网络）思路" class="headerlink" title="四、SRM-DNN（频谱、节奏、情感分析-深度神经网络）思路"></a>四、SRM-DNN（频谱、节奏、情感分析-深度神经网络）思路</h2><h3 id="4-1-电子音乐的频谱特征"><a href="#4-1-电子音乐的频谱特征" class="headerlink" title="4.1 电子音乐的频谱特征"></a>4.1 电子音乐的频谱特征</h3><p>  首先，我们并不希望创建一个需要A100才能运行的高度资源密集型网络，而是希望该模型能够在消费级硬件上部署和训练。因此，结合实际电子音乐的主要特征区分，我们可以沿用DeepAudioClassification的频谱分析方法。<br>  对于电子音乐曲风分类而言，其频谱图提供的信息量是非常大的，因为几乎每种主类别都有自己特征的DnB序列。这导致了在频谱图中的显著区分，在低频区域尤为明显（见下图）。<br>  截取频谱图时采用的配置：<br>  软件：iZotope RX 7<br>  FFT类型（type）：自动可变短时傅里叶变换（Auto-adjustable STFT）<br>  启用重分配（reassignment）：否<br>  窗函数：海宁窗（Hann）<br>  颜色映射：青色到橙色（Cyan to orange）<br>  频率缩放（Frequency scale）：对数（Log）<br>  高品质渲染（High-quality rendering）：启用<br><img src="/../_resources/c3f2fb4bdc6d6f2789d569c084686d46.png" alt="c3f2fb4bdc6d6f2789d569c084686d46.png"><br>  图：三种风格的电子音乐频谱图对比<br>  本图采用的时间窗口：20s</p><p>  从对比图中可以很明显地看出，不同风格的电子音乐在频谱图中呈现出较为显著的区别；尽管也有相近的风格（如Hands Up和Hardcore），但总体来说，其频谱图能提供主要的风格信息。<br>  既然电子音乐的频谱特征如此明显，为什么DeepAudioClassification项目却无法使用呢？<br>  首先，频谱的选型有误，是最大的问题所在。对于电子音乐而言，由于其风格信息大多位于低频区，因此必须使用低频部分缩放较大的谱图类型。上图中采用的缩放是Log，相比于常用的Mel频谱，它对于低频区有更大的缩放等级，使得低频信息分辨率更高；在实际运用中，该软件还提供了Extend Log（拓展对数）频谱，其低频区的缩放更为显著。<br>  其次，切片数量过多。实践中为尽量减轻硬件负担，对较长的音频进行切片处理；但每个音频切片数为100份，这个设定相对于电子音乐的结构而言太多了。常见的电子音乐由几个类型的分段组成，例如intro、lead、build up、verse、drop、outro等；其风格的定义一般主要从drop中得出，所以若切片过多，则容易破坏每个分段的完整性，不利于风格识别。</p><h3 id="4-2-鼓与贝斯分析"><a href="#4-2-鼓与贝斯分析" class="headerlink" title="4.2 鼓与贝斯分析"></a>4.2 鼓与贝斯分析</h3><p>  电子音乐的风格可以说有一半都由DnB（Drum and bass，鼓与贝斯；这个词同时也是一种类型的电子音乐风格，但本文将其用于指代鼓点+贝斯）决定；无论是鼓点节拍数、编排方式还是贝斯的特征，亦或是二者的侧链水平等，均包含大量的风格信息。<br>  有关如何从音频信号中提取节拍信息，目前已有相关研究成果，包括使用动态编程、神经网络等方法进行识别。参考文献：<a href="https://ieeexplore.ieee.org/document/6734668">Multi-Feature Beat Tracking</a><br>  使用iZotope RX 7提供的工具也可以进行DnB分析，其中的Music Rebalance模块可以准确分离人声、贝斯、鼓点三种信号，为分析提供了有利条件。<br>  <img src="/../_resources/72bfdc72dfb2f21a37e23d8f647da698.png" alt="72bfdc72dfb2f21a37e23d8f647da698.png"><br>  图：RX 7中提供的Music Rebalance组件</p><h3 id="4-3-BPM与时间分析"><a href="#4-3-BPM与时间分析" class="headerlink" title="4.3 BPM与时间分析"></a>4.3 BPM与时间分析</h3><p>  BPM，即Beats per minute，每分钟节拍数。它是音乐的一个重要参数，直接指向音乐的“速度”。尽管在制作电子音乐时，制作人通常不会严格对齐到小节&#x2F;拍的整数倍，但BPM依然能够提供风格信息。<br>  在主风格分析时，仅通过BPM我们即可首先分辨音乐的大致类别；若低于90则可能为Chill Out，90-110可能为House，110-130可能为Trance、Hands Up，130-160可能为Hardstyle或Hardcore等。<br>  在子风格分析时，BPM也有助于进行风格确定；例如在Hardcore中，若难以分辨Frenchcore和UK Hardcore，则可通过BPM辅助判断，若达到了160或更高则更可能为UK Hardcore。<br>  此外，音频的时间长度同样可以作为网络的输入之一，这是因为Hands Up、Hardcore、House和trance、Chill Out等分别呈现了两种倾向，前者一般时长为3分钟左右，而后者最长可达10分钟以上。尽管这种参数的帮助十分有限，但其特征强度还会更高，有助于减少结果的偏离。</p><h3 id="4-4-情感分析"><a href="#4-4-情感分析" class="headerlink" title="4.4 情感分析"></a>4.4 情感分析</h3><p>  所谓情感分析，指的是对人声（和音乐，如果可能）进行情绪的识别与分类。尽管不是所有音乐都有歌词和人声，电子音乐中的人声更是少见，但进行情感分析依然有助于进一步判别细微的风格差异。<br>  不过，这一步的主要目的其实只针对一种风格的音乐，即trance；许多Trance都具有一些人声，即便没有人声，对于音乐本身的情感分析也能够帮助辨别Progressive trance和Uplifting trance。这是因为大部分Uplifting trance都具有一些独特的情感特征：Hopeful，Sentimental，Sad等等；它们具有一个共同的特征，就是uplifting，即鼓舞人心的。可以说，如果一首Trance听着让人想流泪，则多数时候可以确定它一定是Uplifting trance。<br>  参考文献：<a href="https://www.hindawi.com/journals/misy/2022/2715765/">Music Emotion Classification Method Using Improved Deep Belief Network</a></p><h3 id="4-5-能量分析"><a href="#4-5-能量分析" class="headerlink" title="4.5 能量分析"></a>4.5 能量分析</h3><p>  所谓能量分析，是指针对音频每个分片（如每秒）进行电平、响度、频域复杂度等进行分析，从而确定该分片的能量等级。由于电子音乐中每个分段的能量差异较大，intro&#x2F;outro最低、lead&#x2F;build up中等、drop最高，因此对整个音频进行能量分析并在二维数组中呈现，将有助于分析音乐结构。<br>  例如，trance音乐的结构中，各分段能量差异相对较小，drop出现的频次更多；House则一般为intro、lead、build up、drop、verse、build up、verse、outro序列。不过该方法适用性不佳，主要是因为电子音乐的结构变化性大，且目前没有已标签的数据集进行训练，需要人工标记才能进行监督学习。</p><h3 id="4-6-实现思路"><a href="#4-6-实现思路" class="headerlink" title="4.6 实现思路"></a>4.6 实现思路</h3><p>  有了以上理论基础，我们就可以尝试构建这样一个神经网络了。当然，由于笔者的专业是食品安全，本文并不涉及任何实际代码、构建和部署，而仅为提出思路。</p><h4 id="4-6-1-频谱提取"><a href="#4-6-1-频谱提取" class="headerlink" title="4.6.1 频谱提取"></a>4.6.1 频谱提取</h4><p>  这个网络仅涉及频域分析而没有时域处理，因此我们可以直接忽略音频原始采样，而是直接生成其频谱图。<br>  前文实践项目DeepAudioClassification中，使用到了一个命令行工具：sox。它可以输出音频的png频谱图，并且可以直接定义灰度、分辨率等；但其选项中并不能更改频率缩放类型，而默认情况下的Mel频谱图对于电子音乐分类而言效果不佳。因此，我们应该使用其他工具或算法来创建log频谱图。在log频谱图下，一个44100Hz采样率的音频（其最高频率为22050Hz），频谱图的中间位置约为2205Hz。</p><h4 id="4-6-2-DnB分析"><a href="#4-6-2-DnB分析" class="headerlink" title="4.6.2 DnB分析"></a>4.6.2 DnB分析</h4><p>  网络的第二个输入应该为DnB序列；通过前文所述的一些方法，可以获取音乐的节拍序列信息。仅需得知drum（鼓点）的序列即可提供良好的分类所需的信息，而bassline则可通过分析甚低频区的信号得出。<br>  这两个数据在训练时应始终保持时间一致性，即drum和bass不能独立分析；也可考虑混合后输入，或直接从频谱图中再单独提取高分辨率的低频区信号频谱图像进行输入。<br>  可能实现的模块：<a href="https://github.com/MTG/essentia/">Github: MTG&#x2F;essentia</a></p><h4 id="4-6-3-BPM与时间分析"><a href="#4-6-3-BPM与时间分析" class="headerlink" title="4.6.3 BPM与时间分析"></a>4.6.3 BPM与时间分析</h4><p>  这一步是相对而言最简单的，音频时间直接获取duration即可，BPM也可以通过许多python的音频工具库获得。<br>  可能实现的模块：<a href="https://github.com/librosa/librosa">Github: librosa&#x2F;Librosa</a></p><h4 id="4-6-4-图像识别"><a href="#4-6-4-图像识别" class="headerlink" title="4.6.4 图像识别"></a>4.6.4 图像识别</h4><p>  这一步有许多可选的方向，不过仍然可以参考前文实践项目的做法，使用tensorflow提供的tflearn进行图像训练。需要注意的是，为了降低负载，仍然可能需要对频谱图进行分片处理。</p><h4 id="4-6-5-人声分离"><a href="#4-6-5-人声分离" class="headerlink" title="4.6.5 人声分离"></a>4.6.5 人声分离</h4><p>  借助许多工具，包括iZotope RX 7的Center Extract、Music Rebalance或Audition的中置声道提取功能，都可以对音频的人声进行高质量分离。这一步的目的是为后续进行情感分析提供原始文件，并且也可能为音乐情感分析提供良好的无人声音轨。</p><h4 id="4-6-6-情感分析"><a href="#4-6-6-情感分析" class="headerlink" title="4.6.6 情感分析"></a>4.6.6 情感分析</h4><p>  参考文献：<a href="https://www.hindawi.com/journals/misy/2022/2715765/">Music Emotion Classification Method Using Improved Deep Belief Network</a><br>  基于此文献，可以确定DBN网络用于情感分析的可能性。不过目前似乎很少见到相关的模块或库可以直接提供此功能接口的，因此在编程方面可能具有难度。</p><h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2><p>  再次说明，由于作者为食品专业，且对机器学习、计算机等了解很少，本文中可能出现大量不专业、错误术语和概念，其中的部分思路也可能无法实现或已有更好的替代方法。但作者编写本文的原因是希望解决实际问题，现有的音乐分类不够准确和细致、无法区分电子音乐下的各类风格。<br>  如果您有建议、修改提示、想法等，均可直接于评论区留言。人工智能是新兴的热门话题，在时代的风口浪尖上，我们可以共同学习、不断进步，为计算机学习的城墙添砖加瓦。</p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>计算机</category>
      
    </categories>
    
    
    <tags>
      
      <tag>信号处理</tag>
      
      <tag>深度学习</tag>
      
      <tag>音频</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo批处理脚本更新，通过zerotier实现免费简易内网穿透</title>
    <link href="/blog/%E9%9A%8F%E8%AE%B020230501/"/>
    <url>/blog/%E9%9A%8F%E8%AE%B020230501/</url>
    
    <content type="html"><![CDATA[<h3 id="因为不知道写啥，就更新一些以前的东西吧"><a href="#因为不知道写啥，就更新一些以前的东西吧" class="headerlink" title="因为不知道写啥，就更新一些以前的东西吧"></a>因为不知道写啥，就更新一些以前的东西吧</h3><ul><li>Hexo批处理脚本<br>原文：<a href="https://zjxdiu.github.io/blog/%E6%89%B9%E5%A4%84%E7%90%86%E4%BC%98%E5%8C%96Hexo%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">使用批处理和Joplin执行并优化Hexo博客工作流程</a><br>更新脚本内容：<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">setlocal</span> EnableDelayedExpansion<br><span class="hljs-keyword">goto</span> <span class="hljs-built_in">start</span><br>:ac<br><span class="hljs-comment">rem 请设置%targetlable%变量，以确保正常跳转至目标位置</span><br><span class="hljs-built_in">cls</span><br><span class="hljs-built_in">color</span> <span class="hljs-number">0</span>F<br><span class="hljs-keyword">goto</span> <span class="hljs-variable">%targetlabel%</span><br>:<span class="hljs-built_in">start</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%targetlabel%</span>&quot;==&quot;&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">1</span>.【完整】执行完整的检查和推送blog流程<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">2</span>.【快速】快速上载blog<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">3</span>.【预览】本地预览<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">4</span>.单独执行指令<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">5</span>.【标准】执行快速标准推送<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">6</span>.【本地部署】执行标准推送，但部署到本地而非GitHub<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>.<br>choice /c <span class="hljs-number">123456</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">6</span>&quot; <span class="hljs-keyword">goto</span> ldeploy<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">5</span>&quot; <span class="hljs-keyword">goto</span> std<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">4</span>&quot; <span class="hljs-keyword">goto</span> new<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">3</span>&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=local&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=fast&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">1</span>&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=full&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-built_in">pause</span>&amp;<span class="hljs-keyword">exit</span><br>:ldeploy<br><span class="hljs-comment">REM 这一段是部署在本地，也就是复制一遍；可以根据情况改成复制到共享文件夹中</span><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 清理缓存...<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean&quot; &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">echo</span> 生成页面...<br><span class="hljs-built_in">cmd</span> /c &quot;hexo g&quot; &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">echo</span> 复制必要资源...<br><span class="hljs-built_in">cmd</span> /c &quot;<span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y&quot; &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">echo</span> 部署到本地服务器路径...<br><span class="hljs-built_in">cmd</span> /c &quot;<span class="hljs-built_in">xcopy</span> D:\blog\public\ D:\server\blog1\ /e /s /y&quot; &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">echo</span> 上传结束，打开网页中...<br><span class="hljs-built_in">cmd</span> /c &quot;<span class="hljs-built_in">start</span> C:\Users\zjxdiu\Downloads\实时工具\hfs.exe&quot;<br><span class="hljs-built_in">start</span> http://<span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>/<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 完成，按任意键退出...<br><span class="hljs-built_in">pause</span><br><span class="hljs-keyword">exit</span><br>:std<br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 启动本地预览...<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean &amp; hexo g &amp; <span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; <span class="hljs-built_in">start</span> http://localhost:<span class="hljs-number">4000</span>/ &amp; hexo s&quot;<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 上载到远程服务器...<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">cmd</span> /c &quot;hexo d&quot;<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 完成，按任意键退出...<br><span class="hljs-built_in">pause</span><br><span class="hljs-keyword">exit</span><br>:new<br><span class="hljs-built_in">echo</span> 正在创建新的<span class="hljs-built_in">cmd</span>实例...<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 命令提示：<br><span class="hljs-built_in">echo</span> hexo clean<br><span class="hljs-built_in">echo</span> hexo g<br><span class="hljs-built_in">echo</span> hexo s<br><span class="hljs-built_in">echo</span> hexo d<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">start</span> <span class="hljs-built_in">cmd</span><br><span class="hljs-built_in">echo</span> 按任意键返回菜单...<br><span class="hljs-built_in">pause</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac<br>:local<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>                  本地预览模式<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 启动预览...<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean &amp; hexo g &amp; <span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; <span class="hljs-built_in">start</span> http://localhost:<span class="hljs-number">4000</span>/ &amp; hexo s&quot;<br><span class="hljs-built_in">echo</span> 按任意键返回菜单...<br><span class="hljs-built_in">pause</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac<br>:fast<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>                  快速上载blog<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean &amp; hexo g &amp; <span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; hexo d&quot;<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 完成，<span class="hljs-number">2</span>秒后退出...<br><span class="hljs-built_in">ping</span> localhost -n <span class="hljs-number">3</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-keyword">exit</span><br>:full<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>                  完整流程向导<br><span class="hljs-built_in">echo</span>              按<span class="hljs-number">0</span>为确定，按<span class="hljs-number">1</span>为跳过<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-keyword">goto</span> clean<br>:clean<br><span class="hljs-built_in">echo</span> 第一步：清理缓存<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> generate<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean&quot;<br><span class="hljs-keyword">goto</span> generate<br>:generate<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 第二步：生成页面<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> check<br><span class="hljs-built_in">cmd</span> /c &quot;<span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; hexo g&quot;<br><span class="hljs-keyword">goto</span> check<br>:check<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 第三步：本地预览<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> deploy<br><span class="hljs-built_in">start</span> http://localhost:<span class="hljs-number">4000</span>/<br><span class="hljs-built_in">cmd</span> /c &quot;hexo s&quot;<br><span class="hljs-keyword">goto</span> deploy<br>:deploy<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 第四步：上传到远程服务器<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> done<br><span class="hljs-built_in">cmd</span> /c &quot;hexo d&quot;<br><span class="hljs-keyword">goto</span> done<br>:done<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 流程已完成，按任意键返回菜单...<br><span class="hljs-built_in">pause</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac<br></code></pre></td></tr></table></figure></li></ul><hr><ul><li>Zerotier内网穿透<br>网上有一些教程，但是不够简洁易懂，所以写一个。</li></ul><ol><li>进入<a href="https://my.zerotier.com/">官网控制台</a>注册一个账号，可以不用现场注册，直接微软账号登录即可。</li><li>选择 Create A Network</li><li>点击刚创建的网络，进入配置界面<ul><li>Name随便写一个方便你记的名字</li><li>Description是介绍，可以写详细信息，如果以后忘了网络是干啥的可以看这个回顾</li><li>Access Control建议选Private，这样你就拥有完全的管理权限</li><li>下面的IP直接自动即可，或者手动选一个跟你目前局域网IP不冲突的地址段</li><li>IPv6 Auto-Assign根据情况选择，如果你们的网络成员都具有广域网ipv6连接则勾选第一项，否则不管</li><li>最后复制Network ID，就是一串数字和字母组成的字符串，发给你的成员<br>【以上步骤只需要网络管理员进行，成员不需要】<br>【以下内容每个人都要执行】</li></ul></li><li>下载Zerotier：<a href="https://www.zerotier.com/download/">下载链接</a></li><li>安装并从开始菜单里启动</li><li>等任务栏出现程序图标，右键，选择Join New Network</li><li>输入刚才的Network ID，确定<ul><li>如果弹出询问弹窗，例如防火墙、是否启用网络发现等，均允许</li></ul></li><li>等待几分钟，进入系统设置检查IP是否获取成功<ul><li>分配成功说明连接成功，否则继续等待</li></ul></li><li>【重要】任意成员加入网络时，需要进入<a href="https://my.zerotier.com/">官网控制台</a>给成员左侧的Auth打勾，只有打勾的成员才能获取到IP并加入网络，否则无法连接</li><li>在控制台页面可以看到每个人的虚拟局域网IP，这个地址一旦分配就不会自动更改，因此你甚至可以做个DNS记录方便大家记（）</li><li>ping一下成员的IP，确定连接通顺</li><li>完成！现在你们已经相当于在一个局域网里了，只不过游戏房间和服务器可能不会自动查找到，手动输入地址即可。</li></ol><hr><h3 id="查询精神状态"><a href="#查询精神状态" class="headerlink" title="查询精神状态"></a>查询精神状态</h3><p>最近玩LLM有点上瘾，推荐一个chatGLM项目<a href="https://github.com/THUDM/ChatGLM-6B">Github地址</a>，可以部署在本地运行的对话机器人，这个62亿参数的模型只需要6G显存就能运行（当然，是N卡），可以说非常好玩了（）</p><p>还想换个主题，或者再开一个功能更全面一些的，这个极简博客就当正式文章和简历发布地点。<br>就这样吧，最近作业很多但是都写完了，没有压力就没有折腾的欲望和动力(T_T)</p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>生活</category>
      
    </categories>
    
    
    <tags>
      
      <tag>日常</tag>
      
      <tag>开发</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dynv6使用技巧（如何添加多个地址 子域名 等）</title>
    <link href="/blog/dynv6_notes/"/>
    <url>/blog/dynv6_notes/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为ipv6普及度日益增加，在自己的环境里搭建简易服务器的想法就逐渐发芽；无论是用于博客网站、NAS或私有云的搭建，还是用来开游戏服务器，都能够简单易行地实现（因为有公网ipv6）。<br>不过，很多时候家庭环境下ipv6地址也会发生变化，尤其是电脑重启、宽带重拨的时候，那么如何在没有固定ipv6的情况下让别人能更容易找到我们的地址呢？很简单，当然是用DDNS了。<br>DDNS，也就是动态DNS，将一个变化的IP绑定到域名上，通过脚本定时检测和更新地址，这样即使地址变化，域名解析出来的地址也会跟着变化，仍然可以使用同一个域名定位到同一个地址。</p><h2 id="使用dynv6"><a href="#使用dynv6" class="headerlink" title="使用dynv6"></a>使用dynv6</h2><p>官网：<a href="https://dynv6.com/">https://dynv6.com/</a><br>首先用邮箱注册一个账号，接着进入My Zones，点击Create New Zone，在Name里输入你想要的网址名称和后缀类型，下面的地址可以先点击Set current address，这样网页就会填入你的外网IP地址（应注意检查，ipv4基本不会是跟电脑一致，但ipv6需要一致）。<br><img src="/../_resources/8007661dd2ee4a33be77ca500ec41a76.png" alt="8007661dd2ee4a33be77ca500ec41a76.png"></p><p>点击创建后，若网址没有冲突，则创建成功；直接点击这个域名，上面有两个选项是可以自己修改的：status和records。</p><h2 id="创建DNS记录"><a href="#创建DNS记录" class="headerlink" title="创建DNS记录"></a>创建DNS记录</h2><p>在Status里，点击Edit Zone，将ipv6地址再次设为你的公网ipv6并保存，这样主域名就会直接解析到你的电脑上；<br>在Records里，可以编辑或删除现有的AAAA记录，也可以新增其他DNS记录。</p><h3 id="创建子域名"><a href="#创建子域名" class="headerlink" title="创建子域名"></a>创建子域名</h3><p>点击Add Record，选择AAAA类型（A是ipv4，AAAA是ipv6，CNAME是网站别名一般用不到），前面的name里填写子域名前缀（比如我要创建web.domainname.dynv6.net，那就在这里写web），后面的地址里填写目标ipv6即可。</p><hr><h2 id="设置DDNS自动更新"><a href="#设置DDNS自动更新" class="headerlink" title="设置DDNS自动更新"></a>设置DDNS自动更新</h2><p>提示：建议将此脚本部署于Windows服务器上，而非自己的电脑</p><h3 id="下载wget和grep"><a href="#下载wget和grep" class="headerlink" title="下载wget和grep"></a>下载wget和grep</h3><p>网上很多教程，这里列两个：<br><a href="https://www.cnblogs.com/shenxiaolin/p/16662793.html">windows下grep的安装与使用</a><br><a href="https://www.jianshu.com/p/a8dfc762ba3b">win10安装wget</a><br>记得检查好环境变量，确定cmd下运行这两个命令有输出。</p><h3 id="下载instsrv-exe和srvany-exe"><a href="#下载instsrv-exe和srvany-exe" class="headerlink" title="下载instsrv.exe和srvany.exe"></a>下载instsrv.exe和srvany.exe</h3><p><a href="https://www.cnblogs.com/zhaiqianfeng/p/4622561.html">利用instsrv和srvany来手动安装服务</a></p><h3 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h3><ol><li><p>在特定路径下创建文件夹，将上述instsrv.exe、srvany.exe以及后续脚本均放在此处；</p></li><li><p>创建install_server.bat文件：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">set</span> curexe=%~dp0<br><span class="hljs-built_in">cd</span> /d <span class="hljs-variable">%curexe%</span><br>&quot;<span class="hljs-variable">%curexe%</span>instsrv.exe&quot; ddns_dynv6 &quot;<span class="hljs-variable">%curexe%</span>srvany.exe&quot;<br>@<span class="hljs-built_in">echo</span> ddns_dynv6 服务添加完成<br><br>@<span class="hljs-built_in">echo</span> 修改服务路径<br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM 添加注册表语法: reg add 注册表路径 /v 项名称 /t 值类型 /d 数据 /f 表示强行修改不提示</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM 名称 Application 值为你要作为服务运行的程序地址 /d对应的参数有斜杠不是为了转义引号，而是路径还有斜杠，默认将引号转义了，额外添加斜杠是为了保留引号</span><br> <br><span class="hljs-built_in">set</span> regpath=HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ddns_dynv6\Parameters\<br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM 名称 AppDirectory 值为你要作为服务运行的程序所在文件夹路径</span><br>reg add <span class="hljs-variable">%regpath%</span> /v AppDirectory /t REG_SZ /d &quot;<span class="hljs-variable">%curexe%</span>\&quot; /f<br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM 名称 AppParameters 值为你要作为服务运行的程序启动所需要的参数</span><br>reg add <span class="hljs-variable">%regpath%</span> /v Application /t REG_SZ /d &quot;<span class="hljs-variable">%curexe%</span>dynv6.bat&quot; /f<br> <br><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> ddns_dynv6<br> <br><span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure></li><li><p>创建remove_server.bat文件：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">net</span> stop ddns_dynv6<br>instsrv ddns_dynv6 remove<br><span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure></li><li><p>创建dynv6.bat文件：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br>@<span class="hljs-built_in">set</span> tempnum=<br>@<span class="hljs-built_in">set</span> ipaddr=<br>@<span class="hljs-built_in">set</span> oldipaddr=<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-comment">rem domain=你注册的域名（dynv6.net 提供多种域名后缀可自行修改）</span><br>@<span class="hljs-built_in">set</span> domain=【在这里填写你记录的域名，填zone名称】<br><span class="hljs-comment">rem token=你注册后的钥匙（dynv6.net 提供）</span><br>@<span class="hljs-built_in">set</span> token=【在这里填写你的token，把这段文字和括号删掉然后粘贴】<br>@<span class="hljs-built_in">set</span> IPV6_REGEX=&quot;\(\([<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">4</span>\&#125;:\)\&#123;<span class="hljs-number">1</span>,\&#125;\)\(\([<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">4</span>\&#125;\)\&#123;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>\&#125;\)\(\(:[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>A-Fa-f]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">4</span>\&#125;\)\&#123;<span class="hljs-number">1</span>,\&#125;\)&quot;<br>@<span class="hljs-built_in">set</span> IPV4_REGEX=&quot;[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;\.[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]\&#123;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>\&#125;&quot;<br>@<span class="hljs-built_in">set</span> URL=&quot;https://dynv6.com/api/update?hostname=<span class="hljs-variable">%domain%</span>&amp;token=<span class="hljs-variable">%token%</span>&amp;ipv4=<span class="hljs-variable">%%i</span>paddr<span class="hljs-variable">%%&quot;</span><br>@<span class="hljs-built_in">set</span> URLV6=&quot;https://dynv6.com/api/update?hostname=<span class="hljs-variable">%domain%</span>&amp;token=<span class="hljs-variable">%token%</span>&amp;ipv6=<span class="hljs-variable">%%i</span>paddr<span class="hljs-variable">%%&amp;</span>ipv6prefix=<span class="hljs-variable">%%i</span>paddr<span class="hljs-variable">%%&quot;</span><br>@<span class="hljs-built_in">set</span> BIN=wget -t <span class="hljs-number">2</span> --prefer-family=IPv6 --no-dns-cache --no-check-certificate<br><span class="hljs-comment"> </span><br><span class="hljs-comment">rem ***ipv4***（dynv6也提供ipv4动态域名服务）</span><br><span class="hljs-comment">rem for /F %%i in (&#x27;nslookup %domain% ns1.dynv6.com ^|grep -m2 -o %IPV4_REGEX%&#x27;) do ( set oldipaddr=%%i)</span><br><span class="hljs-comment">rem ***ipv6***</span><br><span class="hljs-keyword">for</span> /F <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;nslookup -qt^=AAAA <span class="hljs-variable">%domain%</span> ns1.dynv6.com ^|grep -m2 -o <span class="hljs-variable">%IPV6_REGEX%</span>&#x27;) <span class="hljs-keyword">do</span> ( <span class="hljs-built_in">set</span> oldipaddr=<span class="hljs-variable">%%i</span>)<br> <br>@<span class="hljs-built_in">echo</span> Current <span class="hljs-variable">%domain%</span> IP Add:<span class="hljs-variable">%oldipaddr%</span><br> <br>:start_ip1<br><span class="hljs-comment">rem @cls</span><br>@<span class="hljs-built_in">echo</span> ... <br>@<span class="hljs-built_in">echo</span> <span class="hljs-number">1</span>.####从ip.sb获得地址####<br>@<span class="hljs-built_in">set</span> ip6addr=null<br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM ***ipv6***</span><br><span class="hljs-keyword">for</span> /F <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%BIN%</span> -O- http://ip.sb  ^|grep -m <span class="hljs-number">1</span> -o <span class="hljs-variable">%IPV6_REGEX%</span>&#x27;) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">set</span> ipaddr=<span class="hljs-variable">%%i</span>)<br> <br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%ipaddr%</span>&quot; == &quot;null&quot; (<br><span class="hljs-built_in">echo</span> 没有IPV6地址或获得IPV6地址失败<br>timeout <span class="hljs-number">5</span><br><span class="hljs-keyword">goto</span> start_ip2<br>) <span class="hljs-keyword">else</span> (<br><span class="hljs-built_in">echo</span> 获得IP地址:<span class="hljs-variable">%ipaddr%</span>，旧IP地址:<span class="hljs-variable">%oldipaddr%</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">NOT</span> &quot;<span class="hljs-variable">%oldipaddr%</span>&quot; == &quot;<span class="hljs-variable">%ipaddr%</span>&quot; (<br><span class="hljs-built_in">echo</span> ---更新IP---<br><span class="hljs-keyword">goto</span> update_web_ip<br>) <span class="hljs-keyword">else</span> (<br><span class="hljs-built_in">echo</span> IP没有改变<br>timeout <span class="hljs-number">300</span><br><span class="hljs-built_in">cls</span><br><span class="hljs-keyword">goto</span> start_ip2<br>))<br> <br>:start_ip2<br>@<span class="hljs-built_in">ipconfig</span> /flushdns<br>@<span class="hljs-built_in">echo</span> ...<br><span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>.####从checkip.dyndns.com获得地址####<br>@<span class="hljs-built_in">set</span> ipaddr=null<br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM ***ipv4***</span><br><span class="hljs-comment">rem for /F %%i in (&#x27;%BIN% -O- http://checkip.dyndns.com ^|grep -m 1 -o %IPV4_REGEX%&#x27;) do (set ipaddr=%%i)</span><br><span class="hljs-comment">REM ***ipv6***</span><br><span class="hljs-keyword">for</span> /F <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%BIN%</span> -O- http://checkipv6.dyndns.com ^|grep -m <span class="hljs-number">1</span> -o <span class="hljs-variable">%IPV6_REGEX%</span>&#x27;) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">set</span> ipaddr=<span class="hljs-variable">%%i</span>)<br> <br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%ipaddr%</span>&quot; == &quot;null&quot; (<br><span class="hljs-built_in">echo</span> 没有IP地址或获得IP地址失败<br>timeout <span class="hljs-number">5</span><br><span class="hljs-keyword">goto</span> start_ip1<br>) <span class="hljs-keyword">else</span> (<br><span class="hljs-built_in">echo</span> 获得IP地址:<span class="hljs-variable">%ipaddr%</span>，旧IP地址:<span class="hljs-variable">%oldipaddr%</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">NOT</span> &quot;<span class="hljs-variable">%oldipaddr%</span>&quot; == &quot;<span class="hljs-variable">%ipaddr%</span>&quot; (<br><span class="hljs-built_in">echo</span> ---更新IP---<br><span class="hljs-keyword">goto</span> update_web_ip<br>) <span class="hljs-keyword">else</span> (<br><span class="hljs-built_in">echo</span> IP没有改变<br>timeout <span class="hljs-number">300</span><br><span class="hljs-built_in">cls</span><br><span class="hljs-keyword">goto</span> start_ip2<br>))<br> <br> <br>:update_web_ip<br>@<span class="hljs-built_in">echo</span> ==============================================<br>@<span class="hljs-built_in">echo</span> ipaddr=&quot;<span class="hljs-variable">%ipaddr%</span>&quot;<br>@<span class="hljs-built_in">echo</span> ==============================================<br>@<span class="hljs-built_in">set</span> var=null<br><span class="hljs-comment"> </span><br><span class="hljs-comment">REM ***ipv4***</span><br><span class="hljs-comment">rem for /F &quot;tokens=*&quot; %%i in (&#x27;%BIN% -O- %URL%&#x27;) do (set var=%%i)</span><br><span class="hljs-comment">REM ***ipv6***</span><br><span class="hljs-keyword">for</span> /F &quot;tokens=*&quot; <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%BIN%</span> -O- <span class="hljs-variable">%URLV6%</span>&#x27;) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">set</span> var=<span class="hljs-variable">%%i</span>)<br> <br><span class="hljs-built_in">echo</span> 更新信息=<span class="hljs-variable">%var%</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%var%</span>&quot; == &quot;addresses updated&quot; <span class="hljs-keyword">goto</span> end<br><span class="hljs-built_in">echo</span> 更新失败<br>timeout <span class="hljs-number">120</span><br><span class="hljs-keyword">goto</span> start_ip2<br> <br>:end<br><span class="hljs-built_in">set</span> oldipaddr=<span class="hljs-variable">%ipaddr%</span><br><span class="hljs-built_in">echo</span> 更新数据成功<br>timeout <span class="hljs-number">300</span><br><span class="hljs-keyword">goto</span> start_ip2<br><span class="hljs-comment"></span><br><span class="hljs-comment">REM 以上每个TIMEOUT指令都表示等待一定时间（秒），可以按实际情况修改</span><br><span class="hljs-comment">REM 我这里的300秒应该是够用的，太短了占用过多资源，太长了更新不及时</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h2><p>创建一个计划任务即可，详情可百度教程</p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>网络工程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络</tag>
      
      <tag>游戏</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>长沙理工大学无线网络多设备共享解决方案</title>
    <link href="/blog/Network_progress_CSUST/"/>
    <url>/blog/Network_progress_CSUST/</url>
    
    <content type="html"><![CDATA[<h1 id="本文内容已过时"><a href="#本文内容已过时" class="headerlink" title="本文内容已过时"></a>本文内容已过时</h1><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>本文大部分内容可参考：<br><a href="https://www.mr-cn.net/2021/06/15/Share-your-network-in-CSUST/">长沙理工大学：校园网解除共享限制</a><br>路由器刷机参考教程（非本次使用）：<br><a href="https://www.right.com.cn/FORUM/thread-489907-1-1.html">极路由Enjoy 1200  HC5861B OpenWRT 固件 Rosy主题</a><br>如何下载固件：<br><a href="http://opt.cn2qq.com/padavan/">padavan固件下载列表</a></p><h2 id="原因与现象"><a href="#原因与现象" class="headerlink" title="原因与现象"></a>原因与现象</h2><p>为了维护运营商利益，校园网设置了一些检测与规则，对同时登录校园网的设备数量作出了严格的限制，并且不允许终端用户进行网络共享。<br>具体表现为，当用户使用电脑、手机等的热点、无线信号桥等方法时，只要有第二台设备联网，就会在一定条件下被检测发现，随后此账号将无法访问网络，并自动将网页重定向到登录界面（或1.1.1.3，但这个页面不能加载出来）。</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>根据引用文章，可以得知共享检测主要通过80端口下的HTTP报文中浏览器UA的区别来实现，可以看到这个限制条件比较多，而且检测周期并不短；因此会出现稳定共享的时间时长时短的现象。<br>此外，还可能会通过其他方法检测，包括但不限于TTL、IPID、侵入式检测等等。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>为实现稳定的校园网共享，首先需要选择正确的系统：必须使用OpenWRT或Pavanda等软路由系统。<br>本文基于Pavanda操作。</p><h3 id="路由选型"><a href="#路由选型" class="headerlink" title="路由选型"></a>路由选型</h3><p>如果你还没有软路由或者合适的路由器，那么选购路由器就是第一步了。我最终的选择是二手极路由Enjoy 1200，型号HC5861B。极路由虽然已经倒闭，但它的产品可玩性和性价比确实是相对较好的。<br>淘宝入手价格40元，由商家代刷Breed。<br>需要注意的是，这一款路由器不支持USB，电源接口也是12V DC而非5V Micro-USB，如果有这两个功能需求的话可以考虑极路由3或其他产品。</p><h3 id="检查与刷机"><a href="#检查与刷机" class="headerlink" title="检查与刷机"></a>检查与刷机</h3><p>收货后先简单清理积灰，检查网口是否有积聚大量灰尘，天线是否正常连接、旋转。<br>随后插入电源开机，连接电脑网口到路由器LAN 1口，等待IP自动配置完成，进入默认网关的地址（本次为192.168.132.1，极路由原厂固件可能为192.168.199.1）<br>使用默认的管理员账号密码（admin）登录后，发现这台机器已经刷好了老毛子固件（Padavan）了：<br><img src="/../_resources/54de7cdf47ce563bb65d5c42e282e331.png" alt="54de7cdf47ce563bb65d5c42e282e331.png"><br>所以省下了很多时间，虽然我的计划是使用OpenWrt，但Padavan本质上是一样的。<br>如果需要刷机教程，请参考引用文章，或直接搜索路由型号+OpenWrt，即可找到一些刷机教程。</p><h2 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h2><p><img src="/../_resources/15828e53952c884a9b9f9f1cc11b7c77.png" alt="15828e53952c884a9b9f9f1cc11b7c77.png"><br>我的目标是达成这样的拓扑，实际上就是一个无线“路由”，也就是将无线信号作为WAN，执行NAT和防火墙规则后建立子网，设备均接入子网中。</p><h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><h3 id="路由器接入无线网络"><a href="#路由器接入无线网络" class="headerlink" title="路由器接入无线网络"></a>路由器接入无线网络</h3><p>直接参考这张图即可：<br><img src="/../_resources/d6035076edef8fc78299e3af690eea62.png" alt="d6035076edef8fc78299e3af690eea62.png"><br>2.4G和5G只能有一个用于AP-Client，另一个必须禁用桥接。<br>需要注意的是，路由器需要用一个频段接入校园网，另一个频段用于发射信号；虽然可以选择client+AP来实现单频复用，实际上只用5GHz的话效果也不错，但我收到的这台路由器不知道为何5G能力极其孱弱（无遮挡50cm距离下client都不能跑满协商速率），而2.4G能力极强（对周围的无线鼠标、蓝牙手柄等造成严重干扰），因此这里不使用这种方法。<br><strong>补充：后面换了一台JCG Q20，TB到手60块，不仅支持WiFi6而且性能远强于前面买的极路由，有需要的同学可以参考购买。这玩意就完全可以5GHz同时用于client和AP了，2.4GHz只用来保留兼容性即可。</strong></p><p><strong>懒得删改的原文：</strong><br><em>这里还涉及到频段的选择，最开始我使用2.4G接入校园网、5G用于共享，但随后我发现无线鼠标的工作会受到较严重的干扰（接收器也工作在2.4G频率上），因此后续改为5G接入、2.4G共享。<br>此外，网络性能也是一个需要关心的重点，5GHz总能提供更优秀的表现，但这里我们只能用于一个目的；由于我平时主要使用电脑上网，而电脑是通过网线连接到路由器的，因此选择5G接入是更好的。实际上，这种情况下2.4G的表现也不差，宿舍面积小、干扰少，多次测试下来延迟在30ms以内，速度8-9MB&#x2F;s，可以满足1080P视频观看和正常游戏。</em></p><h3 id="修改网络配置"><a href="#修改网络配置" class="headerlink" title="修改网络配置"></a>修改网络配置</h3><p>如果对内网网段不敏感（例如你只想要正常上网，平时不开发网页、软件、游戏、不做任何测试，那么这一段可以跳过）<br>在左侧选择外部网络（WAN），可参考下图配置：<br><img src="/../_resources/e613ab56c89c86b939bf67ab5601fc42.png" alt="e613ab56c89c86b939bf67ab5601fc42.png"></p><p>LAN配置同理，设置想要的网段、DNS、静态路由等。</p><h2 id="通过NAT连接ipv6"><a href="#通过NAT连接ipv6" class="headerlink" title="通过NAT连接ipv6"></a>通过NAT连接ipv6</h2><p>由于我希望使用到正常的ipv6，故单独在此写出方案；对于绝大多数日常网络而言，关闭ipv6可能反而有助于提高稳定性。<br>参考文章：<a href="https://post.smzdm.com/p/ad9qkz9k/">校园网环境下Openwrt配置ipv6教程——以nat6为例</a></p><ul><li><p>NAT是什么？<br>NAT是最早出现在ipv4中的技术；由于ipv4地址空间有限（总约42亿个），无法满足爆炸式增长的网络设备入网需求，因此出现了网络地址转换（Network Address Translation）技术；它的作用就是缓解ipv4地址消耗，尽量在ipv6部署完全之前满足原有上网需求。<br>它的工作原理很简单，我们平时使用路由器上网的时候就至少会有一次NAT过程，路由器将一个外网（全球唯一）的地址映射到多个内网地址（通常为192.168.x.x或10.x.x.x），这样一个路由器下的设备就可以共用一个外网IP，大幅缓解了地址消耗，同时解决了耗尽的影响。<br>NAT有助于提高网络安全性，因为路由器上可以部署非常高效的防火墙，也可以天然阻断所有传入连接，但这样的技术也会带来问题；最大的问题无疑就是点对点连接变得不可能，因此游戏联机、网站建设等都会变得很困难。<br>在我的使用场景下，Minecraft联机是最常见的点对点连接应用，此前的解决方案均为FRP内网穿透（见前文章）。</p></li><li><p>为什么我一定要有ipv6连接？<br>很简单，ipv6地址池极大，运营商也并未刻意限制用户的ipv6访问（至少我没有遇到过哪个运营商在ipv6上用NAT的）<strong>（但是教育网除外）</strong>。<br>因此，大多数用户只要开启了ipv6，就能获取到公网IP。这对于点对点连接来说无疑是非常有帮助的。</p></li><li><p>教育网干了什么？<br>一般运营商在家用、商用宽带里分配的ipv6都带有一个&#x2F;64的前缀，这意味着路由器拿到的地址里面还包含了大量的可用地址（约1800万兆个地址；1兆&#x3D;1万亿（也就是18446744073709551616）），用于给后续设备分配ipv6地址；<br>但教育网的ipv6则直接分配了&#x2F;128的地址，这就意味着它给你的地址只能用于一台设备。也就是说，想要共享ipv6，必须使用NAT。</p></li></ul><h3 id="如何使用NAPT66"><a href="#如何使用NAPT66" class="headerlink" title="如何使用NAPT66"></a>如何使用NAPT66</h3><p>NAPT66模块是padavan使用的一个解决方案，所谓NAPT其实是现在NAT的正确称呼，也就是Network Address Port Translation。因为一对多NAT的情况下涉及到端口转换，相当于用端口数换IP数，所以NAPT才是准确的说法。<br>请按照你的路由器型号查找最新的padavan固件，并进行固件更新；在新版PDCN固件中直接内置了NAPT66的一键开关和配置，只需在ipv6设置页面底部点击一键填写配置，然后重启路由器和电脑网卡即可使用。</p><hr><h2 id="更多参考信息"><a href="#更多参考信息" class="headerlink" title="更多参考信息"></a>更多参考信息</h2><p>如果你的路由器使用的固件特殊，没有内置一键NAPT66，则可参考：<a href="https://doge.uk/coding/padavan-ipv6-napt66.html">Padavan路由下使用NAPT66模块访问移动IPV6网络</a></p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>网络工程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>又一次折腾手机游戏《灵魂潮汐》音频录制的记录</title>
    <link href="/blog/another_toss_of_music_recording/"/>
    <url>/blog/another_toss_of_music_recording/</url>
    
    <content type="html"><![CDATA[<h2 id="事件初始"><a href="#事件初始" class="headerlink" title="事件初始"></a>事件初始</h2><p>在2021年，我入坑了灵魂潮汐；作为副游，她已经做到了尽善尽美。具体不再阐述，有兴趣可自行前往<a href="https://lhcx.iqigame.net/">官网</a></p><p>然后，在大约2022年中的时候，有几次游戏大更新；有一天我意外地发现，游戏登录前的加载界面不再是寂静无声，而是加入了一段非常好听的音乐！<br>当时这段音乐就让我沉醉了，游戏都没肝就直接跑去b站找官方账号。很幸运，我找到了视频；不幸的是，官方视频里的歌曲不是同一个人唱的 :(<br>但是它实在太好听了，所以之后我又琢磨着怎么把这段音乐录下来。于是就有了后续的折腾环节。</p><hr><h2 id="尝试录制"><a href="#尝试录制" class="headerlink" title="尝试录制"></a>尝试录制</h2><p>不详细说了，我试了以下的方法：</p><ol><li>手机内置录屏<br>  失败的原因很简单，手机内置的录屏音质不佳，更是只有单声道；显然我是不可能选择这个方式的。</li><li>电脑模拟器<br>同样失败；当时我用的是一众包装好的安卓模拟器，包括夜神、Mumu、联想手机助手等。失败的原因是，这些模拟器的音质同样不高，而且似乎只在游戏界面上才会发生，具体表现就是声音没有高频，12kHz以上的频率全部被切除，听起来就像96kbps的电话音质一样。</li><li>其它手机软件<br>  找了很久，找到一个能够读取原始RAW音频数据进而录屏的手机软件；但是这种方法有个很大的缺陷，就是它会同时把麦克风的声音混进去，而且无法分离；手机麦克风的噪音很大，非常影响听感，更何况环境噪声无处不在，不能实现完美的录制条件。禁用麦克风权限则所有声音都不能被录制，因此该方法pass。<br>……</li></ol><hr><h2 id="初次解决方案"><a href="#初次解决方案" class="headerlink" title="初次解决方案"></a>初次解决方案</h2><p>最终，我用一个很奇怪的方法达成了目标：<br><strong>多屏协同。</strong><br>对，就是华为手机支持的那个。当时我用的是荣耀magic2和magicbook pro，多屏协同是很容易实现的。<br>通过多屏协同，手机的声音直接在电脑上播放，而且延迟低音质高（相对）。<br>随后在电脑上用Au录制，配上官方的视频画面，我就直接投稿到b站。</p><p>但是没几天我就发现了被我忽略的问题，那就是多屏协同的音质同样不是最佳；它会切除16kHz以上的音频，导致听感近似128kbps的低质量音频（尽管在这首歌里似乎不明显，几乎没感觉音质有多差）。当然，那时我也没想到更好的办法，于是这个视频就一直放着，还逐渐收获了1.1W的播放量。</p><hr><h2 id="二次折腾"><a href="#二次折腾" class="headerlink" title="二次折腾"></a>二次折腾</h2><p>就在今天晚上，我在整理b站的各类信息和配置，无意间点进了创作中心，看到了视频的最新评论。有人问我是怎么获得高音质音频的，于是我就把这个过程说了一遍。<br>但是这个时候，我决定要彻底解决问题，获取原始的最高音质音频；一直用着低质量音乐冒充高品质原声始终不太好，于是我又着手开始折腾。</p><p><strong>重新尝试虚拟机</strong></p><ul><li>微软的WSA：失败，win10没有成功启动</li><li>VirtualBox虚拟机：失败，音频要么呈现断断续续的极为难听的状态，要么就只有之前遇到过的低质量。<br>此时我也已经明白，实际上模拟器音质不高基本上就是由于音频设备的原因，使用Windows Audio Session+ICH AC97能得到唯一流畅的声音输出，但质量低。</li></ul><hr><h2 id="聪明反被聪明误"><a href="#聪明反被聪明误" class="headerlink" title="聪明反被聪明误"></a>聪明反被聪明误</h2><p>没错，自作聪明的结果就是我这样，折腾了两回一点用都没有。<br>就在我放弃折腾准备关机睡觉的时候，我就忽然想到，为什么我不直接把手机的耳机孔输出连接到电脑的音频口呢？这样电脑直接就能接收到手机的音频输出，直接录制最原始的声音。</p><p>这个方法听起来很蠢，但它就是最快捷最有效的方法。换了几条线，我发现只要把Realtek的声音设备设置为麦克风，关闭所有麦克风增强、效果和加强，配合一根AUX（3.5mm公对公）转接线就能直接在电脑上录音了。</p><hr><h2 id="b站的阴间操作"><a href="#b站的阴间操作" class="headerlink" title="b站的阴间操作"></a>b站的阴间操作</h2><p>终于得到了完美的录音，当然是要换源了，让后面的观众能享受到最佳的音质！<br>一顿操作，把之前的视频替换音轨，重新上传。<br>……<br><code>10分钟后...</code><br>嗯，新上传的视频，音频直接被压缩到了74kbps，听起来比电话还糊。<br>b站，:)<br>时间已经比较晚了，我也不想继续折腾，直接投了个音频投稿然后关联过来，同时发新的文件下载链接置顶，就这样吧。反正问题算是解决了，就是这个结尾整的我有点脑溢血（</p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>日志</category>
      
    </categories>
    
    
    <tags>
      
      <tag>游戏</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>记一次折腾电信ipv6中的各种问题</title>
    <link href="/blog/ipv6_toss/"/>
    <url>/blog/ipv6_toss/</url>
    
    <content type="html"><![CDATA[<p>阅前提示：本文约5000字，预计阅读时长&gt;5分钟。</p><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>由于想跟好友联机minecraft，而使用natfrp做内网穿透时发现有很多问题，包括延迟高且不稳定、速率低、流量限制、高峰时期断连等。刚好想起来家里的网络已经被我启用了ipv6，因此试图使用ipv6来直接对公网开放minecraft服务器。  </p><h2 id="开始第一次尝试"><a href="#开始第一次尝试" class="headerlink" title="开始第一次尝试"></a>开始第一次尝试</h2><p><strong>当前状态：</strong>  </p><ul><li>光猫使用路由模式，自主拨号并获取两种ip地址（除非特殊说明，否则以下简称ip）</li><li>无线路由器（下简称路由器）使用路由模式</li><li>所有设备连接在路由器上，并能获取到ip</li></ul><p><img src="/../_resources/a941e7dad288e2bd65c297c76503f111.png" alt="a941e7dad288e2bd65c297c76503f111.png">  </p><p><strong>当前问题：</strong></p><ul><li>首先尝试外网直接连接服务器ipv6，失败</li><li>外网无法ping通任何内网主机</li><li>光猫获取到的ipv6地址仍然无法通过外网ping通</li><li>在光猫中设置端口映射或DMZ主机，无效</li></ul><p>实际上，上述内容已经花了我一下午来检查和排查；网上搜索相关内容，有人说<del>获取到的ipv6是240e开头的，说明是经过了NAT（类似ipv4，所以肯定访问不到）</del>；但是这种说法显然有问题，首先ipv6只有在特殊环境下才需要NAT，其次2开头的地址至少不是内网地址。<br>另有说法称，运营商（我用的是电信）会用防火墙屏蔽入站流量，防止你开服务器。根据我的实验，这个说法是正确的。  </p><p>随后开始折腾，既然防火墙阻碍了我，那我关掉就好。<br>但是现实很惨淡，运营商早就猜到你会搞这一手，所以直接不允许你关闭防火墙。<br>这里包括了最后的那个防止ICMP包攻击，还有其他的防火墙直接不显示。<br><img src="/../_resources/7d186301818af5165a407c1751fb848c.png" alt="7d186301818af5165a407c1751fb848c.png"></p><h3 id="换个地方拨号？"><a href="#换个地方拨号？" class="headerlink" title="换个地方拨号？"></a>换个地方拨号？</h3><p>网上提供了一种解决思路，即光猫改桥接、使用路由器进行拨号；这样做有一些好处，例如路由器的性能更强、可以提供更快的网速，以及很高的可玩性、灵活性等等，这里直接把路由器换成软路由就能实现非常多的玩法，因此我就着手开始改桥接。  </p><p>改的过程实际上非常简单，找到宽带的账号密码，进入光猫的超级用户，然后直接改桥接即可。<br><img src="/../_resources/bc81d148f88500f57dbadabcf8080770.png" alt="bc81d148f88500f57dbadabcf8080770.png"></p><hr><p>随后，将路由器设置为PPPoE拨号连接；这里就不放图了，各家路由器的配置流程都是一回事。<br>关闭路由器的防火墙，现在，所有的设备又能重新获取到ip，且具有公网ipv6地址。当然由于Windows防火墙的配置，需要关闭Windows的防火墙才能从外网ping通。<br>大获全胜！网速也提升到了570M（家里办理的500M宽带，如果直接从光猫拨号+路由，则速度最高470M）<br><img src="/../_resources/cbdb76297f0af4d4d3837f421060eb67.png" alt="cbdb76297f0af4d4d3837f421060eb67.png"></p><p>同时，Minecraft也能正常从外网通过ipv6连接，看起来一切完美。</p><hr><h2 id="核心问题：网页无法访问"><a href="#核心问题：网页无法访问" class="headerlink" title="核心问题：网页无法访问"></a>核心问题：网页无法访问</h2><p>一切完美？当然是不可能的。一定会出问题，而且是大问题。<br>配置好ipv6之后，一开始所有设备工作正常，网速和解析速度起飞。<br>然后，用了半个小时左右，问题开始逐步显现。<br>最开始，我在网上搜索一个Windows方面的配置问题，并且点进去了一个博客园的链接。然后，网页并没有按照我预想中的那样飞快加载，而是不断转圈。<br>最后：<br><img src="/../_resources/84c01f9cc1ebf56595e7d025fc4a0617.png" alt="84c01f9cc1ebf56595e7d025fc4a0617.png"></p><p>一开始我以为这是必应的中转链接出现问题了（百度日常），因为点击必应的搜索结果并不是直接访问目标网址，而是先通过一个必应的链接重定向到目标。这个重定向有时候会失败，是正常的。但是，我直接访问目标网址时，居然也不能进去，这就非常奇怪了。<br>这时候我还是乐观的心态，认为是博客园的服务器出了问题，也没有去其它设备上尝试。但我仍然重视了这个问题，并立即去搜索解决方法。因为是开了路由器拨号+ipv6之后才出现的问题，所以查找方向也很明确了。结果，就在我查找的过程中，发现了更多的问题。<br>百度经验、百度知道、百度贴吧、知乎…这些网站一个接一个地挂掉；有时候网站一开始能正常访问，再开的时候就加载不出JS和CSS（变成了没有渲染的样式，仅限知乎），然后就是一样的不响应。症状跟博客园完全一致，控制台里没有任何有效信息，只有一个响应超时。  </p><hr><h3 id="先恢复正常访问"><a href="#先恢复正常访问" class="headerlink" title="先恢复正常访问"></a>先恢复正常访问</h3><p>一通摸索之后，我找到了暂时恢复的方法：在网卡选项里禁用ipv6（Internet 协议版本6）。<br>禁用后，所有网页恢复正常，但这显然不可取，因为我的目的就是使用ipv6，而禁用它也就丧失了所有ipv6能力。<br>需要注意的是，现在出问题的网站都不是纯ipv6站点，有些是纯ipv4站点，但双栈域名居多。这时候访问纯ipv6网站是全部成功的，ipv6测试也是全绿通过，并且无论何种类型的网站都有大量能成功访问的。</p><h3 id="退一步试试"><a href="#退一步试试" class="headerlink" title="退一步试试"></a>退一步试试</h3><p>退一步，指的就是我找到一种方法，让浏览器只使用或优先使用ipv4进行访问。<br>因为出问题的只有浏览器，我电脑里其它软件全都正常运行。<br><em>后续补充：今天发现Windows版的微信也不能正常使用，二维码加载不出来，禁用 ipv6后恢复。</em>。<br>但是，网上相关的教程极少甚至没有，偶有几个是针对Firefox或chrome的，而我使用的是edge；就算我能参考chrome，教程也是针对Linux而非Windows。</p><h3 id="再退一步"><a href="#再退一步" class="headerlink" title="再退一步"></a>再退一步</h3><p>好的，如果浏览器不行，那我就找个方法让整个操作系统都优先使用ipv4。<br>微软提供了一个文档，通过<a href="https://learn.microsoft.com/en-US/troubleshoot/windows-server/networking/configure-ipv6-in-windows">修改注册表的方法</a>来实现全局优先ipv4、禁用ipv6、优先ipv6等等。<br>一看到这里，我立即兴奋地尝试了。改了注册表，重启，访问：  </p><p><code>ERR_TIMED_OUT</code> .png</p><p>好，居然没用。微软，不愧是你。<br>重启很多次无效，当时已经半夜2:30，我没有了折腾的心情，只想赶紧睡觉。</p><h2 id="第一次折腾失败"><a href="#第一次折腾失败" class="headerlink" title="第一次折腾失败"></a>第一次折腾失败</h2><p>网上又找了很多相同症状的用户，解决方案要么是改注册表，要么是说路由器兼容性有问题。<br>好吧，反正跟我联机的同学也不是很在意，natfrp似乎还能继续用用。<br>于是，彻底宣告失败，我重新改回了光猫拨号、路由桥接，随后所有网络恢复正常（除了外网还是不能访问这里的所有ipv6；当然，也包括ipv4，因为有NAT）。  </p><p>这就结束了吗？怎么可能，不搞到好用我是不会罢休的。<br>于是，第二天，我又开始了新一轮的折腾。</p><hr><h2 id="第二次尝试"><a href="#第二次尝试" class="headerlink" title="第二次尝试"></a>第二次尝试</h2><p>重新尝试，同样的光猫改桥接，同样的路由器拨号。同样的正常ipv6公网访问，但是这一次似乎是运气比较好，网页访问全部正常使用，并且坚持了至少4个小时。<br>中途离家4小时，回来之后，惊喜地发现，这些网页又打不开了 :)<br>这时候我就已经明白，无论怎么修改电脑或者路由器配置都无效，于是没有再做尝试，转而对现在的情况进行分析，并希望通过其它方法解决需求。</p><h3 id="转机"><a href="#转机" class="headerlink" title="转机"></a>转机</h3><p>在我整理思路的时候，我意识到，实际上我只需要服务器一台电脑能够获取正常入站的ipv6地址（正常的ipv6）即可，其余设备甚至根本不需要启用ipv6。这时候，我首先想到的就是：</p><h4 id="一号多拨"><a href="#一号多拨" class="headerlink" title="一号多拨"></a>一号多拨</h4><p>一号多拨，指的是我通过同一个光猫，使用同一个宽带账号，分别在两台设备上进行拨号。<br>我的最初想法是，服务器电脑直连光猫并自己拨号获取正常的ipv6地址，同时路由器也自己拨号，但只启用ipv4。<br>网上搜索发现，这种方法当然是可行的，前提是运营商支持多拨。</p><p><code>折腾中</code></p><p>没有任何侥幸，拨号失败。电脑上尝试第二次拨号时直接返回错误629。</p><p>再换一种角度，重新分析我的需求。服务器能使用正常的ipv6，同时其余设备仅需要ipv4（最多需要ipv6内网而非公网访问）。因此，我做了如下操作，来使得二者兼顾。</p><hr><h2 id="最终如何解决"><a href="#最终如何解决" class="headerlink" title="最终如何解决"></a>最终如何解决</h2><p>如果你的需求和遇到的问题跟我完全一样，那么也许可以参考我的方法来临时解决。<br><strong>提示：最终的解决方案也并不完美，只不过暂时保证了两边可以都解决主要矛盾</strong><br>以下是我的解决方案：</p><h3 id="1-将路由器的内网ipv6地址分发从无状态改为有状态。"><a href="#1-将路由器的内网ipv6地址分发从无状态改为有状态。" class="headerlink" title="1. 将路由器的内网ipv6地址分发从无状态改为有状态。"></a>1. 将路由器的内网ipv6地址分发从无状态改为有状态。</h3><p>无状态获取指的是机器自己配置地址，然后通过NDP等方式确定地址有效性即可；有状态获取类似DHCP，不过分配的地址是ipv6。<br>这一步解决了手机联网的问题；由于我的网络环境中手机为主要设备，而安卓系统并不支持通过DHCPv6进行有状态获取ipv6地址；于是所有的手机都只能通过ipv4联网，解决了所有上网问题。</p><h3 id="2-为电脑配置虚假或者无效的ipv6地址"><a href="#2-为电脑配置虚假或者无效的ipv6地址" class="headerlink" title="2.  为电脑配置虚假或者无效的ipv6地址"></a>2.  为电脑配置虚假或者无效的ipv6地址</h3><p>这是我在测试的时候忽然想到的主意，既然ipv4地址在手动配置错误的情况下无法联网，那么ipv6应该也是一样的。<br>ipv6中同样有很多保留地址，例如<code>fe80</code>开头的地址表示本地链路地址，无法进行跨子网路由，因此给我自己的电脑配置一个<code>fe80::1</code>的地址即可。<br>配置后，网卡状态中IPv6连接变为<strong>无Internet访问权限</strong>，使用<code>ipconfig /all</code>查看IP地址，发现手动配置的ipv6地址变成了<strong>本地链接IPv6地址</strong>。<br><img src="/../_resources/054913f5d395b1e809f0d7830e64c948.png" alt="054913f5d395b1e809f0d7830e64c948.png"><br>此外，这里网卡仍然获取到了一个IPv6地址，但后面提示（<strong>复制</strong>），检查其地址发现这个地址是我的服务器电脑的公网ipv6地址（因此在此处打码作保护）；这可能是一些其它方面的机制，但并不影响服务器和我的电脑的正常工作。同时，由于内网ipv6地址被正常配置，我仍然可以通过内网ipv6来访问服务器（包括文件服务器、网页服务器、minecraft和远程桌面）。<br>    这一步解决了环境中主要的电脑设备：我自己的使用需求。当然没有完全解决，纯ipv4模式下访问部分双栈网站时速度还是比较慢，但能够正常使用已经是极其难得了。</p><h3 id="3-为Windows-11配置"><a href="#3-为Windows-11配置" class="headerlink" title="3. 为Windows 11配置"></a>3. 为Windows 11配置</h3><p>环境中存在另一台常用的电脑，而它搭载的是Windows 11 家庭版。<br>在win11下可以执行相同的步骤进行配置，只不过需要多出一个步骤：<strong>你需要在系统设置中手动设置ipv6 DNS，而不能使用自动获取。</strong><br>这一步是因为，即便手动配置了ipv6地址，win11似乎也不会立即使用，而是先试图通过DHCP等方法获取ipv6地址以及DNS服务器等；而在自动获取DNS的过程中，路由器很可能就为它分配了一个ipv6地址，导致我们自己设置的地址完全变成内网地址，而无法实现目的。</p><hr><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>至此，全部流程结束，解决方案全部执行。服务器正常接受公网入站流量，其余设备配置后均能实现正常上网。</p><p>但是，我并不对现在的解决方案满意。原因很简单，我开ipv6不仅是为了服务器使用，更是为了提高日常上网体验，同时接轨最新技术（虽然ipv6都是12年前的玩意了）；现在虽然解决了问题，但并未达成全部目的，因为除了服务器主机以外没有设备能够正常使用ipv6的。这个方法顶多也就临时用用，实际上我也就这一个寒假的需求，假期结束返校前肯定会恢复光猫拨号的，因为服务器主机之后只作为内网打印服务器，不再有公网访问需求。此外，每次新加一台电脑，都需要这样设置一遍无效的ipv6地址，以便正常访问网页。<br>所以，整体看下来，其实只是在两边的矛盾中取了一个居中妥协的值，为主要矛盾作了让步。我也不是每天都会折腾网络，更多时候还是希望它日常使用能稳定；但我又不希望放弃服务器的公网访问，因此这两者就是核心问题，而最终的方案也就向这两个问题进行妥协。<br>Anyway，反正问题算是解决了，但愿ipv6的部署进度还能快一点吧（</p><hr><p>明天就是除夕了，浅放一张AI画的胡桃吧，祝大家新年快乐！<br><em>胡桃没画成，人要么太大要么太小，随便搞了个背景算了（）</em><br><img src="/../_resources/7c8d8e5459a9f8cd83c33281ca1aa262.png" alt="7c8d8e5459a9f8cd83c33281ca1aa262.png"></p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>网络工程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络</tag>
      
      <tag>游戏</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>你好，2023</title>
    <link href="/blog/Hello_2023/"/>
    <url>/blog/Hello_2023/</url>
    
    <content type="html"><![CDATA[<p>向过去的2022说再见！<br>年度总结将会单独放在另一篇文章中（后续更新链接）<br>今天，让我们先为新的一年到来而庆贺<br>祝大家元旦快乐！</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text">Lay down forever and ever inside my arms<br>请依偎在我怀<br>Shine now forever and ever I&#x27;ll stay with you<br>绽放华彩吧，我将寸步不离<br>It&#x27;s magic, magic, magic<br>有一种魔力<br>when you are here<br>当你在眼前<br>It&#x27;s magic, magic, magic<br>有一种魔力<br>when you&#x27;re near<br>当你在身畔<br></code></pre></td></tr></table></figure><p>歌词来源：Thomas Bergersen,Kimera Morrell - Magic（<a href="http://music.163.com/song?id=1834324494&userid=438146708">点击收听</a>）</p><p><img src="/../_resources/1a92108b49baab2f8a97603f1b04453d.png" alt="1a92108b49baab2f8a97603f1b04453d.png"></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>日志</category>
      
    </categories>
    
    
    <tags>
      
      <tag>日常</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>【补档】唤境游戏如何显示帧率？详解性能相关内容</title>
    <link href="/blog/%E8%A1%A5%E6%A1%A31/"/>
    <url>/blog/%E8%A1%A5%E6%A1%A31/</url>
    
    <content type="html"><![CDATA[<p>因群里有成员对这方面存在疑问，所以写一篇文章详细解释下游戏内性能相关。<br>需要注意的是，本人对于唤境中这些内容的最具体理解未必到位，因此可能出现一些技术细节上的错误，希望大佬能指出错误，感激不尽！<br>为了保证一般开发者也能看得懂，文章会尽量避免非常专业和硬核的描述，相应地就会降低严谨性。如果有兴趣深究，请查找更专业的资料。<br>此外，本文并非是针对唤境游戏的性能优化而写的，如果您的引擎或者制作的游戏出现卡顿，请前往b站查看小嗦大佬的教程。<br>传送门：<a href="https://www.bilibili.com/video/BV1wg411E7oF">https://www.bilibili.com/video/BV1wg411E7oF</a></p><hr><h2 id="一、性能相关概念（基础内容）"><a href="#一、性能相关概念（基础内容）" class="headerlink" title="一、性能相关概念（基础内容）"></a>一、性能相关概念（基础内容）</h2><p>通常情况下，我们会通过几个方面来评估一个游戏运行的性能表现，分别是帧率、帧生成时间、CPU占用、GPU占用、内存占用、显存占用等。</p><h3 id="1-帧率-FPS"><a href="#1-帧率-FPS" class="headerlink" title="1. 帧率 &#x2F; FPS"></a>1. 帧率 &#x2F; FPS</h3><p>游戏之所以能呈现动态的画面，是因为它会以一个很快的速度生成画面，每秒几十张甚至上百张，其中每个画面就被称为一 “帧” 。因此，帧是游戏画面在时间上的最小单位。<br>于是，我们有了帧率的概念。帧率，就是每秒钟游戏生成的帧数量。很明显的，帧率越高，我们肉眼感觉到的画面就越流畅，反之则越卡顿。当帧率为0时，游戏就停止在一张静态的图片上。<br>一般而言，当帧率达到60时，人眼观察到的画面就可以称为“比较流畅”了。</p><h3 id="2-帧生成时间（或帧间隔）-FRAMETIME"><a href="#2-帧生成时间（或帧间隔）-FRAMETIME" class="headerlink" title="2.帧生成时间（或帧间隔）&#x2F; FRAMETIME"></a>2.帧生成时间（或帧间隔）&#x2F; FRAMETIME</h3><p>有了帧率的概念，我们就可以引入帧生成时间的概念了。<br>游戏引擎每生成一帧画面，都需要消耗一定的时间，这个时间就称为帧生成时间。<br>帧生成时间波动是造成瞬间卡顿的原因之一。设想一个极端情况，在运行的某一秒里，游戏花了0.9秒来渲染第一帧，然后在剩下0.1秒里渲染了剩下的59帧。这时候的平均帧率还是60，但是你在玩的时候就会明显感觉到游戏发生了一次剧烈的卡顿，因为这0.9秒的时间内游戏处于静止状态。<br>帧生成时间和间隔的定义，严格来说并不是完全一致的，但本文并不是进行画面技术研究，所以暂且认为它们是同一个概念。</p><h3 id="3-CPU占用-CPU"><a href="#3-CPU占用-CPU" class="headerlink" title="3.CPU占用 &#x2F; CPU"></a>3.CPU占用 &#x2F; CPU</h3><p>在计算机中，CPU负责通用计算，也就是任何计算理论上都可以由CPU完成。在游戏中，控制游戏系统运行、通过公式计算数据、运行函数等都是由CPU完成的。最开始的时候，游戏画面的渲染也是由CPU完成的，但后来人们发现CPU难以胜任这一要求，于是将这个工作交由GPU完成。有关这一段历史的发展，详见<a href="https://www.bilibili.com/video/BV1Hb41177JB">https://www.bilibili.com/video/BV1Hb41177JB</a><br>对于现代电脑和手机来说，它们的CPU性能都相当强大，可以完成非常密集的运算需求。但它们的性能也不是无限的，而且在手机、笔记本电脑上，CPU是耗电量非常大的元件。所以，CPU会直接影响游戏的性能表现，降低CPU的占用率也可以有效提高游戏运行的效率，以及在低端设备上成功运行的可能性。</p><h3 id="4-GPU占用-GPU"><a href="#4-GPU占用-GPU" class="headerlink" title="4.GPU占用 &#x2F; GPU"></a>4.GPU占用 &#x2F; GPU</h3><p>前面提到了，GPU是用来替代CPU来完成画面渲染工作的硬件。所以，GPU是离游戏实际画面最近的硬件，因为游戏画面就是由它生成的。<br>GPU负责的内容就是渲染画面，例如显示图片、文字等。<br>对于唤境来说，由于唤境只是2D游戏引擎，因此对于现代GPU来说压力比较低，但还是存在运行效率过低的情况。<br>有关GPU运行解析的内容请见官方教程<a href="https://evkworld.cn/wiki/58">https://evkworld.cn/wiki/58</a></p><h3 id="5-显存占用-VRAM、VIDEO-MEMORY、IMAGE-MEMORY等"><a href="#5-显存占用-VRAM、VIDEO-MEMORY、IMAGE-MEMORY等" class="headerlink" title="5.显存占用 &#x2F; (VRAM、VIDEO MEMORY、IMAGE MEMORY等)"></a>5.显存占用 &#x2F; (VRAM、VIDEO MEMORY、IMAGE MEMORY等)</h3><p>显存，又称显示内存、显卡内存、图形内存、视频内存等，是显卡用来储存图像信息的临时空间。<br>对于集成显卡（例如手机）而言，显存就是从内存中分出来的部分；对于独立显卡（例如高性能电脑）而言，显存是单独集成在显卡中的一个存储器。所以，当游戏在手机上运行的时候，游戏会同时消耗两份内存空间，一部分用于程序运行，另一部分充当显存。因此，如果您的游戏在电脑上运行很正常，而在低端手机上就无法运行或者特别卡顿，则有可能是因为游戏消耗了较多的显存和内存。</p><hr><h2 id="二、唤境中跟性能有关的表达式"><a href="#二、唤境中跟性能有关的表达式" class="headerlink" title="二、唤境中跟性能有关的表达式"></a>二、唤境中跟性能有关的表达式</h2><p>唤境引擎并没有提供性能监控相关的组件和能力，但可以通过表达式获取到性能数据。<br>所有相关表达式都在系统部分中。</p><h3 id="1-帧率"><a href="#1-帧率" class="headerlink" title="1.帧率"></a>1.帧率</h3><p>表达式：fps<br>刷新频率：每秒1次<br>返回值类型：整数<br>建议使用方法：直接通过表达式获取帧率即可。<br><img src="/../_resources/ba2e311e9e59cfd649509ccc2fa99a0b.png" alt="ba2e311e9e59cfd649509ccc2fa99a0b.png"></p><h3 id="2-帧生成时间（帧间隔）"><a href="#2-帧生成时间（帧间隔）" class="headerlink" title="2.帧生成时间（帧间隔）"></a>2.帧生成时间（帧间隔）</h3><p>表达式：dt<br>刷新频率：每帧1次<br>返回值类型：单精度浮点数，即6位小数<br>（当测量单帧间隔时会返回10位小数）<br>其它：引擎内描述为“时间间隔”<br>建议使用方法：先将数据乘以1000，然后使用roundto()将其化简到1-3位小数，最后加上单位“ms”（毫秒），即可得到友好的数字展示。<br><img src="/../_resources/fb34db0b029a4d27e4ad593e8cc363ac.png" alt="fb34db0b029a4d27e4ad593e8cc363ac.png"></p><h3 id="3-CPU占用（CPU时间）"><a href="#3-CPU占用（CPU时间）" class="headerlink" title="3.CPU占用（CPU时间）"></a>3.CPU占用（CPU时间）</h3><p>表达式：cpuutilisation<br>刷新频率：每秒1次<br>其它：引擎内描述为“CPU在游戏中消耗的时间”<br>返回值类型：双精度浮点数，即18位小数。<br>建议使用方法：先将数据乘以100，然后使用roundto()将其简化到1-2位小数，最后加上百分比符号“%”，即可得到友好的数字展示。<br><img src="/../_resources/68f1e9a186fe3b6660d1936f792cefe6.png" alt="68f1e9a186fe3b6660d1936f792cefe6.png"></p><h3 id="4-GPU占用（渲染消耗时间）"><a href="#4-GPU占用（渲染消耗时间）" class="headerlink" title="4.GPU占用（渲染消耗时间）"></a>4.GPU占用（渲染消耗时间）</h3><p>表达式：gpuutilisation<br>刷新频率：每秒1次<br>其它：引擎内描述为“GPU在游戏中消耗的时间”<br>返回值类型：9位小数。<br>建议使用方法：与CPU占用相同。<br><img src="/../_resources/596e4d2898ce7eb638dca60f52193e12.png" alt="596e4d2898ce7eb638dca60f52193e12.png"></p><h3 id="5-显存占用"><a href="#5-显存占用" class="headerlink" title="5.显存占用"></a>5.显存占用</h3><p>表达式：imagememoryusage<br>刷新频率：每帧1次<br>返回值类型：9位小数。<br>建议使用方法：直接通过表达式获取即可。<br><img src="/../_resources/4b1452908420640a6ac75af4bb2b156e.png" alt="4b1452908420640a6ac75af4bb2b156e.png"></p><hr><h2 id="三、制作性能监控窗口"><a href="#三、制作性能监控窗口" class="headerlink" title="三、制作性能监控窗口"></a>三、制作性能监控窗口</h2><p>光了解了上面所有的信息，但如果不会用，那就都是白搭。接下来，我会一步步解释如何制作游戏内的性能监控悬浮窗。</p><p>1.打开游戏项目，新建对象：一个文本、一个精灵和一个按钮，精灵的贴图替换成一张长方形图片即可<br><img src="/../_resources/799e625f09a212d9e980f8cff86b3a2e.png" alt="799e625f09a212d9e980f8cff86b3a2e.png"></p><p><img src="/../_resources/c6d47b1f64216db3965c811b0afdb06e.png" alt="c6d47b1f64216db3965c811b0afdb06e.png"></p><p>2.新建几个全局变量，“启用测量”、“悬浮窗x”、“悬浮窗y”。其中，第一个是布尔类型变量，是必需的；后两个是数值类型变量，不是必需的。<br>后两个的初始值不建议设为0，应该根据你选择的默认位置来设置。<br><img src="/../_resources/a974999ff46bbac77137dbfc7e819c24.png" alt="a974999ff46bbac77137dbfc7e819c24.png"></p><p>3.新建一个图层组“悬浮窗”，设置为全局图层组，然后将精灵、文本和按钮拖入该图层组中，调整文本和精灵的大小及属性，文本选择左对齐、上下居中对齐，大小跟精灵差不多一样大就行<br><img src="/../_resources/7cf2b2e120c5da549d4cc1c5b5008a36.png" alt="7cf2b2e120c5da549d4cc1c5b5008a36.png"><br><img src="/../_resources/2b26784c58f0c77a067d4447edbd42b4.png" alt="2b26784c58f0c77a067d4447edbd42b4.png"></p><p>4.为文本添加拖拽和定时器能力，为精灵添加绑定能力<br><img src="/../_resources/f2cc5d66755ee2eb24d199e7c453ae46.png" alt="f2cc5d66755ee2eb24d199e7c453ae46.png"><br><img src="/../_resources/1751f48b11198c44c52e8e9cf67c033d.png" alt="1751f48b11198c44c52e8e9cf67c033d.png"></p><p>5.新建一条全局事件表，名称为“性能监控窗口”，或者任何你喜欢的名字。<br><img src="/../_resources/3f181abb7a3ad49aaf2f1b81b178906a.png" alt="3f181abb7a3ad49aaf2f1b81b178906a.png"></p><p>6.开始写事件。可以参考我下面的这种设计方案。<br>核心思路：<br>（1）当“启用测量”变量为“真”时，显示文本和精灵，否则隐藏；注意，不要重复触发，可以加入一个触发器（例如“仅触发一次”）来解决；<br>（2）制作好看的文本排版；<br>（3）避免每帧检测和每帧改变文本；<br>（4）（可选）实现悬浮窗的拖动，以及位置记忆。<br><img src="/../_resources/7b2602a886c2529d6189504f42ae5ff3.png" alt="7b2602a886c2529d6189504f42ae5ff3.png"><br>文本内容供参考：<br>“帧率：” &amp; fps &amp; newline &amp; “CPU：” &amp; roundto(cpuutilisation*100,1) &amp; “%” &amp; newline &amp; “显存：” &amp; imagememoryusage &amp; “mb”</p><p>7.在每个你希望有监控悬浮窗的场景下都新建一个叫做“悬浮窗”的图层组，不需要放入任何内容，因为你之前已经选中了全局事件表。<br>然后将刚才写的全局事件表应用于每个你希望有悬浮窗的场景。<br><img src="/../_resources/9de754a5f74cef3b19451317d1597aa9.png" alt="9de754a5f74cef3b19451317d1597aa9.png"><br><img src="/../_resources/c383bbc3f3d2d8ddb921774cdc2be8c1.png" alt="c383bbc3f3d2d8ddb921774cdc2be8c1.png"></p><p>8.检查效果<br><img src="/../_resources/50611b15f85e9e7e7164bff667699f0d.png" alt="50611b15f85e9e7e7164bff667699f0d.png"></p><p>9.可额外优化的内容</p><p>拖拽能力没有进行区域限制，可以直接把悬浮窗拖到屏幕外，如何解决？<br>· 提示：只需要使用一个能力即可解决。</p><p>事件表里还有可以进一步优化的内容？<br>· 提示：绑定能力。</p><h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>通过这一篇文章的解析和教学，你应该对唤境游戏的性能及其监控方法有了一定的了解。<br>在多数情况下，唤境游戏其实并不需要这么多高级的技术细节，但这类功能可以给你的游戏添砖加瓦，起到锦上添花的作用。<br>文章撰写仓促，部分内容做不到非常细致和详尽，也可能有错误，欢迎大佬前来指正！</p><p>额外优化内容：<br>（1）给文本和精灵分别添加“边界限制”能力即可；<br>（2）在启用测量为假的时候，给精灵添加一条动作：“取消绑定”</p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>未分类</category>
      
    </categories>
    
    
    <tags>
      
      <tag>开发</tag>
      
      <tag>游戏引擎</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>超频你的显示器，获得更佳的流畅体验</title>
    <link href="/blog/%E6%98%BE%E7%A4%BA%E5%99%A8%E8%B6%85%E9%A2%91/"/>
    <url>/blog/%E6%98%BE%E7%A4%BA%E5%99%A8%E8%B6%85%E9%A2%91/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  显示器超频？显示器还能超频？<br>  当然是可以的。从定义上来说，任何以时钟频率进行周期性工作的硬件都有超频的说法，只不过我们平时主要讨论的是CPU、显卡、内存等核心电脑硬件的超频。<br>  某种意义上来说，显示器超频实际上是一个很古老的话题。在以前的“大屁股”显示器（即CRT技术的显示器）时代，超频就已经存在了。由于最开始的显示器都是纯模拟信号，输入的电压经过放大后直接作用于偏转电场，从而实现画面绘制，那时候的显示器超频是真正意义上的物理超频。只要阴极射线管的水平够好、电场板的素质优秀，显示器的各项工作参数完全可以自定义。<br>  后来用了LCD和纯数字信号传输，超频的内容发生了一些变化；不过多数面板仍然会有超频能力，这取决于厂家的配置与面板本身的素质。<br><img src="/../_resources/95a04f46fce4449551b3b11e14510900.png" alt="95a04f46fce4449551b3b11e14510900.png"><br><em>图：LCD与CRT显示器原理对比</em></p><h2 id="什么是显示器超频"><a href="#什么是显示器超频" class="headerlink" title="什么是显示器超频"></a>什么是显示器超频</h2><p>  所谓的显示器超频，实际上是针对其运行参数<strong>垂直刷新率</strong>而言的。<br>  在以前的CRT显示器上，显示画面需要电子枪从左往右依次发射电子、扫描一行，点亮一行的荧光像素，随后在垂直同步信号的作用下迅速回到左侧，同时跳转到下一行，重新进行下一行的扫描。以此类推，直到整个荧幕被扫描完成后，电场会使电子偏转到左上角，重复这个过程。（此处还有水平同步信号在起作用，不详细说明）<br>  玩过模拟示波器的朋友肯定能理解垂直信号的作用，实际上就是示波器中的扫描电路，选择合适的扫描信号就能使波形稳定。<br>  因此，如果能调节垂直（和水平）同步信号，使其可以在更短的时间内完成一次完整的扫描，则显示器的<strong>刷新率</strong>就能得到提升。<br>  这就是显示器超频，我们希望提升其垂直刷新率，使其比标称值更高，这样才会有更好的体验。</p><h2 id="显示器超频的影响因素"><a href="#显示器超频的影响因素" class="headerlink" title="显示器超频的影响因素"></a>显示器超频的影响因素</h2><p>  要完成一次好的显示器超频，我们通常认为有以下几点因素会影响结果。</p><ul><li>面板类型与素质</li><li>厂商限制</li><li>接口类型与传输质量</li><li>合适的配置</li><li>其它因素</li></ul><p>以上因素中，面板和厂商在购买后就固定了，无法更改。<br>接口类型以DP、HDMI（高版本）为优。</p><p><strong>请不要将显示器的超频能力纳入选购的考虑范围之中，如果想获得高刷屏的体验，那么建议选购原生的高刷显示器。本文的核心目的是科普，而不是鼓励大家要求厂商提供超频能力。</strong></p><h2 id="如何超频"><a href="#如何超频" class="headerlink" title="如何超频"></a>如何超频</h2><h3 id="超频前的准备"><a href="#超频前的准备" class="headerlink" title="超频前的准备"></a>超频前的准备</h3><ol><li>检查接口协议与传输质量<br> 请使用优质DP或HDMI线连接电脑与显示器，以获得更佳的超频能力。<br> 该项主要影响传输带宽，对于特定版本的DP或HDMI接口而言，其能提供的带宽是有限的。详情可查阅百度。<br> 只需要记得一点，如果带宽受限，那么降低分辨率有助于获得更高的刷新率。但是对于多数平民显示器而言，即使使用最高分辨率，也不太会出现带宽不足的问题。</li><li>检查视频信号源<br> 目前来说，英特尔核心显卡并不支持显示器超频（至少笔记本的不行）。如果您使用台式机，请确保视频信号是独立显卡输出的。如果使用笔记本，请连接到笔记本上的type-c接口，一般而言这个接口的显示输出是直接连接独立显卡的。<br> 如果使用不支持独显直连输出的笔记本（或者没有独显），则大概率不能成功。<br> 不过，即便如此，您还是可以进行尝试。大多数出厂60Hz的显示器都可以直接提升到75Hz，带来一定程度上的体验提升。不过有一个例外，笔记本自带的屏幕完全不支持超频。</li><li>环境条件<br> 尽管现代显示器对工作环境的承受范围极大，环境因素的影响极其小，合适的环境仍然有助于提高超频成功率。<br> 主要包括合适的工作温度（尤其是不能过低），湿度，电压值与稳定性，甚至摆放方向等。</li></ol><h3 id="开始超频"><a href="#开始超频" class="headerlink" title="开始超频"></a>开始超频</h3><ul><li>对于非独立显卡、英特尔核心显卡：<br>  请进入显卡控制面板（以下以新版英特尔核心显卡为例）<br>  <img src="/../_resources/ce3133202184eb787a2034f31476db94.png" alt="ce3133202184eb787a2034f31476db94.png"><br>  点击<strong>显示器</strong>，<strong>分辨率旁边的加号</strong><br>  <img src="/../_resources/245a61028b5e9c9e71d6d6abb786ff57.png" alt="245a61028b5e9c9e71d6d6abb786ff57.png"><br>  检查是否有刷新率的选项。如果有，可以尝试输入目标刷新率，然后单击确定。<br>  若不成功或没有输入刷新率的地方，则您的显卡不支持硬超频。<br>  请尝试点击<strong>刷新率</strong>旁的下拉框<br>  <img src="/../_resources/319d41963a5966fc42fe60ac72c0cb2f.png" alt="319d41963a5966fc42fe60ac72c0cb2f.png"><br>  若有多个选项，选择最高的。若有I和P两种，请选择P。<br>  至此，显示器超频结束。</li></ul><hr><ul><li>对于英伟达、AMD独立显卡：<br>  请进入显卡控制面板（以下以英伟达显卡为例）；应该能在[开始]菜单里找到。<br>  若电脑里找不到该软件，请重装显卡驱动程序。<br>  <img src="/../_resources/345495b609471f763f8ec8bfc8df62df.png" alt="345495b609471f763f8ec8bfc8df62df.png"><br>  在屏幕左侧，单击[更改分辨率]。<br>  如果没有此选项，则说明显示器没有连接到独立显卡上。<br>  <img src="/../_resources/2e632685ea988d1cf03dc6d60b7493ac.png" alt="2e632685ea988d1cf03dc6d60b7493ac.png"><br>  点击[自定义]。<br>  <img src="/../_resources/ec04c76fa5c31fbee854410f0c96b663.png" alt="ec04c76fa5c31fbee854410f0c96b663.png"><br>  勾选[启用显示器未显示的分辨率]，然后点击[创建自定义分辨率]。<br>  <img src="/../_resources/ed628697647b0ae7a7af0b97615d93e1.png" alt="ed628697647b0ae7a7af0b97615d93e1.png"><br>  在[刷新率]中输入目标刷新率，然后可以点击[测试]按钮进行测试。<br>  在[计时 - 标准]选项中选择[协同视频计时标准（CVT）降低清屏时间]，可能有助于提高成功率。<br>  <img src="/../_resources/79a358cee11fbd4de054a918720205a4.png" alt="79a358cee11fbd4de054a918720205a4.png"><br>  单击[测试]按钮，显示器将黑屏进行切换。<br>  如果成功，则您将很快看到电脑画面。如果半成功，则可能会看到画面上出现抖动、条纹、异常颜色等。<br>  如果失败，显示器提示不支持或一直黑屏，等待15s后会自动退出测试状态。或者，可以按Esc键快速返回。<br>  当测试到稳定的刷新率后，在提示框中点击[是]，即可保存该分辨率。<br>  返回上一步的[更改刷新率]，应该能在列表最顶上看到刚刚创建的分辨率。<br>  选中后，单击软件右下角的[应用]，超频结束。</li></ul><hr><h3 id="超频提示"><a href="#超频提示" class="headerlink" title="超频提示"></a>超频提示</h3><ul><li>尽管超频一般不会造成伤害，仍可能导致面板发热加剧、液晶老化速率提高等问题。因此，从理论上讲，不建议长时间超频。</li><li>在超频过程中，可以使用以下方法先确定显示器能承受的最大刷新率：<ul><li>先将刷新率定到目标值</li><li>若成功，则进一步定到下个目标值；否则，应选择当前刷新率与目标值的中间值。</li><li>重复以上取中值的过程，通过二分法可以快速定位到最大刷新率。</li><li>确定了最大值后，请适当降低到附近合适的数值使用。例如，若最大刷新率为96Hz，请保持在90Hz即可。</li></ul></li><li>若超频过程中显示器出现严重事故（如一直黑屏、闪屏等），请断开视频连接线，然后断开显示器电源；等待几分钟或使其完全放电后重新接入电源，检查显示器是否能正常开机，然后再接入电脑。由于现代显示器的保护功能极佳，真正发生无法挽回事故的可能性极低，近乎不存在，但并不为0。</li></ul><h3 id="超频经验"><a href="#超频经验" class="headerlink" title="超频经验"></a>超频经验</h3><p>对于一般的1080P、60Hz显示器而言，75Hz是日常使用的较佳水平。某些素质较高的显示器可能会一路支持到80、90甚至110Hz，全看厂商良心与运气。<br>对于2K、60Hz的显示器，一般也可以使用75Hz。我自己的2K60显示器最大支持98Hz，稳定值是96Hz，最终保持在90Hz使用。<br>对于144Hz的显示器，一般直接上165Hz是没有问题的。较好的面板可以尝试180Hz。<br>更高的不知道，我没钱（</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>  没啥可总结的，超个频，获得更好的体验和更高的风险，这是一种交易。权衡结果全由你自己掌控。<br>  任何问题欢迎留言！</p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>计算机</category>
      
    </categories>
    
    
    <tags>
      
      <tag>超频</tag>
      
      <tag>硬件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用批处理和Joplin执行并优化Hexo博客工作流程</title>
    <link href="/blog/%E6%89%B9%E5%A4%84%E7%90%86%E4%BC%98%E5%8C%96Hexo%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/"/>
    <url>/blog/%E6%89%B9%E5%A4%84%E7%90%86%E4%BC%98%E5%8C%96Hexo%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>使用静态部署的方式使用Hexo，我们经常会遇到一个很烦人的问题，就是部署麻烦。<br>每次写一篇文章，就要经历<strong>Hexo clean、Hexo g、Hexo s、Hexo d</strong>四连，一开始还好，写多了之后烦不胜烦。</p><p>同时，由于我个人使用Joplin进行文章撰写，这个软件虽然简洁，但并不好用；图片虽然可以直接复制，但不能修改输出目录，图片资源默认保存在与<code>/blog/</code>平行的<code>/_resources/</code>文件夹中。</p><p>因此，结合我最为擅长的batch脚本语言，我就萌生了使用批处理来优化整个流程的想法。</p><hr><h3 id="1-Git安装配置（不确定是否有必要）"><a href="#1-Git安装配置（不确定是否有必要）" class="headerlink" title="1. Git安装配置（不确定是否有必要）"></a>1. Git安装配置（不确定是否有必要）</h3><p>在安装Git的过程中，我们会有一个配置终端的过程，此处其实是建议选择第一项（使用MinTTY），但我当时选择了第二项即使用系统的cmd来作git bash的终端。<br><img src="/../_resources/aca6779be5b5f5c9d88dc1215456c295.png" alt="aca6779be5b5f5c9d88dc1215456c295.png"><br>如果选择了第一项，可能也是能正常使用批处理来代替执行的，应该不用担心。</p><hr><h3 id="2-站点配置"><a href="#2-站点配置" class="headerlink" title="2. 站点配置"></a>2. 站点配置</h3><p>blog根目录下的_config.yml文件：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-string">......</span><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">relative_link:</span> <span class="hljs-literal">false</span><br><span class="hljs-string">......</span><br></code></pre></td></tr></table></figure><p>使用Joplin写文章的话应该关闭这两项（至少我测试下来这样是没问题的）</p><hr><h3 id="3-脚本编写"><a href="#3-脚本编写" class="headerlink" title="3. 脚本编写"></a>3. 脚本编写</h3><p>在blog根目录下新建“程序名.bat”，开始编写功能。<br>先放源码：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">setlocal</span> EnableDelayedExpansion<br><span class="hljs-keyword">goto</span> <span class="hljs-built_in">start</span><br>:ac<br><span class="hljs-comment">rem 请设置%targetlable%变量，以确保正常跳转至目标位置</span><br><span class="hljs-built_in">cls</span><br><span class="hljs-built_in">color</span> <span class="hljs-number">0</span>F<br><span class="hljs-keyword">goto</span> <span class="hljs-variable">%targetlabel%</span><br>:<span class="hljs-built_in">start</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%targetlabel%</span>&quot;==&quot;&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">1</span>.执行完整的检查和推送blog流程<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">2</span>.快速上载blog<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">3</span>.本地预览<br><span class="hljs-built_in">echo</span>  <span class="hljs-number">4</span>.单独执行指令<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>.<br>choice /c <span class="hljs-number">1234</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">4</span>&quot; <span class="hljs-keyword">goto</span> new<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">3</span>&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=local&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=fast&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">1</span>&quot; (<span class="hljs-built_in">set</span> &quot;targetlabel=full&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac)<br><span class="hljs-built_in">pause</span>&amp;<span class="hljs-keyword">exit</span><br>:new<br><span class="hljs-built_in">echo</span> 正在创建新的<span class="hljs-built_in">cmd</span>实例...<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 命令提示：<br><span class="hljs-built_in">echo</span> hexo clean<br><span class="hljs-built_in">echo</span> hexo g<br><span class="hljs-built_in">echo</span> hexo s<br><span class="hljs-built_in">echo</span> hexo d<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">start</span> <span class="hljs-built_in">cmd</span><br><span class="hljs-built_in">echo</span> 按任意键返回菜单...<br><span class="hljs-built_in">pause</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac<br>:local<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>                  本地预览模式<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 启动预览...<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean &amp; hexo g &amp; <span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; <span class="hljs-built_in">start</span> http://localhost:<span class="hljs-number">4000</span>/ &amp; hexo s&quot;<br><span class="hljs-built_in">echo</span> 按任意键返回菜单...<br><span class="hljs-built_in">pause</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac<br>:fast<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>                  快速上载blog<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean &amp; hexo g &amp; <span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; hexo d&quot;<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 完成，<span class="hljs-number">2</span>秒后退出...<br><span class="hljs-built_in">ping</span> localhost -n <span class="hljs-number">3</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-keyword">exit</span><br>:full<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span>                  完整流程向导<br><span class="hljs-built_in">echo</span>              按<span class="hljs-number">0</span>为确定，按<span class="hljs-number">1</span>为跳过<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-keyword">goto</span> clean<br>:clean<br><span class="hljs-built_in">echo</span> 第一步：清理缓存<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> generate<br><span class="hljs-built_in">cmd</span> /c &quot;hexo clean&quot;<br><span class="hljs-keyword">goto</span> generate<br>:generate<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 第二步：生成页面<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> check<br><span class="hljs-built_in">cmd</span> /c &quot;<span class="hljs-built_in">xcopy</span> D:\blog\source\_posts\_resources D:\blog\public\blog\_resources\ /e /s /y &amp; <span class="hljs-built_in">echo</span> <span class="hljs-number">2</span>&gt;D:\blog\.deploy_git\.nojekyll &amp; hexo g&quot;<br><span class="hljs-keyword">goto</span> check<br>:check<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 第三步：本地预览<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> deploy<br><span class="hljs-built_in">start</span> http://localhost:<span class="hljs-number">4000</span>/<br><span class="hljs-built_in">cmd</span> /c &quot;hexo s&quot;<br><span class="hljs-keyword">goto</span> deploy<br>:deploy<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 第四步：上传到远程服务器<br>choice /c <span class="hljs-number">01</span><br><span class="hljs-keyword">if</span> &quot;<span class="hljs-variable">%errorlevel%</span>&quot;==&quot;<span class="hljs-number">2</span>&quot; <span class="hljs-keyword">goto</span> done<br><span class="hljs-built_in">cmd</span> /c &quot;hexo d&quot;<br><span class="hljs-keyword">goto</span> done<br>:done<br><span class="hljs-built_in">echo</span> ------------------------------------------------<br><span class="hljs-built_in">echo</span> 流程已完成，按任意键返回菜单...<br><span class="hljs-built_in">pause</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-built_in">set</span> &quot;targetlabel=<span class="hljs-built_in">start</span>&quot;&amp;&amp;<span class="hljs-keyword">goto</span> ac<br></code></pre></td></tr></table></figure><p>我自认为自己的批处理写得都算比较清晰的了，虽然注释很少，但结合文字应该能看懂每一步是在干什么。<br>如果要使用，请把里面所有的<code>D:\blog\source\_posts\_resources</code>替换为你Joplin每次导出时的资源目录，把所有的<code>D:\blog\public\blog\_resources\</code>替换为你的博客站点目录，注意不要动<code>\public\...</code>后面的内容。</p><p>如果要更换功能模块，也应按照这里的写法，使用 <code>cmd /c 命令内容 &amp; 第二条命令 &amp; 后面的很多命令</code> 来执行，除了start用于启动网页之外尽量不要直接在批处理中使用模块的命令，否则容易直接闪退。</p><p>创建<code>.nojekyll</code>文件的目的是防止GitHub忽略掉下划线开头的文件夹，即<code>_resources</code></p><hr><h3 id="4-工作流程"><a href="#4-工作流程" class="headerlink" title="4. 工作流程"></a>4. 工作流程</h3><p>现在，我们可以愉快地写文章了。<br>打开Joplin，新建笔记（记得都放在同一个笔记本下），笔记的名字是文件名，写上Front-matter内容，之后就如同在word中一样写稿。<br>图片直接粘贴即可，需要的话修改 [ ] 里的内容，这是属于markdown语法的一部分，不详细说明。<br>写完的文章直接往<code>blog\source\_posts</code>里面一存，然后打开脚本按个2，等两分钟就部署到Github Pages上了。<br><strong>愉快地工作吧！</strong><br><img src="/../_resources/cf0fb99a327ef788a844524d6eb74278.png" alt="cf0fb99a327ef788a844524d6eb74278.png"></p><p>补充点内容，修改文章稍微有点麻烦，因为Joplin非常笨，它不会识别已有的文件，发现重名了直接加后缀，连带着里面的图片也都加后缀、重新复制到<code>_resources</code>里面了；对于我这种硬盘空间够、平时图片不多的人来说倒是无所谓，但部署了之后文章会重复显示好几篇。所以不能直接导出文章，需要手动删除旧的，然后再从Joplin中导出即可。</p>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>疫情爆炸，如何积极面对</title>
    <link href="/blog/%E9%9A%8F%E8%AE%B020221125/"/>
    <url>/blog/%E9%9A%8F%E8%AE%B020221125/</url>
    
    <content type="html"><![CDATA[<p><img src="/../_resources/bae16920a3e51780c72e170d6411a8ac.png" alt="bae16920a3e51780c72e170d6411a8ac.png"><br>人在上课，突闻噩耗。<br>虽然现在的新冠并没有两年前那么恐怖，见者九死一生，但仍然是流感中较为严重的一类。   </p><p>最近全国各地都突然严重爆发，我学校的老校区也出现了阳性感染者，这实在不是什么好消息。<br>不过，疫情虽然对经济冲击严重，但我们仍然可能可以从另一个角度思考问题，试图以积极的方式面对。</p><hr><p>在2020年中，大约是（延期后的）高考结束的那个暑期，我们经历了一次非常恐怖的矿潮。那时候，显卡的价格飞涨到一个离谱都不足以形容的地步，而正值开学季的准大学生们则欲哭无泪：想买电脑，根本抢不到！<br>尽管当时笔记本电脑缺货更多是由于芯片供应短缺造成的，但挖矿的影响同样不可忽视。而就在大家想着如何用合理的价格买到自己心仪的显卡时，有一些人则希望大家能够从另一个角度来看待这个问题。</p><blockquote><p>“_有时候达成你的目标和需求不止一种方法；面对畸形的市场，与其抱怨，不如换一种新的思维来看待这件事_”</p></blockquote><p>这句话确实给了我不少启发和灵感。</p><hr><h3 id="这是一个给你折腾机会的完美时机"><a href="#这是一个给你折腾机会的完美时机" class="headerlink" title="这是一个给你折腾机会的完美时机"></a>这是一个给你折腾机会的完美时机</h3><p>所谓折腾，就是你可以干任何以前你想干但缺乏时机的事。当然，如果你想环游世界，那可能还是之后再说吧（？）<br>举个例子，我利用高中被疫情困在家里的时间，自己学习了非常多的东西，包括但不限于：</p><ul><li>网络工程与应用</li><li>服务器搭建与优化</li><li>网页前端设计</li><li>游戏开发入门</li></ul><p>这些都是我理解的“折腾”，平时由于高三学习压力较大、学校里不能自由使用手机和电脑，这些东西都没有机会学习和实践。<br>而利用好了这几个月，我认为我在折腾中收获颇丰，并为进入大学后的生活提供了十足的帮助。</p><p><img src="/../_resources/a5e6e966826c7b2508826b512966be12.png" alt="a5e6e966826c7b2508826b512966be12.png"><br>这是我在一个月内做的网页前端设计，并应用于自己家庭的内网中，以便实现我的学习电脑与打印服务器电脑（配置很低很卡）之间进行快速的文件传输和通信。</p><hr><h3 id="这是一个可以锻炼你眼光的合理时机"><a href="#这是一个可以锻炼你眼光的合理时机" class="headerlink" title="这是一个可以锻炼你眼光的合理时机"></a>这是一个可以锻炼你眼光的合理时机</h3><p>如果要折腾，你肯定免不了要花点钱，有的甚至开销很大（比如我喜欢折腾电脑硬件，这就是花费很高的一种）。但正是因为花销大，才能锻炼我的眼光，确切来说是我选购东西的眼光。</p><p>最近正在考虑折腾一个服务器电脑。家里有闲置的笔记本和台式机，也许我可以改造台式机，重新选择ITX机箱和静音散热器，并将其作为服务器主机使用。<br>或者，也可以另外花费240左右购买J1900准系统迷你主机，这种方案的优势是被动散热无噪音、寿命长，硬盘我已经有一块可用的SSD，还可以顺便折腾Windows server 2007等系统，加上我本人对能折腾的迷你电脑比较感兴趣，这似乎是不错的选择。<br>然而，这个方案最大的问题就是开销更多；买一个ITX机箱+低噪散热器的价格显然低于准系统+内存的价格，所以这就对我的选购能力提出了严峻的挑战。虽然我并没有实际购买，但在这个过程中，我能感觉到自己网购眼光的提升。</p><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>积极面对这**的世界，听起来并不是一件轻松的事，毕竟谁能在生存受阻的情况下坦然自若呢？但是，苦中作乐本就是身具人性的最大优势，而我们不应该让其淹没在无穷无尽的原始需求中。<br>最后，为这个尚存一线美好的世界送上祝福，希望每个真诚的人都能被温柔以待。<br><img src="/../_resources/a15b89a10fa9a65103dc7e49a3856ea7.png" alt="a15b89a10fa9a65103dc7e49a3856ea7.png"></p><hr>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
      <category>生活</category>
      
    </categories>
    
    
    <tags>
      
      <tag>日常</tag>
      
      <tag>生活</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WPS word如何设置图片背景，如何解决图片变成平铺问题</title>
    <link href="/blog/WPS-word/"/>
    <url>/blog/WPS-word/</url>
    
    <content type="html"><![CDATA[<h2 id="WPS-word如何设置图片背景，如何解决图片变成平铺问题"><a href="#WPS-word如何设置图片背景，如何解决图片变成平铺问题" class="headerlink" title="WPS word如何设置图片背景，如何解决图片变成平铺问题"></a>WPS word如何设置图片背景，如何解决图片变成平铺问题</h2><p>问题描述：在WPS word中插入背景图片，导出为PDF、打印后发现图片变成平铺，如图所示<br><img src="/../_resources/1bed71e7e0b967daa78642a737810d17.png" alt="1bed71e7e0b967daa78642a737810d17.png"></p><hr><p>1.打开需要插入背景图片的文档<br>2.点击：页面布局、背景、其它背景、纹理<br><img src="/../_resources/88b258680c69021372dab599663945bd.png" alt="88b258680c69021372dab599663945bd.png"> </p><p>3.选择“其它纹理”，选择图片后点击确定<br><img src="/../_resources/a4d5ca84c954b134351ea2d9c8d9881c.png" alt="a4d5ca84c954b134351ea2d9c8d9881c.png"></p><p>4.现在背景图片应该可以正常导出了。</p><hr>]]></content>
    
    
    <categories>
      
      <category>学习</category>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>傅里叶变换红外光谱技术原理详解</title>
    <link href="/blog/FTIR%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
    <url>/blog/FTIR%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>一、物理基础<br>1.1 红外光谱基本原理<br>1.2 FTIR光谱仪构成与基本运行过程<br>1.3 干涉现象<br>1.3.1 波的叠加<br>二、信号与系统<br>2.1 数字、模拟信号<br>2.1.1 信号<br>2.1.2 模拟信号<br>2.1.3 数字信号<br>2.2 信号转换<br>2.2.1 采样与A&#x2F;D转换<br>2.2.2 奈奎斯特采样定理<br>2.2.3 混叠<br>2.3 傅里叶变换（FT）<br>三、FT在FTIR中的具体原理<br>3.1 仪器工作流程详解<br>3.2 信号检测与采样<br>3.3 数据处理<br>四、总结与展望<br>4.1 总结与心得<br>4.2 未来展望</p><h1 id="傅里叶变换红外光谱技术原理详解"><a href="#傅里叶变换红外光谱技术原理详解" class="headerlink" title="傅里叶变换红外光谱技术原理详解"></a>傅里叶变换红外光谱技术原理详解</h1><h2 id="一、物理基础"><a href="#一、物理基础" class="headerlink" title="一、物理基础"></a>一、物理基础</h2><h3 id="1-1-红外光谱基本原理"><a href="#1-1-红外光谱基本原理" class="headerlink" title="1.1 红外光谱基本原理"></a>1.1 红外光谱基本原理</h3><p>  当一束红外光射到物质上，可能发生：吸收、透过、反射、散射或者激发荧光。其中，我们需要的部分是吸收的量。然而，对于仪器来说，直接测量吸光度似乎并不现实；因此，我们一般采用已知强度的光源以及透过量来代替吸光度。<br>  红外光，本质上是一段频率特殊、无法被人眼看见的电磁波，其波长一般为0.75-1000nm，频率约为300GHz~430THz。与之相似的包括微波（或Wi-Fi、5G网络的毫米波）、FM广播等无线电波和其它。<br>  对于红外光谱分析，我们一般选用其中的一段波长（或频率、波数）为目标光。采用色散元件，我们可以将光源发射的连续光谱（类似包含全部可见光波长而显白色的太阳光）分解为需要的单色光（只包含一种波长的光），然后让其通过样品、测定吸光度。<br>  其余的红外光谱原理可查阅课本，此处不再赘述。</p><h3 id="1-2-FTIR光谱仪构成与基本运行过程"><a href="#1-2-FTIR光谱仪构成与基本运行过程" class="headerlink" title="1.2 FTIR光谱仪构成与基本运行过程"></a>1.2 FTIR光谱仪构成与基本运行过程</h3><p>  FTIR光谱仪，即Fourier Transform Infrared Radiation Spectrometer，傅里叶变换红外辐射光谱仪（以下简称FTIR或FFTIR），就是一种用于红外光谱测定的仪器。与普通的红外光谱仪不同，FTIR不具有单色器，而是以迈克尔逊干涉仪取代，并且对计算机系统尤为依赖、几乎不可能通过人力来计算其光谱图。<br>  FTIR的运行流程可以概括为：光源发射红外线 – 干涉仪动作产生干涉光 – 干涉光通过样品到达检测器 – 光电二极管或其它检测器将光强转换为电信号 – 传入计算机进行数据处理。其中，光源发射的红外线包括整个需要测定的频率范围，而干涉仪需要持续动作以产生需要的干涉光；干涉光的性质与检测器信号是一一对应且已知的。</p><h3 id="1-3-干涉现象"><a href="#1-3-干涉现象" class="headerlink" title="1.3 干涉现象"></a>1.3 干涉现象</h3><p>  1801年，英国物理学家托马斯·杨在实验室里成功地观察到了光的干涉，以下就是经典的双缝干涉实验。<br><img src="/../_resources/d6cfc0c663cbda269660f8f4e96683a7.png" alt="双缝干涉现象.png"></p><p>  简而言之，同一束光线从不同的位置发出时，在后面的空间内就会发生干涉现象；或者说，当一束光“碰到”另一束光时，两束光发生干涉现象。通俗的例子是，当身边有一个持续频率的声音（例如蜂鸣器报警），人站在房间的不同位置就会听到音量大小不同，在某些角落时这个声音甚至会几乎完全消失，这也是干涉现象的一种体现。</p><h4 id="1-3-1-波的叠加"><a href="#1-3-1-波的叠加" class="headerlink" title="1.3.1 波的叠加"></a>1.3.1 波的叠加</h4><p>  我们都知道如何画y&#x3D;sin x的函数图像，它是一个正弦曲线。但是，如果在同一个空间和时间内，有另一个波源发射了另一个正弦曲线，并且它的解析式是y&#x3D;sin (1.1x)，这时候两个波发生叠加，我们又如何画出y&#x3D; (sin x) + sin (1.1x)的曲线图呢？<br><img src="/../_resources/d02ac3e559fc44f7eb9ca6216a6c5b97.png" alt="波的叠加图.png"></p><p>  使用现代化的图形计算器，我们可以很轻松地通过计算机画出上述叠加波的函数图像。很明显，叠加波的振幅（也就是一个周期内的最大y值）在周期性变化，但我们仍然可以看到sin x的痕迹；似乎就是sin x的振幅被周期性地“压缩”，而这个压缩的方式仍然是一个正弦样子。<br>  也许这些内容已经难以理解了，但我们只需要知道，多个波在叠加之后会产生新的波，而这个叠加波的形态与每个单独的波似乎没有太过直接的关联。</p><h2 id="二、信号与系统"><a href="#二、信号与系统" class="headerlink" title="二、信号与系统"></a>二、信号与系统</h2><h3 id="2-1-数字、模拟信号"><a href="#2-1-数字、模拟信号" class="headerlink" title="2.1 数字、模拟信号"></a>2.1 数字、模拟信号</h3><h4 id="2-1-1-信号"><a href="#2-1-1-信号" class="headerlink" title="2.1.1 信号"></a>2.1.1 信号</h4><p>  所谓信号，指的是能传递信息的某种载体。例如现在屏幕上显示的文字，就是一种传递文字信息的信号。这是一个抽象的概念，但有太多实际的例子。接下来的篇幅里，我们将大量使用声音，一种最常见的信号为例，讲解信号与系统的浅层内容。</p><h4 id="2-1-2-模拟信号"><a href="#2-1-2-模拟信号" class="headerlink" title="2.1.2 模拟信号"></a>2.1.2 模拟信号</h4><p>  所谓模拟信号，指的其实是连续的信号；例如我们听到的声音，实际上是声源产生的机械振动，导致空气被压缩和扩张，这个不断变化的气压传入耳朵，再通过复杂的器官系统，我们就能听到声音。这个过程中，物体的机械振动是连续的，它并不会突变。如果难以理解，那么可以想象一下，如果一个物体的振动发生了一次突变，这意味着它振动面上的分子发生了瞬间移动，也就是在0秒内产生了大于0的位移，其速度超过了光速；显然，这对于声波来说是不可能的。因此，我们听到的声音就是连续的信号。</p><h4 id="2-1-3-数字信号"><a href="#2-1-3-数字信号" class="headerlink" title="2.1.3 数字信号"></a>2.1.3 数字信号</h4><p>  数字信号，也可以叫离散信号，是信号的一种类型。这个名词听上去很高级，但实际上它跟模拟信号没有太大的区别。它们都是信号，只不过形式不同。<br>  我们知道，模拟信号是连续的信号。仍然以声波为例，如果我们将声音与时间的关系画在一张图上，这就是所谓的声波图。<br><img src="/../_resources/3ac9e78249d54b91cda7d894e5a661c3.png" alt="声波图1.png"></p><p>  现在，假设我们希望保存下来这一段声波，并希望它能在一定条件下重现出来。但是，模拟信号是连续的，这意味着它在时间上不存在断点，它包含的数值为无穷多个。显然，计算机无法记录无穷多个数据，实际上我们也没有必要全部记录下来。我们只需要每隔一段时间记录一个数据，这样就可以将无限的数据变成有限，并且似乎也有很大的希望能够重现出来（至少在能接受的损失范围内）。这个过程与逻辑将在下文介绍。</p><h3 id="2-2-信号转换"><a href="#2-2-信号转换" class="headerlink" title="2.2 信号转换"></a>2.2 信号转换</h3><h4 id="2-2-1-采样与A-D转换"><a href="#2-2-1-采样与A-D转换" class="headerlink" title="2.2.1 采样与A&#x2F;D转换"></a>2.2.1 采样与A&#x2F;D转换</h4><p>  刚才我们提到了模拟信号转换到数字信号的过程。实际上，这就是ADC（Analog to Digital Converter，模拟到数字转换）的工作原理。我们只需要在尽可能短的时间间隔内记录数据，这样至少主观上我们就可以重现它。<br><img src="/../_resources/4561bc52e3a14c62efb44bf598c3ee35.png" alt="采样过程.png"></p><p>  这张图展示的就是一个正弦波经过转换后的结果，每个圆圈代表一个数据点；这样，无限的信号变成了有限的数据点，我们也能通过点的走向看出来它是一个正弦波。这个过程，我们称之为“采样”（Sampling）。采样的结果，就是将连续信号转换为有限个的采样点（Sample）。<br>  反之，我们也可以通过DAC过程，将采样后的离散信号再次转换回模拟信号；这样，你存储在手机里的音乐就能再次变成连续的电信号，并通过扬声器的振膜再变成机械振动。由于这个过程涉及过多的电子工程学内容，并且对于本文所论述的信号处理而言没有太大价值，因此不在此处展开。</p><h4 id="2-2-2-奈奎斯特采样定理"><a href="#2-2-2-奈奎斯特采样定理" class="headerlink" title="2.2.2 奈奎斯特采样定理"></a>2.2.2 奈奎斯特采样定理</h4><p>  现在，我们知道了采样的过程，就是用大量的数据点来描述原信号。但是，这个大量到底是多少？我们说“尽可能短的时间间隔内”，这个间隔到底是多少？<br>  在回答以上问题之前，我们先想象一下刚才的采样图：里面有很多的数据点，因此我们可以“脑补”出原来的信号。但是如果数据点太少，我们还能这样“脑补”吗？显然，可能就会有损失，甚至会丢失。<br>  庆幸的是，我们有一个定理，它给出了这个最小数据点数的限制，它就叫奈奎斯特采样定理。<br>  奈奎斯特定理的原文是：任何有限带宽的连续信号都可以被完美转换为数字信号，只要采样频率高于原信号中最高频率分量的2倍。<br>  太长了看不懂，没关系，我们分别来解释一下它的含义。   </p><p>  首先，我们要知道采样率的定义。刚才说到的“最小时间间隔”，其实就是指采样点的间隔；而它的倒数就是采样率。采样率的含义是，每秒的采样点数量，单位是Hz（赫兹）。<br>  然后，我们有一个信号频率的概念；我们知道，人耳能听到的声音频率范围是20-20kHz，这里的频率指的是声源机械振动的频率。<br>  现在，我们希望录音机能够回放的声音频率覆盖人耳的听觉频率范围，这样它录制的声音才跟最开始的声音能尽可能地一致。现在就轮到奈奎斯特定理上场了，我们的录音机采样率需要＞20kHz x 2 &#x3D; 40kHz，才能保证它可以记录到人耳的听觉上限。<br>  没错，奈奎斯特定理就是这么简单的应用。如果我们想将一个最高频率为100Hz的信号无损转换为数字信号，我们的采样率就要大于200Hz，仅此而已。实际上，多数现代音频以44.1kHz或48kHz的采样频率进行采样，以保证完全覆盖人耳听觉频率范围。<br>  这就结束了吗？奈奎斯特定理真的能如此简单和完美地指导我们开发电子设备吗？显然不是的。它只是一种理想情况下的描述，实际上我们的仪器采样率都是有限的，存储设备的空间也是有限的，这就意味着很多时候我们的采样率并不能达到要求的2倍于最高频率（我们称之为奈奎斯特频率，以下简称Nf），而这时候，我们就遇到了采样过程的最大问题——混叠。   </p><p>  这里还有一个小插曲，你可能会说，采样之后的数字信号是离散的数据点，它怎么能够无损转换回模拟信号呢？我难道不可以在数据点之间随便画我想要的图形吗？<br>  很抱歉，你确实不可以。这就是奈奎斯特采样定理的美丽之处了，它从数学上证明了，我们还原回去的那个信号，就是这一段数字信号转换到模拟信号时的唯一解。如果你试图在其中画更多的内容，那么它就会产生高于奈奎斯特频率的内容，那么在还原时由于频率的限制，这些内容就会丢失，最后仍然会变成原来的波形。</p><h4 id="2-2-3-混叠"><a href="#2-2-3-混叠" class="headerlink" title="2.2.3 混叠"></a>2.2.3 混叠</h4><p>  什么是混叠（Aliasing）？<br>  我们从一个生活中常见的例子来说明——车轮效应。<br>  如果你在电视上看节目，或者自己拍摄视频，然后画面里包含了汽车、自行车的车轮运动，你可能会注意到一个奇怪的现象：当车从停止开始加速时，你看到画面里的车轮逐渐加快；但当加速到一定水平后，不仅车轮没有更快，反而逐渐开始减速，直到某个时候车轮在画面里看起来跟静止一样；如果车继续加速，你甚至会看到车轮开始反方向旋转。<br>  没错，这就是混叠；确切来说，是图像信息在时间域上的混叠。<br>  发生车轮效应的原因是，摄像机的拍摄并不是记录连续的运动画面，而是相当于一个快速连拍的过程，它每秒拍摄一定数量（一般是24或30）的照片，然后在你观看视频的时候以相同的速度快速播放照片；由于人眼的视觉暂留，我们就看到的连续的运动画面。<br>  但是，你可能已经注意到了，这里摄像机并没有记录原始的连续画面，它的工作更像是一个“采样”的过程。是的，这确实是一种采样，并且我们看到了采样过程中最大的问题：混叠。它发生在采样速率小于Nf的时候，并且会导致一些严重的后果（例如车轮反转）。<br>  理解起来也很容易。假设我们的手机每秒拍30张照片（在视频里称为“帧”），这意味着相邻两帧的间隔是1&#x2F;30s&#x3D;33.3ms。如果车轮的运动速度够快，那么就可能发生一个情况：在这33.3ms的时间间隔之内，车轮刚好转过了一圈（或1&#x2F;n圈，取决于车轮形状），这意味着第二帧和第一帧的画面是完全一样的。以此类推，如果车速维持在这个水平，那么我们将看到车轮一直静止。<br>  在信号领域，混叠的含义几乎是一样的，当我们的信号包含了大于采样率的频率，此时就会发生混叠现象，这会向已经采样的数据添加伪影，并且一旦它进入了数字信号，就无法消除。<br>*更多信息和通俗的动画解释：<a href="https://www.bilibili.com/video/BV14q4y1Z7bx">点击查看b站视频</a></p><h3 id="2-3-傅里叶变换（FT）"><a href="#2-3-傅里叶变换（FT）" class="headerlink" title="2.3 傅里叶变换（FT）"></a>2.3 傅里叶变换（FT）</h3><p>*本节部分内容源自<a href="https://www.cnblogs.com/h2zZhou/p/8405717.html">原文地址</a>，作者：韩昊</p><p>  现在，我们已经获得了一些采样好的数字信号，假设这些信号非常完美，不会发生混叠。我们随时可以用DAC过程将其转换回模拟信号，也可以存储在硬盘里以便之后使用。那么，我们还要傅里叶变换干什么？傅里叶变换到底是个什么东西？<br>  我们用一个最直观的方式理解傅里叶变换。<br>  在你的理解中，一段音乐是什么呢？<br><img src="/../_resources/d91b563e232fd309b8767eb75ffdb1a3.png" alt="声波图2.png"><br>  这是我们对音乐最普遍的理解，一个随时间变化的振动。<br>  但是，对于精通乐器的人来说，音乐更直观的理解也许是这样的：<br><img src="/../_resources/f5352b530b102b22e4fc160fc4bac229.png" alt="五线谱图.png"></p><p>  好了，傅里叶变换到此结束，我们继续下一章的学习。<br>  什么？这还不够吗？<br>  其实这是一个不太恰当的例子，但它通俗地解释了FT（傅里叶变换）的过程：将一段随时间变化的声波（时域信息）转换为随时间变化的音调（频域信息）。FT过程在无限的时间上识别信号，然后把其中的频率信息提取出来，并转换成有限的频率谱图。<br>  不过，我们到底怎么实现FT呢，一段声波信号看起来那么复杂、毫无规律，我们怎么提取其中的频率信息？<br>  傅里叶变换认为，所有的叠加波，都可以由有限或无限个已知或已知规律的正弦波叠加而成。而处理正弦波是非常轻松的，只需要找到它的周期，就能知道它的频率，还能得知它的表达式，甚至将其替换为另一个不同频率的正弦波。<br>  如果还不够直观，我们看一下两段音乐的声波图：<br><img src="/../_resources/71d799eeb29fc6ba5fbc0693c28c96aa.png" alt="声波图3.png"></p><p><img src="/../_resources/be31756d0721cf2caaafc700b22aa00e.png" alt="声波图4.png"><br>  上图是电子音乐，包含强烈鼓点、贝斯（低频）声音，而下图则是钢琴曲，这些低频声音很少。<br>  也许你已经看出来其中的区别了，低频声音占比高的声波，它的图像会呈现一个十分“低频”的起伏；而在同样的窗口内，低频占比小的声波则显得“复杂”很多，并且缺乏更大的起伏波浪。仔细观察上图，其实在起伏的过程中也包含很多小的尖刺，实际上这就是低频声音与高频声音叠加之后的结果。<br>  现在，你已经掌握了用肉眼做傅里叶变换的能力（），但是这个计算精度很差，也只能区分少数的几个频率（这就是为什么人来算傅里叶变换几乎不可能的原因）。不过，计算机很擅长这个，让它来做FT（确切来说是FFT，快速傅里叶变换，是针对计算机的一种优化算法），我们就能得到音乐的频谱图（颜色越亮表示声音强度越高）：<br><img src="/../_resources/f55b89e1692387413e2ee5f233dc93bb.png" alt="频谱图.png"></p><p>  （准确地说，这张图是频谱随时间变化的图，因为音乐信号中的频率信息时刻变化）<br>  这个图对于音频工程师来说简直就是一个神器；把声波转换为频率信息，我们可以发现很多原来不能发现的错误和问题；如果一些乐器声音太大导致刺耳的话，频谱图上就能看到高频部分的强度很高。<br>  在其它需要分析信号的领域，FT同样是好用的工具。它把复杂的信号做了简化，让我们能从另一个维度（视角）来观察信号。<br>*如果还感有余力，则可以详细了解拉普拉斯变换，它又从另一个维度理解了信号。</p><h2 id="三、FT在FTIR中的具体原理"><a href="#三、FT在FTIR中的具体原理" class="headerlink" title="三、FT在FTIR中的具体原理"></a>三、FT在FTIR中的具体原理</h2><h3 id="3-1-仪器工作流程详解"><a href="#3-1-仪器工作流程详解" class="headerlink" title="3.1 仪器工作流程详解"></a>3.1 仪器工作流程详解</h3><p>  对于FTIR而言，我们有红外光源、干涉仪（包含两个反射镜，一个是动镜，一个是定镜），He-Ne激光器，样品池，检测器，计算机系统。红外光源会持续发射连续的红外光谱，而动镜则利用激光校准、通过电机来调整位置，使之能够在确定的距离上进行移动；入射红外光在透镜作用下分成两束光，并在经过动镜和定镜后再次合为一束，在这个过程中两束光交汇即产生干涉现象，而其相位差就由动镜位置决定。动镜不断移动，干涉相位也在不断变化，这一束干涉光送入样品池后被吸收一部分，最后进入检测器和信号系统中。<br>  <img src="/../_resources/d156e5d7fb71c932d8ebc2153d08941e.png" alt="光线走向FTIR.png"></p><p>  这张图很好地解释了FTIR中各光线的走向。其中，Beamsplitter是光波分束器，也叫半透半反射镜，它的作用是将红外光源发射的光线分为两束，一束为绿色实线，另一束为红色实线；它们分别到达定镜和动镜，并被反射回来（反射光用绿色、红色虚线表示）。反射光到达分束器时也会发生同样的现象，我们需要的光线是绿色穿透线和红色反射线（虚线），它们在分束器处就会发生干涉现象，最后干涉光到达样品。</p><h3 id="3-2-信号检测与采样"><a href="#3-2-信号检测与采样" class="headerlink" title="3.2 信号检测与采样"></a>3.2 信号检测与采样</h3><p>  通过前文信号与系统部分的学习，我们知道，仪器是不能处理连续信号的，必须通过采样、转换为数字信号才可以进行处理和储存。不过，与音频（和大多数）信号不同的是，FTIR中信号并不是随时间变化，而是随动镜位置变化的。当动镜固定在一个位置时，得到的信号永远是同一个值。这就给了我们的仪器一些“可乘之机”。<br>  如果了解过示波器或相关产品，那么你一定会知道，现在的实验室示波器带宽一般不会超过10GHz（最大带宽，指在这个频率以内的信号都能被较为准确地还原和记录），而红外光的频率在300GHz到430THz之间，它们之间的差距非常大；尽管这个对比并不恰当，但我们依然能发现，通过时间来采样显然是不合适的。<br>  理解了这些，我们就能知道FTIR到底是如何采集数据的了；动镜每次移动很短的距离，然后两束光的相位会发生变化（光程差改变），进而引起干涉发生在不同的光频率上。这个动镜单次移动的距离非常短，以至于要单独用He-Ne激光来进行位置调整。具体是如何做到的，我并没有找到对应的资料，如果有同学知道可以在评论区告知。</p><h3 id="3-3-数据处理"><a href="#3-3-数据处理" class="headerlink" title="3.3 数据处理"></a>3.3 数据处理</h3><p>  现在，动镜完整地移动了一个循环，其中每次停顿的时候检测器都记录了一个数值，这个数值代表动镜在这个位置的时候这种干涉光导致的透过程度。将这些数值与动镜位置的关系作图，即得干涉图。对干涉图作FFT运算，即得每个频率（波数）下的吸光度（透过率）。<br>  如果难以理解，这里有一个解释的过程。<br>  假设我们的红外光源只会发射两个频率的波（即两个单色光），它们的频率有一定的差异。现在，这两束光经过了一次完整的工作循环，则在干涉仪中，两束光会发生干涉现象，且这个干涉会随动镜位置的改变而变化。我们将动镜的位置类比到音频信号中的时间，将检测器的结果理解为量化后的强度值，则得到的干涉图实际上是一种强度-时间的时域图；FFT可以将其转变为光谱图，实际上是一种强度-频率（波数）的频域图。只不过在音频信号中，频率指的是振动次数&#x2F;秒，而光谱中频率指的是波数&#x2F;厘米。<br>  <img src="/../_resources/bb116765d12239882d80f86789823e40.png" alt="干涉与谱图.png"></p><p>  左图为干涉图，右图为光谱图。可以将干涉图类比为时域信号图（如声波图），将光谱图类比为频域信号图（频谱图）。</p><h2 id="四、总结与展望"><a href="#四、总结与展望" class="headerlink" title="四、总结与展望"></a>四、总结与展望</h2><h3 id="4-1-总结与心得"><a href="#4-1-总结与心得" class="headerlink" title="4.1 总结与心得"></a>4.1 总结与心得</h3><p>  FTIR是目前应用最多的红外光谱分析原理，因为它与标准的红外光谱分析法相比，具有检测速度快、灵敏度更高、信噪比更高等优势。但目前大学相关仪器分析教材中并未详细描述FTIR的原理，甚至网络上都很难直接搜索到FTIR的详细原理（大部分都是以某乎的回答形式，而那些回答要么直接抄教材、FFT部分一笔带过，要么过于复杂、直接摆上一长串的变换公式，这对于想稍微深入理解但又没有学习过信号与系统的化学相关专业学生来说实在不友好）。因此，我在查找了大量的资料的情况下才有了撰写这篇文章的想法。<br>  我并不是多学位、辅修第二专业的学生，但我对音频处理、电子工程都有所了解和学习。这一次在食品专业课程中看到了相关的技术，我几乎是瞬间就产生了浓厚的兴趣。尽管学习的过程十分艰难，这篇文章最终还是诞生了，以期有相同兴趣的同学可以得到帮助。</p><h3 id="4-2-未来展望"><a href="#4-2-未来展望" class="headerlink" title="4.2 未来展望"></a>4.2 未来展望</h3><p>  由于大三时期学习事务繁多，本文从2022年11月22日开始编写，到26日了才勉强算接近尾声。因此，文章内仍然有很多错误没能及时发现与更正，若能指正，感激不尽。<br>  实际上我还学习了更多的内容，例如旁瓣峰与窗函数、信号补零的影响等等，但最终都并未写入本文。若有兴趣了解，可联系我提供相关学习资料地址等。</p>]]></content>
    
    
    <categories>
      
      <category>专业</category>
      
      <category>多学科</category>
      
    </categories>
    
    
    <tags>
      
      <tag>化学</tag>
      
      <tag>仪器分析</tag>
      
      <tag>信号处理</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
